import{e as Ir,b5 as z_,b8 as yr,b9 as cr,ba as jc,bb as $r,f as Cn,bc as H_,bd as Ol,p as K_}from"./index.eec712e0.js";import{e as ur}from"./index.18c2102e.js";import{c as B_,r as V_}from"./index.d4375cb3.js";import{t as jr}from"./tslib.d8988c61.js";var jo={},ys={};Object.defineProperty(ys,"__esModule",{value:!0});function k_(n){if(typeof n!="string")throw new Error(`Cannot safe json parse value of type ${typeof n}`);try{return JSON.parse(n)}catch{return n}}ys.safeJsonParse=k_;function G_(n){return typeof n=="string"?n:JSON.stringify(n,(t,r)=>typeof r>"u"?null:r)}ys.safeJsonStringify=G_;var ts={exports:{}},Pl;function W_(){return Pl||(Pl=1,function(){let n;function t(){}n=t,n.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},n.prototype.setItem=function(r,s){this[r]=String(s)},n.prototype.removeItem=function(r){delete this[r]},n.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},n.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},n.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Ir<"u"&&Ir.localStorage?ts.exports=Ir.localStorage:typeof window<"u"&&window.localStorage?ts.exports=window.localStorage:ts.exports=new t}()),ts.exports}var bc={},rs={},Al;function Y_(){if(Al)return rs;Al=1,Object.defineProperty(rs,"__esModule",{value:!0}),rs.IKeyValueStorage=void 0;class n{}return rs.IKeyValueStorage=n,rs}var is={},Cl;function J_(){if(Cl)return is;Cl=1,Object.defineProperty(is,"__esModule",{value:!0}),is.parseEntry=void 0;const n=ys;function t(r){var s;return[r[0],n.safeJsonParse((s=r[1])!==null&&s!==void 0?s:"")]}return is.parseEntry=t,is}var Nl;function X_(){return Nl||(Nl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=jr.exports;t.__exportStar(Y_(),n),t.__exportStar(J_(),n)}(bc)),bc}Object.defineProperty(jo,"__esModule",{value:!0});jo.KeyValueStorage=void 0;const Pn=jr.exports,Tl=ys,Z_=Pn.__importDefault(W_()),Q_=X_();class rp{constructor(){this.localStorage=Z_.default}getKeys(){return Pn.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return Pn.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(Q_.parseEntry)})}getItem(t){return Pn.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(t);if(r!==null)return Tl.safeJsonParse(r)})}setItem(t,r){return Pn.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(t,Tl.safeJsonStringify(r))})}removeItem(t){return Pn.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(t)})}}jo.KeyValueStorage=rp;var em=jo.default=rp,Rn={},ns={},ye={},wc={},ss={},Rl;function tm(){if(Rl)return ss;Rl=1,Object.defineProperty(ss,"__esModule",{value:!0}),ss.delay=void 0;function n(t){return new Promise(r=>{setTimeout(()=>{r(!0)},t)})}return ss.delay=n,ss}var Ji={},Ec={},Xi={},Ul;function rm(){return Ul||(Ul=1,Object.defineProperty(Xi,"__esModule",{value:!0}),Xi.ONE_THOUSAND=Xi.ONE_HUNDRED=void 0,Xi.ONE_HUNDRED=100,Xi.ONE_THOUSAND=1e3),Xi}var Sc={},Dl;function im(){return Dl||(Dl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ONE_YEAR=n.FOUR_WEEKS=n.THREE_WEEKS=n.TWO_WEEKS=n.ONE_WEEK=n.THIRTY_DAYS=n.SEVEN_DAYS=n.FIVE_DAYS=n.THREE_DAYS=n.ONE_DAY=n.TWENTY_FOUR_HOURS=n.TWELVE_HOURS=n.SIX_HOURS=n.THREE_HOURS=n.ONE_HOUR=n.SIXTY_MINUTES=n.THIRTY_MINUTES=n.TEN_MINUTES=n.FIVE_MINUTES=n.ONE_MINUTE=n.SIXTY_SECONDS=n.THIRTY_SECONDS=n.TEN_SECONDS=n.FIVE_SECONDS=n.ONE_SECOND=void 0,n.ONE_SECOND=1,n.FIVE_SECONDS=5,n.TEN_SECONDS=10,n.THIRTY_SECONDS=30,n.SIXTY_SECONDS=60,n.ONE_MINUTE=n.SIXTY_SECONDS,n.FIVE_MINUTES=n.ONE_MINUTE*5,n.TEN_MINUTES=n.ONE_MINUTE*10,n.THIRTY_MINUTES=n.ONE_MINUTE*30,n.SIXTY_MINUTES=n.ONE_MINUTE*60,n.ONE_HOUR=n.SIXTY_MINUTES,n.THREE_HOURS=n.ONE_HOUR*3,n.SIX_HOURS=n.ONE_HOUR*6,n.TWELVE_HOURS=n.ONE_HOUR*12,n.TWENTY_FOUR_HOURS=n.ONE_HOUR*24,n.ONE_DAY=n.TWENTY_FOUR_HOURS,n.THREE_DAYS=n.ONE_DAY*3,n.FIVE_DAYS=n.ONE_DAY*5,n.SEVEN_DAYS=n.ONE_DAY*7,n.THIRTY_DAYS=n.ONE_DAY*30,n.ONE_WEEK=n.SEVEN_DAYS,n.TWO_WEEKS=n.ONE_WEEK*2,n.THREE_WEEKS=n.ONE_WEEK*3,n.FOUR_WEEKS=n.ONE_WEEK*4,n.ONE_YEAR=n.ONE_DAY*365}(Sc)),Sc}var Ll;function ip(){return Ll||(Ll=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=jr.exports;t.__exportStar(rm(),n),t.__exportStar(im(),n)}(Ec)),Ec}var Fl;function nm(){if(Fl)return Ji;Fl=1,Object.defineProperty(Ji,"__esModule",{value:!0}),Ji.fromMiliseconds=Ji.toMiliseconds=void 0;const n=ip();function t(s){return s*n.ONE_THOUSAND}Ji.toMiliseconds=t;function r(s){return Math.floor(s/n.ONE_THOUSAND)}return Ji.fromMiliseconds=r,Ji}var $l;function sm(){return $l||($l=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=jr.exports;t.__exportStar(tm(),n),t.__exportStar(nm(),n)}(wc)),wc}var On={},Ml;function om(){if(Ml)return On;Ml=1,Object.defineProperty(On,"__esModule",{value:!0}),On.Watch=void 0;class n{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const s=this.get(r);if(typeof s.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const a=Date.now()-s.started;this.timestamps.set(r,{started:s.started,elapsed:a})}get(r){const s=this.timestamps.get(r);if(typeof s>"u")throw new Error(`No timestamp found for label: ${r}`);return s}elapsed(r){const s=this.get(r);return s.elapsed||Date.now()-s.started}}return On.Watch=n,On.default=n,On}var Ic={},os={},jl;function am(){if(jl)return os;jl=1,Object.defineProperty(os,"__esModule",{value:!0}),os.IWatch=void 0;class n{}return os.IWatch=n,os}var ql;function cm(){return ql||(ql=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),jr.exports.__exportStar(am(),n)}(Ic)),Ic}(function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=jr.exports;t.__exportStar(sm(),n),t.__exportStar(om(),n),t.__exportStar(cm(),n),t.__exportStar(ip(),n)})(ye);var xc={},as={};class tn{}const um=Object.freeze(Object.defineProperty({__proto__:null,IEvents:tn},Symbol.toStringTag,{value:"Module"})),hm=z_(um);var zl;function lm(){if(zl)return as;zl=1,Object.defineProperty(as,"__esModule",{value:!0}),as.IHeartBeat=void 0;const n=hm;class t extends n.IEvents{constructor(s){super()}}return as.IHeartBeat=t,as}var Hl;function np(){return Hl||(Hl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),jr.exports.__exportStar(lm(),n)}(xc)),xc}var Oc={},Zi={},Kl;function fm(){if(Kl)return Zi;Kl=1,Object.defineProperty(Zi,"__esModule",{value:!0}),Zi.HEARTBEAT_EVENTS=Zi.HEARTBEAT_INTERVAL=void 0;const n=ye;return Zi.HEARTBEAT_INTERVAL=n.FIVE_SECONDS,Zi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Zi}var Bl;function sp(){return Bl||(Bl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),jr.exports.__exportStar(fm(),n)}(Oc)),Oc}var Vl;function pm(){if(Vl)return ns;Vl=1,Object.defineProperty(ns,"__esModule",{value:!0}),ns.HeartBeat=void 0;const n=jr.exports,t=ur.exports,r=ye,s=np(),a=sp();class l extends s.IHeartBeat{constructor(p){super(p),this.events=new t.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(p==null?void 0:p.interval)||a.HEARTBEAT_INTERVAL}static init(p){return n.__awaiter(this,void 0,void 0,function*(){const v=new l(p);return yield v.init(),v})}init(){return n.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(p,v){this.events.on(p,v)}once(p,v){this.events.once(p,v)}off(p,v){this.events.off(p,v)}removeListener(p,v){this.events.removeListener(p,v)}initialize(){return n.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return ns.HeartBeat=l,ns}(function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=jr.exports;t.__exportStar(pm(),n),t.__exportStar(np(),n),t.__exportStar(sp(),n)})(Rn);var Qe={},Pc,kl;function dm(){if(kl)return Pc;kl=1;function n(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Pc=t;function t(r,s,a){var l=a&&a.stringify||n,d=1;if(typeof r=="object"&&r!==null){var p=s.length+d;if(p===1)return r;var v=new Array(p);v[0]=l(r);for(var w=1;w<p;w++)v[w]=l(s[w]);return v.join(" ")}if(typeof r!="string")return r;var x=s.length;if(x===0)return r;for(var D="",j=1-d,U=-1,z=r&&r.length||0,K=0;K<z;){if(r.charCodeAt(K)===37&&K+1<z){switch(U=U>-1?U:0,r.charCodeAt(K+1)){case 100:case 102:if(j>=x||s[j]==null)break;U<K&&(D+=r.slice(U,K)),D+=Number(s[j]),U=K+2,K++;break;case 105:if(j>=x||s[j]==null)break;U<K&&(D+=r.slice(U,K)),D+=Math.floor(Number(s[j])),U=K+2,K++;break;case 79:case 111:case 106:if(j>=x||s[j]===void 0)break;U<K&&(D+=r.slice(U,K));var B=typeof s[j];if(B==="string"){D+="'"+s[j]+"'",U=K+2,K++;break}if(B==="function"){D+=s[j].name||"<anonymous>",U=K+2,K++;break}D+=l(s[j]),U=K+2,K++;break;case 115:if(j>=x)break;U<K&&(D+=r.slice(U,K)),D+=String(s[j]),U=K+2,K++;break;case 37:U<K&&(D+=r.slice(U,K)),D+="%",U=K+2,K++,j--;break}++j}++K}return U===-1?r:(U<z&&(D+=r.slice(U)),D)}return Pc}var Ac,Gl;function gm(){if(Gl)return Ac;Gl=1;const n=dm();Ac=a;const t=P().console||{},r={mapHttpRequest:z,mapHttpResponse:z,wrapRequestSerializer:K,wrapResponseSerializer:K,wrapErrorSerializer:K,req:z,res:z,err:j};function s(m,u){return Array.isArray(m)?m.filter(function(G){return G!=="!stdSerializers.err"}):m===!0?Object.keys(u):!1}function a(m){m=m||{},m.browser=m.browser||{};const u=m.browser.transmit;if(u&&typeof u.send!="function")throw Error("pino: transmit option must have a send function");const _=m.browser.write||t;m.browser.write&&(m.browser.asObject=!0);const G=m.serializers||{},k=s(m.browser.serialize,G);let se=m.browser.serialize;Array.isArray(m.browser.serialize)&&m.browser.serialize.indexOf("!stdSerializers.err")>-1&&(se=!1);const ce=["error","fatal","warn","info","debug","trace"];typeof _=="function"&&(_.error=_.fatal=_.warn=_.info=_.debug=_.trace=_),m.enabled===!1&&(m.level="silent");const ge=m.level||"info",N=Object.create(_);N.log||(N.log=B),Object.defineProperty(N,"levelVal",{get:le}),Object.defineProperty(N,"level",{get:te,set:W});const q={transmit:u,serialize:k,asObject:m.browser.asObject,levels:ce,timestamp:U(m)};N.levels=a.levels,N.level=ge,N.setMaxListeners=N.getMaxListeners=N.emit=N.addListener=N.on=N.prependListener=N.once=N.prependOnceListener=N.removeListener=N.removeAllListeners=N.listeners=N.listenerCount=N.eventNames=N.write=N.flush=B,N.serializers=G,N._serialize=k,N._stdErrSerialize=se,N.child=ee,u&&(N._logEvent=D());function le(){return this.level==="silent"?1/0:this.levels.values[this.level]}function te(){return this._level}function W(Y){if(Y!=="silent"&&!this.levels.values[Y])throw Error("unknown level "+Y);this._level=Y,l(q,N,"error","log"),l(q,N,"fatal","error"),l(q,N,"warn","error"),l(q,N,"info","log"),l(q,N,"debug","log"),l(q,N,"trace","log")}function ee(Y,re){if(!Y)throw new Error("missing bindings for child Pino");re=re||{},k&&Y.serializers&&(re.serializers=Y.serializers);const Oe=re.serializers;if(k&&Oe){var ie=Object.assign({},G,Oe),be=m.browser.serialize===!0?Object.keys(ie):k;delete Y.serializers,v([Y],be,ie,this._stdErrSerialize)}function he(_e){this._childLevel=(_e._childLevel|0)+1,this.error=w(_e,Y,"error"),this.fatal=w(_e,Y,"fatal"),this.warn=w(_e,Y,"warn"),this.info=w(_e,Y,"info"),this.debug=w(_e,Y,"debug"),this.trace=w(_e,Y,"trace"),ie&&(this.serializers=ie,this._serialize=be),u&&(this._logEvent=D([].concat(_e._logEvent.bindings,Y)))}return he.prototype=this,new he(this)}return N}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=r,a.stdTimeFunctions=Object.assign({},{nullTime:oe,epochTime:C,unixTime:F,isoTime:S});function l(m,u,_,G){const k=Object.getPrototypeOf(u);u[_]=u.levelVal>u.levels.values[_]?B:k[_]?k[_]:t[_]||t[G]||B,d(m,u,_)}function d(m,u,_){!m.transmit&&u[_]===B||(u[_]=function(G){return function(){const se=m.timestamp(),ce=new Array(arguments.length),ge=Object.getPrototypeOf&&Object.getPrototypeOf(this)===t?t:this;for(var N=0;N<ce.length;N++)ce[N]=arguments[N];if(m.serialize&&!m.asObject&&v(ce,this._serialize,this.serializers,this._stdErrSerialize),m.asObject?G.call(ge,p(this,_,ce,se)):G.apply(ge,ce),m.transmit){const q=m.transmit.level||u.level,le=a.levels.values[q],te=a.levels.values[_];if(te<le)return;x(this,{ts:se,methodLevel:_,methodValue:te,transmitLevel:q,transmitValue:a.levels.values[m.transmit.level||u.level],send:m.transmit.send,val:u.levelVal},ce)}}}(u[_]))}function p(m,u,_,G){m._serialize&&v(_,m._serialize,m.serializers,m._stdErrSerialize);const k=_.slice();let se=k[0];const ce={};G&&(ce.time=G),ce.level=a.levels.values[u];let ge=(m._childLevel|0)+1;if(ge<1&&(ge=1),se!==null&&typeof se=="object"){for(;ge--&&typeof k[0]=="object";)Object.assign(ce,k.shift());se=k.length?n(k.shift(),k):void 0}else typeof se=="string"&&(se=n(k.shift(),k));return se!==void 0&&(ce.msg=se),ce}function v(m,u,_,G){for(const k in m)if(G&&m[k]instanceof Error)m[k]=a.stdSerializers.err(m[k]);else if(typeof m[k]=="object"&&!Array.isArray(m[k]))for(const se in m[k])u&&u.indexOf(se)>-1&&se in _&&(m[k][se]=_[se](m[k][se]))}function w(m,u,_){return function(){const G=new Array(1+arguments.length);G[0]=u;for(var k=1;k<G.length;k++)G[k]=arguments[k-1];return m[_].apply(this,G)}}function x(m,u,_){const G=u.send,k=u.ts,se=u.methodLevel,ce=u.methodValue,ge=u.val,N=m._logEvent.bindings;v(_,m._serialize||Object.keys(m.serializers),m.serializers,m._stdErrSerialize===void 0?!0:m._stdErrSerialize),m._logEvent.ts=k,m._logEvent.messages=_.filter(function(q){return N.indexOf(q)===-1}),m._logEvent.level.label=se,m._logEvent.level.value=ce,G(se,m._logEvent,ge),m._logEvent=D(N)}function D(m){return{ts:0,messages:[],bindings:m||[],level:{label:"",value:0}}}function j(m){const u={type:m.constructor.name,msg:m.message,stack:m.stack};for(const _ in m)u[_]===void 0&&(u[_]=m[_]);return u}function U(m){return typeof m.timestamp=="function"?m.timestamp:m.timestamp===!1?oe:C}function z(){return{}}function K(m){return m}function B(){}function oe(){return!1}function C(){return Date.now()}function F(){return Math.round(Date.now()/1e3)}function S(){return new Date(Date.now()).toISOString()}function P(){function m(u){return typeof u<"u"&&u}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return m(self)||m(window)||m(this)||{}}}return Ac}var Qi={},Wl;function op(){return Wl||(Wl=1,Object.defineProperty(Qi,"__esModule",{value:!0}),Qi.PINO_CUSTOM_CONTEXT_KEY=Qi.PINO_LOGGER_DEFAULTS=void 0,Qi.PINO_LOGGER_DEFAULTS={level:"info"},Qi.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Qi}var sr={},Yl;function vm(){if(Yl)return sr;Yl=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.generateChildLogger=sr.formatChildLoggerContext=sr.getLoggerContext=sr.setBrowserLoggerContext=sr.getBrowserLoggerContext=sr.getDefaultLoggerOptions=void 0;const n=op();function t(p){return Object.assign(Object.assign({},p),{level:(p==null?void 0:p.level)||n.PINO_LOGGER_DEFAULTS.level})}sr.getDefaultLoggerOptions=t;function r(p,v=n.PINO_CUSTOM_CONTEXT_KEY){return p[v]||""}sr.getBrowserLoggerContext=r;function s(p,v,w=n.PINO_CUSTOM_CONTEXT_KEY){return p[w]=v,p}sr.setBrowserLoggerContext=s;function a(p,v=n.PINO_CUSTOM_CONTEXT_KEY){let w="";return typeof p.bindings>"u"?w=r(p,v):w=p.bindings().context||"",w}sr.getLoggerContext=a;function l(p,v,w=n.PINO_CUSTOM_CONTEXT_KEY){const x=a(p,w);return x.trim()?`${x}/${v}`:v}sr.formatChildLoggerContext=l;function d(p,v,w=n.PINO_CUSTOM_CONTEXT_KEY){const x=l(p,v,w),D=p.child({context:x});return s(D,x,w)}return sr.generateChildLogger=d,sr}(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.pino=void 0;const t=jr.exports,r=t.__importDefault(gm());Object.defineProperty(n,"pino",{enumerable:!0,get:function(){return r.default}}),t.__exportStar(op(),n),t.__exportStar(vm(),n)})(Qe);class ym extends tn{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}class _m extends tn{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}}class mm{constructor(t,r){this.logger=t,this.core=r}}class bm extends tn{constructor(t,r){super(),this.relayer=t,this.logger=r}}class wm extends tn{constructor(t){super()}}class Em{constructor(t,r,s,a){this.core=t,this.logger=r,this.name=s}}class Sm extends tn{constructor(t,r){super(),this.relayer=t,this.logger=r}}class Im extends tn{constructor(t,r){super(),this.core=t,this.logger=r}}class xm{constructor(t,r){this.projectId=t,this.logger=r}}class Om{constructor(t){this.opts=t,this.protocol="wc",this.version=2}}class Pm{constructor(t){this.client=t}}const Am=n=>JSON.stringify(n,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),Cm=n=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=n.replace(t,'$1"$2n"$3');return JSON.parse(r,(s,a)=>typeof a=="string"&&a.match(/^\d+n$/)?BigInt(a.substring(0,a.length-1)):a)};function iu(n){if(typeof n!="string")throw new Error(`Cannot safe json parse value of type ${typeof n}`);try{return Cm(n)}catch{return n}}function gs(n){return typeof n=="string"?n:Am(n)||""}var nu={},Un={},qo={},zo={};Object.defineProperty(zo,"__esModule",{value:!0});zo.BrowserRandomSource=void 0;const Jl=65536;class Nm{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const t=typeof self<"u"?self.crypto||self.msCrypto:null;t&&t.getRandomValues!==void 0&&(this._crypto=t,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(t){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(t);for(let s=0;s<r.length;s+=Jl)this._crypto.getRandomValues(r.subarray(s,s+Math.min(r.length-s,Jl)));return r}}zo.BrowserRandomSource=Nm;var Ho={},xr={};Object.defineProperty(xr,"__esModule",{value:!0});function Tm(n){for(var t=0;t<n.length;t++)n[t]=0;return n}xr.wipe=Tm;Object.defineProperty(Ho,"__esModule",{value:!0});Ho.NodeRandomSource=void 0;const Rm=xr;class Um{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof B_<"u"){const t=V_();t&&t.randomBytes&&(this._crypto=t,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(t){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(t);if(r.length!==t)throw new Error("NodeRandomSource: got fewer bytes than requested");const s=new Uint8Array(t);for(let a=0;a<s.length;a++)s[a]=r[a];return(0,Rm.wipe)(r),s}}Ho.NodeRandomSource=Um;Object.defineProperty(qo,"__esModule",{value:!0});qo.SystemRandomSource=void 0;const Dm=zo,Lm=Ho;class Fm{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Dm.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new Lm.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(t){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(t)}}qo.SystemRandomSource=Fm;var Fe={},ap={};(function(n){Object.defineProperty(n,"__esModule",{value:!0});function t(p,v){var w=p>>>16&65535,x=p&65535,D=v>>>16&65535,j=v&65535;return x*j+(w*j+x*D<<16>>>0)|0}n.mul=Math.imul||t;function r(p,v){return p+v|0}n.add=r;function s(p,v){return p-v|0}n.sub=s;function a(p,v){return p<<v|p>>>32-v}n.rotl=a;function l(p,v){return p<<32-v|p>>>v}n.rotr=l;function d(p){return typeof p=="number"&&isFinite(p)&&Math.floor(p)===p}n.isInteger=Number.isInteger||d,n.MAX_SAFE_INTEGER=9007199254740991,n.isSafeInteger=function(p){return n.isInteger(p)&&p>=-n.MAX_SAFE_INTEGER&&p<=n.MAX_SAFE_INTEGER}})(ap);Object.defineProperty(Fe,"__esModule",{value:!0});var cp=ap;function $m(n,t){return t===void 0&&(t=0),(n[t+0]<<8|n[t+1])<<16>>16}Fe.readInt16BE=$m;function Mm(n,t){return t===void 0&&(t=0),(n[t+0]<<8|n[t+1])>>>0}Fe.readUint16BE=Mm;function jm(n,t){return t===void 0&&(t=0),(n[t+1]<<8|n[t])<<16>>16}Fe.readInt16LE=jm;function qm(n,t){return t===void 0&&(t=0),(n[t+1]<<8|n[t])>>>0}Fe.readUint16LE=qm;function up(n,t,r){return t===void 0&&(t=new Uint8Array(2)),r===void 0&&(r=0),t[r+0]=n>>>8,t[r+1]=n>>>0,t}Fe.writeUint16BE=up;Fe.writeInt16BE=up;function hp(n,t,r){return t===void 0&&(t=new Uint8Array(2)),r===void 0&&(r=0),t[r+0]=n>>>0,t[r+1]=n>>>8,t}Fe.writeUint16LE=hp;Fe.writeInt16LE=hp;function qc(n,t){return t===void 0&&(t=0),n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3]}Fe.readInt32BE=qc;function zc(n,t){return t===void 0&&(t=0),(n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3])>>>0}Fe.readUint32BE=zc;function Hc(n,t){return t===void 0&&(t=0),n[t+3]<<24|n[t+2]<<16|n[t+1]<<8|n[t]}Fe.readInt32LE=Hc;function Kc(n,t){return t===void 0&&(t=0),(n[t+3]<<24|n[t+2]<<16|n[t+1]<<8|n[t])>>>0}Fe.readUint32LE=Kc;function Ro(n,t,r){return t===void 0&&(t=new Uint8Array(4)),r===void 0&&(r=0),t[r+0]=n>>>24,t[r+1]=n>>>16,t[r+2]=n>>>8,t[r+3]=n>>>0,t}Fe.writeUint32BE=Ro;Fe.writeInt32BE=Ro;function Uo(n,t,r){return t===void 0&&(t=new Uint8Array(4)),r===void 0&&(r=0),t[r+0]=n>>>0,t[r+1]=n>>>8,t[r+2]=n>>>16,t[r+3]=n>>>24,t}Fe.writeUint32LE=Uo;Fe.writeInt32LE=Uo;function zm(n,t){t===void 0&&(t=0);var r=qc(n,t),s=qc(n,t+4);return r*4294967296+s-(s>>31)*4294967296}Fe.readInt64BE=zm;function Hm(n,t){t===void 0&&(t=0);var r=zc(n,t),s=zc(n,t+4);return r*4294967296+s}Fe.readUint64BE=Hm;function Km(n,t){t===void 0&&(t=0);var r=Hc(n,t),s=Hc(n,t+4);return s*4294967296+r-(r>>31)*4294967296}Fe.readInt64LE=Km;function Bm(n,t){t===void 0&&(t=0);var r=Kc(n,t),s=Kc(n,t+4);return s*4294967296+r}Fe.readUint64LE=Bm;function lp(n,t,r){return t===void 0&&(t=new Uint8Array(8)),r===void 0&&(r=0),Ro(n/4294967296>>>0,t,r),Ro(n>>>0,t,r+4),t}Fe.writeUint64BE=lp;Fe.writeInt64BE=lp;function fp(n,t,r){return t===void 0&&(t=new Uint8Array(8)),r===void 0&&(r=0),Uo(n>>>0,t,r),Uo(n/4294967296>>>0,t,r+4),t}Fe.writeUint64LE=fp;Fe.writeInt64LE=fp;function Vm(n,t,r){if(r===void 0&&(r=0),n%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(n/8>t.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var s=0,a=1,l=n/8+r-1;l>=r;l--)s+=t[l]*a,a*=256;return s}Fe.readUintBE=Vm;function km(n,t,r){if(r===void 0&&(r=0),n%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(n/8>t.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var s=0,a=1,l=r;l<r+n/8;l++)s+=t[l]*a,a*=256;return s}Fe.readUintLE=km;function Gm(n,t,r,s){if(r===void 0&&(r=new Uint8Array(n/8)),s===void 0&&(s=0),n%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!cp.isSafeInteger(t))throw new Error("writeUintBE value must be an integer");for(var a=1,l=n/8+s-1;l>=s;l--)r[l]=t/a&255,a*=256;return r}Fe.writeUintBE=Gm;function Wm(n,t,r,s){if(r===void 0&&(r=new Uint8Array(n/8)),s===void 0&&(s=0),n%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!cp.isSafeInteger(t))throw new Error("writeUintLE value must be an integer");for(var a=1,l=s;l<s+n/8;l++)r[l]=t/a&255,a*=256;return r}Fe.writeUintLE=Wm;function Ym(n,t){t===void 0&&(t=0);var r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getFloat32(t)}Fe.readFloat32BE=Ym;function Jm(n,t){t===void 0&&(t=0);var r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getFloat32(t,!0)}Fe.readFloat32LE=Jm;function Xm(n,t){t===void 0&&(t=0);var r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getFloat64(t)}Fe.readFloat64BE=Xm;function Zm(n,t){t===void 0&&(t=0);var r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getFloat64(t,!0)}Fe.readFloat64LE=Zm;function Qm(n,t,r){t===void 0&&(t=new Uint8Array(4)),r===void 0&&(r=0);var s=new DataView(t.buffer,t.byteOffset,t.byteLength);return s.setFloat32(r,n),t}Fe.writeFloat32BE=Qm;function eb(n,t,r){t===void 0&&(t=new Uint8Array(4)),r===void 0&&(r=0);var s=new DataView(t.buffer,t.byteOffset,t.byteLength);return s.setFloat32(r,n,!0),t}Fe.writeFloat32LE=eb;function tb(n,t,r){t===void 0&&(t=new Uint8Array(8)),r===void 0&&(r=0);var s=new DataView(t.buffer,t.byteOffset,t.byteLength);return s.setFloat64(r,n),t}Fe.writeFloat64BE=tb;function rb(n,t,r){t===void 0&&(t=new Uint8Array(8)),r===void 0&&(r=0);var s=new DataView(t.buffer,t.byteOffset,t.byteLength);return s.setFloat64(r,n,!0),t}Fe.writeFloat64LE=rb;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.randomStringForEntropy=n.randomString=n.randomUint32=n.randomBytes=n.defaultRandomSource=void 0;const t=qo,r=Fe,s=xr;n.defaultRandomSource=new t.SystemRandomSource;function a(w,x=n.defaultRandomSource){return x.randomBytes(w)}n.randomBytes=a;function l(w=n.defaultRandomSource){const x=a(4,w),D=(0,r.readUint32LE)(x);return(0,s.wipe)(x),D}n.randomUint32=l;const d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function p(w,x=d,D=n.defaultRandomSource){if(x.length<2)throw new Error("randomString charset is too short");if(x.length>256)throw new Error("randomString charset is too long");let j="";const U=x.length,z=256-256%U;for(;w>0;){const K=a(Math.ceil(w*256/z),D);for(let B=0;B<K.length&&w>0;B++){const oe=K[B];oe<z&&(j+=x.charAt(oe%U),w--)}(0,s.wipe)(K)}return j}n.randomString=p;function v(w,x=d,D=n.defaultRandomSource){const j=Math.ceil(w/(Math.log(x.length)/Math.LN2));return p(j,x,D)}n.randomStringForEntropy=v})(Un);var pp={};(function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=Fe,r=xr;n.DIGEST_LENGTH=64,n.BLOCK_SIZE=128;var s=function(){function p(){this.digestLength=n.DIGEST_LENGTH,this.blockSize=n.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return p.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},p.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},p.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},p.prototype.update=function(v,w){if(w===void 0&&(w=v.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var x=0;if(this._bytesHashed+=w,this._bufferLength>0){for(;this._bufferLength<n.BLOCK_SIZE&&w>0;)this._buffer[this._bufferLength++]=v[x++],w--;this._bufferLength===this.blockSize&&(l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(w>=this.blockSize&&(x=l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,v,x,w),w%=this.blockSize);w>0;)this._buffer[this._bufferLength++]=v[x++],w--;return this},p.prototype.finish=function(v){if(!this._finished){var w=this._bytesHashed,x=this._bufferLength,D=w/536870912|0,j=w<<3,U=w%128<112?128:256;this._buffer[x]=128;for(var z=x+1;z<U-8;z++)this._buffer[z]=0;t.writeUint32BE(D,this._buffer,U-8),t.writeUint32BE(j,this._buffer,U-4),l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,U),this._finished=!0}for(var z=0;z<this.digestLength/8;z++)t.writeUint32BE(this._stateHi[z],v,z*8),t.writeUint32BE(this._stateLo[z],v,z*8+4);return this},p.prototype.digest=function(){var v=new Uint8Array(this.digestLength);return this.finish(v),v},p.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},p.prototype.restoreState=function(v){return this._stateHi.set(v.stateHi),this._stateLo.set(v.stateLo),this._bufferLength=v.bufferLength,v.buffer&&this._buffer.set(v.buffer),this._bytesHashed=v.bytesHashed,this._finished=!1,this},p.prototype.cleanSavedState=function(v){r.wipe(v.stateHi),r.wipe(v.stateLo),v.buffer&&r.wipe(v.buffer),v.bufferLength=0,v.bytesHashed=0},p}();n.SHA512=s;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function l(p,v,w,x,D,j,U){for(var z=w[0],K=w[1],B=w[2],oe=w[3],C=w[4],F=w[5],S=w[6],P=w[7],m=x[0],u=x[1],_=x[2],G=x[3],k=x[4],se=x[5],ce=x[6],ge=x[7],N,q,le,te,W,ee,Y,re;U>=128;){for(var Oe=0;Oe<16;Oe++){var ie=8*Oe+j;p[Oe]=t.readUint32BE(D,ie),v[Oe]=t.readUint32BE(D,ie+4)}for(var Oe=0;Oe<80;Oe++){var be=z,he=K,_e=B,M=oe,$=C,A=F,h=S,I=P,ne=m,fe=u,Ie=_,He=G,Ve=k,$e=se,dt=ce,gt=ge;if(N=P,q=ge,W=q&65535,ee=q>>>16,Y=N&65535,re=N>>>16,N=(C>>>14|k<<32-14)^(C>>>18|k<<32-18)^(k>>>41-32|C<<32-(41-32)),q=(k>>>14|C<<32-14)^(k>>>18|C<<32-18)^(C>>>41-32|k<<32-(41-32)),W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,N=C&F^~C&S,q=k&se^~k&ce,W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,N=a[Oe*2],q=a[Oe*2+1],W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,N=p[Oe%16],q=v[Oe%16],W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,le=Y&65535|re<<16,te=W&65535|ee<<16,N=le,q=te,W=q&65535,ee=q>>>16,Y=N&65535,re=N>>>16,N=(z>>>28|m<<32-28)^(m>>>34-32|z<<32-(34-32))^(m>>>39-32|z<<32-(39-32)),q=(m>>>28|z<<32-28)^(z>>>34-32|m<<32-(34-32))^(z>>>39-32|m<<32-(39-32)),W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,N=z&K^z&B^K&B,q=m&u^m&_^u&_,W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,I=Y&65535|re<<16,gt=W&65535|ee<<16,N=M,q=He,W=q&65535,ee=q>>>16,Y=N&65535,re=N>>>16,N=le,q=te,W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,M=Y&65535|re<<16,He=W&65535|ee<<16,K=be,B=he,oe=_e,C=M,F=$,S=A,P=h,z=I,u=ne,_=fe,G=Ie,k=He,se=Ve,ce=$e,ge=dt,m=gt,Oe%16===15)for(var ie=0;ie<16;ie++)N=p[ie],q=v[ie],W=q&65535,ee=q>>>16,Y=N&65535,re=N>>>16,N=p[(ie+9)%16],q=v[(ie+9)%16],W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,le=p[(ie+1)%16],te=v[(ie+1)%16],N=(le>>>1|te<<32-1)^(le>>>8|te<<32-8)^le>>>7,q=(te>>>1|le<<32-1)^(te>>>8|le<<32-8)^(te>>>7|le<<32-7),W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,le=p[(ie+14)%16],te=v[(ie+14)%16],N=(le>>>19|te<<32-19)^(te>>>61-32|le<<32-(61-32))^le>>>6,q=(te>>>19|le<<32-19)^(le>>>61-32|te<<32-(61-32))^(te>>>6|le<<32-6),W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,p[ie]=Y&65535|re<<16,v[ie]=W&65535|ee<<16}N=z,q=m,W=q&65535,ee=q>>>16,Y=N&65535,re=N>>>16,N=w[0],q=x[0],W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,w[0]=z=Y&65535|re<<16,x[0]=m=W&65535|ee<<16,N=K,q=u,W=q&65535,ee=q>>>16,Y=N&65535,re=N>>>16,N=w[1],q=x[1],W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,w[1]=K=Y&65535|re<<16,x[1]=u=W&65535|ee<<16,N=B,q=_,W=q&65535,ee=q>>>16,Y=N&65535,re=N>>>16,N=w[2],q=x[2],W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,w[2]=B=Y&65535|re<<16,x[2]=_=W&65535|ee<<16,N=oe,q=G,W=q&65535,ee=q>>>16,Y=N&65535,re=N>>>16,N=w[3],q=x[3],W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,w[3]=oe=Y&65535|re<<16,x[3]=G=W&65535|ee<<16,N=C,q=k,W=q&65535,ee=q>>>16,Y=N&65535,re=N>>>16,N=w[4],q=x[4],W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,w[4]=C=Y&65535|re<<16,x[4]=k=W&65535|ee<<16,N=F,q=se,W=q&65535,ee=q>>>16,Y=N&65535,re=N>>>16,N=w[5],q=x[5],W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,w[5]=F=Y&65535|re<<16,x[5]=se=W&65535|ee<<16,N=S,q=ce,W=q&65535,ee=q>>>16,Y=N&65535,re=N>>>16,N=w[6],q=x[6],W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,w[6]=S=Y&65535|re<<16,x[6]=ce=W&65535|ee<<16,N=P,q=ge,W=q&65535,ee=q>>>16,Y=N&65535,re=N>>>16,N=w[7],q=x[7],W+=q&65535,ee+=q>>>16,Y+=N&65535,re+=N>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,w[7]=P=Y&65535|re<<16,x[7]=ge=W&65535|ee<<16,j+=128,U-=128}return j}function d(p){var v=new s;v.update(p);var w=v.digest();return v.clean(),w}n.hash=d})(pp);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.convertSecretKeyToX25519=n.convertPublicKeyToX25519=n.verify=n.sign=n.extractPublicKeyFromSecretKey=n.generateKeyPair=n.generateKeyPairFromSeed=n.SEED_LENGTH=n.SECRET_KEY_LENGTH=n.PUBLIC_KEY_LENGTH=n.SIGNATURE_LENGTH=void 0;const t=Un,r=pp,s=xr;n.SIGNATURE_LENGTH=64,n.PUBLIC_KEY_LENGTH=32,n.SECRET_KEY_LENGTH=64,n.SEED_LENGTH=32;function a(M){const $=new Float64Array(16);if(M)for(let A=0;A<M.length;A++)$[A]=M[A];return $}const l=new Uint8Array(32);l[0]=9;const d=a(),p=a([1]),v=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),w=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),x=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),D=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),j=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function U(M,$){for(let A=0;A<16;A++)M[A]=$[A]|0}function z(M){let $=1;for(let A=0;A<16;A++){let h=M[A]+$+65535;$=Math.floor(h/65536),M[A]=h-$*65536}M[0]+=$-1+37*($-1)}function K(M,$,A){const h=~(A-1);for(let I=0;I<16;I++){const ne=h&(M[I]^$[I]);M[I]^=ne,$[I]^=ne}}function B(M,$){const A=a(),h=a();for(let I=0;I<16;I++)h[I]=$[I];z(h),z(h),z(h);for(let I=0;I<2;I++){A[0]=h[0]-65517;for(let fe=1;fe<15;fe++)A[fe]=h[fe]-65535-(A[fe-1]>>16&1),A[fe-1]&=65535;A[15]=h[15]-32767-(A[14]>>16&1);const ne=A[15]>>16&1;A[14]&=65535,K(h,A,1-ne)}for(let I=0;I<16;I++)M[2*I]=h[I]&255,M[2*I+1]=h[I]>>8}function oe(M,$){let A=0;for(let h=0;h<32;h++)A|=M[h]^$[h];return(1&A-1>>>8)-1}function C(M,$){const A=new Uint8Array(32),h=new Uint8Array(32);return B(A,M),B(h,$),oe(A,h)}function F(M){const $=new Uint8Array(32);return B($,M),$[0]&1}function S(M,$){for(let A=0;A<16;A++)M[A]=$[2*A]+($[2*A+1]<<8);M[15]&=32767}function P(M,$,A){for(let h=0;h<16;h++)M[h]=$[h]+A[h]}function m(M,$,A){for(let h=0;h<16;h++)M[h]=$[h]-A[h]}function u(M,$,A){let h,I,ne=0,fe=0,Ie=0,He=0,Ve=0,$e=0,dt=0,gt=0,je=0,xe=0,Ue=0,De=0,qe=0,Ae=0,Le=0,Se=0,Ce=0,Ke=0,Pe=0,ke=0,We=0,et=0,tt=0,Je=0,Qt=0,hr=0,Wr=0,er=0,ni=0,mi=0,Fi=0,wt=A[0],vt=A[1],Et=A[2],St=A[3],mt=A[4],yt=A[5],Lt=A[6],Ft=A[7],It=A[8],$t=A[9],xt=A[10],Ct=A[11],Ot=A[12],ht=A[13],Mt=A[14],jt=A[15];h=$[0],ne+=h*wt,fe+=h*vt,Ie+=h*Et,He+=h*St,Ve+=h*mt,$e+=h*yt,dt+=h*Lt,gt+=h*Ft,je+=h*It,xe+=h*$t,Ue+=h*xt,De+=h*Ct,qe+=h*Ot,Ae+=h*ht,Le+=h*Mt,Se+=h*jt,h=$[1],fe+=h*wt,Ie+=h*vt,He+=h*Et,Ve+=h*St,$e+=h*mt,dt+=h*yt,gt+=h*Lt,je+=h*Ft,xe+=h*It,Ue+=h*$t,De+=h*xt,qe+=h*Ct,Ae+=h*Ot,Le+=h*ht,Se+=h*Mt,Ce+=h*jt,h=$[2],Ie+=h*wt,He+=h*vt,Ve+=h*Et,$e+=h*St,dt+=h*mt,gt+=h*yt,je+=h*Lt,xe+=h*Ft,Ue+=h*It,De+=h*$t,qe+=h*xt,Ae+=h*Ct,Le+=h*Ot,Se+=h*ht,Ce+=h*Mt,Ke+=h*jt,h=$[3],He+=h*wt,Ve+=h*vt,$e+=h*Et,dt+=h*St,gt+=h*mt,je+=h*yt,xe+=h*Lt,Ue+=h*Ft,De+=h*It,qe+=h*$t,Ae+=h*xt,Le+=h*Ct,Se+=h*Ot,Ce+=h*ht,Ke+=h*Mt,Pe+=h*jt,h=$[4],Ve+=h*wt,$e+=h*vt,dt+=h*Et,gt+=h*St,je+=h*mt,xe+=h*yt,Ue+=h*Lt,De+=h*Ft,qe+=h*It,Ae+=h*$t,Le+=h*xt,Se+=h*Ct,Ce+=h*Ot,Ke+=h*ht,Pe+=h*Mt,ke+=h*jt,h=$[5],$e+=h*wt,dt+=h*vt,gt+=h*Et,je+=h*St,xe+=h*mt,Ue+=h*yt,De+=h*Lt,qe+=h*Ft,Ae+=h*It,Le+=h*$t,Se+=h*xt,Ce+=h*Ct,Ke+=h*Ot,Pe+=h*ht,ke+=h*Mt,We+=h*jt,h=$[6],dt+=h*wt,gt+=h*vt,je+=h*Et,xe+=h*St,Ue+=h*mt,De+=h*yt,qe+=h*Lt,Ae+=h*Ft,Le+=h*It,Se+=h*$t,Ce+=h*xt,Ke+=h*Ct,Pe+=h*Ot,ke+=h*ht,We+=h*Mt,et+=h*jt,h=$[7],gt+=h*wt,je+=h*vt,xe+=h*Et,Ue+=h*St,De+=h*mt,qe+=h*yt,Ae+=h*Lt,Le+=h*Ft,Se+=h*It,Ce+=h*$t,Ke+=h*xt,Pe+=h*Ct,ke+=h*Ot,We+=h*ht,et+=h*Mt,tt+=h*jt,h=$[8],je+=h*wt,xe+=h*vt,Ue+=h*Et,De+=h*St,qe+=h*mt,Ae+=h*yt,Le+=h*Lt,Se+=h*Ft,Ce+=h*It,Ke+=h*$t,Pe+=h*xt,ke+=h*Ct,We+=h*Ot,et+=h*ht,tt+=h*Mt,Je+=h*jt,h=$[9],xe+=h*wt,Ue+=h*vt,De+=h*Et,qe+=h*St,Ae+=h*mt,Le+=h*yt,Se+=h*Lt,Ce+=h*Ft,Ke+=h*It,Pe+=h*$t,ke+=h*xt,We+=h*Ct,et+=h*Ot,tt+=h*ht,Je+=h*Mt,Qt+=h*jt,h=$[10],Ue+=h*wt,De+=h*vt,qe+=h*Et,Ae+=h*St,Le+=h*mt,Se+=h*yt,Ce+=h*Lt,Ke+=h*Ft,Pe+=h*It,ke+=h*$t,We+=h*xt,et+=h*Ct,tt+=h*Ot,Je+=h*ht,Qt+=h*Mt,hr+=h*jt,h=$[11],De+=h*wt,qe+=h*vt,Ae+=h*Et,Le+=h*St,Se+=h*mt,Ce+=h*yt,Ke+=h*Lt,Pe+=h*Ft,ke+=h*It,We+=h*$t,et+=h*xt,tt+=h*Ct,Je+=h*Ot,Qt+=h*ht,hr+=h*Mt,Wr+=h*jt,h=$[12],qe+=h*wt,Ae+=h*vt,Le+=h*Et,Se+=h*St,Ce+=h*mt,Ke+=h*yt,Pe+=h*Lt,ke+=h*Ft,We+=h*It,et+=h*$t,tt+=h*xt,Je+=h*Ct,Qt+=h*Ot,hr+=h*ht,Wr+=h*Mt,er+=h*jt,h=$[13],Ae+=h*wt,Le+=h*vt,Se+=h*Et,Ce+=h*St,Ke+=h*mt,Pe+=h*yt,ke+=h*Lt,We+=h*Ft,et+=h*It,tt+=h*$t,Je+=h*xt,Qt+=h*Ct,hr+=h*Ot,Wr+=h*ht,er+=h*Mt,ni+=h*jt,h=$[14],Le+=h*wt,Se+=h*vt,Ce+=h*Et,Ke+=h*St,Pe+=h*mt,ke+=h*yt,We+=h*Lt,et+=h*Ft,tt+=h*It,Je+=h*$t,Qt+=h*xt,hr+=h*Ct,Wr+=h*Ot,er+=h*ht,ni+=h*Mt,mi+=h*jt,h=$[15],Se+=h*wt,Ce+=h*vt,Ke+=h*Et,Pe+=h*St,ke+=h*mt,We+=h*yt,et+=h*Lt,tt+=h*Ft,Je+=h*It,Qt+=h*$t,hr+=h*xt,Wr+=h*Ct,er+=h*Ot,ni+=h*ht,mi+=h*Mt,Fi+=h*jt,ne+=38*Ce,fe+=38*Ke,Ie+=38*Pe,He+=38*ke,Ve+=38*We,$e+=38*et,dt+=38*tt,gt+=38*Je,je+=38*Qt,xe+=38*hr,Ue+=38*Wr,De+=38*er,qe+=38*ni,Ae+=38*mi,Le+=38*Fi,I=1,h=ne+I+65535,I=Math.floor(h/65536),ne=h-I*65536,h=fe+I+65535,I=Math.floor(h/65536),fe=h-I*65536,h=Ie+I+65535,I=Math.floor(h/65536),Ie=h-I*65536,h=He+I+65535,I=Math.floor(h/65536),He=h-I*65536,h=Ve+I+65535,I=Math.floor(h/65536),Ve=h-I*65536,h=$e+I+65535,I=Math.floor(h/65536),$e=h-I*65536,h=dt+I+65535,I=Math.floor(h/65536),dt=h-I*65536,h=gt+I+65535,I=Math.floor(h/65536),gt=h-I*65536,h=je+I+65535,I=Math.floor(h/65536),je=h-I*65536,h=xe+I+65535,I=Math.floor(h/65536),xe=h-I*65536,h=Ue+I+65535,I=Math.floor(h/65536),Ue=h-I*65536,h=De+I+65535,I=Math.floor(h/65536),De=h-I*65536,h=qe+I+65535,I=Math.floor(h/65536),qe=h-I*65536,h=Ae+I+65535,I=Math.floor(h/65536),Ae=h-I*65536,h=Le+I+65535,I=Math.floor(h/65536),Le=h-I*65536,h=Se+I+65535,I=Math.floor(h/65536),Se=h-I*65536,ne+=I-1+37*(I-1),I=1,h=ne+I+65535,I=Math.floor(h/65536),ne=h-I*65536,h=fe+I+65535,I=Math.floor(h/65536),fe=h-I*65536,h=Ie+I+65535,I=Math.floor(h/65536),Ie=h-I*65536,h=He+I+65535,I=Math.floor(h/65536),He=h-I*65536,h=Ve+I+65535,I=Math.floor(h/65536),Ve=h-I*65536,h=$e+I+65535,I=Math.floor(h/65536),$e=h-I*65536,h=dt+I+65535,I=Math.floor(h/65536),dt=h-I*65536,h=gt+I+65535,I=Math.floor(h/65536),gt=h-I*65536,h=je+I+65535,I=Math.floor(h/65536),je=h-I*65536,h=xe+I+65535,I=Math.floor(h/65536),xe=h-I*65536,h=Ue+I+65535,I=Math.floor(h/65536),Ue=h-I*65536,h=De+I+65535,I=Math.floor(h/65536),De=h-I*65536,h=qe+I+65535,I=Math.floor(h/65536),qe=h-I*65536,h=Ae+I+65535,I=Math.floor(h/65536),Ae=h-I*65536,h=Le+I+65535,I=Math.floor(h/65536),Le=h-I*65536,h=Se+I+65535,I=Math.floor(h/65536),Se=h-I*65536,ne+=I-1+37*(I-1),M[0]=ne,M[1]=fe,M[2]=Ie,M[3]=He,M[4]=Ve,M[5]=$e,M[6]=dt,M[7]=gt,M[8]=je,M[9]=xe,M[10]=Ue,M[11]=De,M[12]=qe,M[13]=Ae,M[14]=Le,M[15]=Se}function _(M,$){u(M,$,$)}function G(M,$){const A=a();let h;for(h=0;h<16;h++)A[h]=$[h];for(h=253;h>=0;h--)_(A,A),h!==2&&h!==4&&u(A,A,$);for(h=0;h<16;h++)M[h]=A[h]}function k(M,$){const A=a();let h;for(h=0;h<16;h++)A[h]=$[h];for(h=250;h>=0;h--)_(A,A),h!==1&&u(A,A,$);for(h=0;h<16;h++)M[h]=A[h]}function se(M,$){const A=a(),h=a(),I=a(),ne=a(),fe=a(),Ie=a(),He=a(),Ve=a(),$e=a();m(A,M[1],M[0]),m($e,$[1],$[0]),u(A,A,$e),P(h,M[0],M[1]),P($e,$[0],$[1]),u(h,h,$e),u(I,M[3],$[3]),u(I,I,w),u(ne,M[2],$[2]),P(ne,ne,ne),m(fe,h,A),m(Ie,ne,I),P(He,ne,I),P(Ve,h,A),u(M[0],fe,Ie),u(M[1],Ve,He),u(M[2],He,Ie),u(M[3],fe,Ve)}function ce(M,$,A){for(let h=0;h<4;h++)K(M[h],$[h],A)}function ge(M,$){const A=a(),h=a(),I=a();G(I,$[2]),u(A,$[0],I),u(h,$[1],I),B(M,h),M[31]^=F(A)<<7}function N(M,$,A){U(M[0],d),U(M[1],p),U(M[2],p),U(M[3],d);for(let h=255;h>=0;--h){const I=A[h/8|0]>>(h&7)&1;ce(M,$,I),se($,M),se(M,M),ce(M,$,I)}}function q(M,$){const A=[a(),a(),a(),a()];U(A[0],x),U(A[1],D),U(A[2],p),u(A[3],x,D),N(M,A,$)}function le(M){if(M.length!==n.SEED_LENGTH)throw new Error(`ed25519: seed must be ${n.SEED_LENGTH} bytes`);const $=(0,r.hash)(M);$[0]&=248,$[31]&=127,$[31]|=64;const A=new Uint8Array(32),h=[a(),a(),a(),a()];q(h,$),ge(A,h);const I=new Uint8Array(64);return I.set(M),I.set(A,32),{publicKey:A,secretKey:I}}n.generateKeyPairFromSeed=le;function te(M){const $=(0,t.randomBytes)(32,M),A=le($);return(0,s.wipe)($),A}n.generateKeyPair=te;function W(M){if(M.length!==n.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${n.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(M.subarray(32))}n.extractPublicKeyFromSecretKey=W;const ee=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function Y(M,$){let A,h,I,ne;for(h=63;h>=32;--h){for(A=0,I=h-32,ne=h-12;I<ne;++I)$[I]+=A-16*$[h]*ee[I-(h-32)],A=Math.floor(($[I]+128)/256),$[I]-=A*256;$[I]+=A,$[h]=0}for(A=0,I=0;I<32;I++)$[I]+=A-($[31]>>4)*ee[I],A=$[I]>>8,$[I]&=255;for(I=0;I<32;I++)$[I]-=A*ee[I];for(h=0;h<32;h++)$[h+1]+=$[h]>>8,M[h]=$[h]&255}function re(M){const $=new Float64Array(64);for(let A=0;A<64;A++)$[A]=M[A];for(let A=0;A<64;A++)M[A]=0;Y(M,$)}function Oe(M,$){const A=new Float64Array(64),h=[a(),a(),a(),a()],I=(0,r.hash)(M.subarray(0,32));I[0]&=248,I[31]&=127,I[31]|=64;const ne=new Uint8Array(64);ne.set(I.subarray(32),32);const fe=new r.SHA512;fe.update(ne.subarray(32)),fe.update($);const Ie=fe.digest();fe.clean(),re(Ie),q(h,Ie),ge(ne,h),fe.reset(),fe.update(ne.subarray(0,32)),fe.update(M.subarray(32)),fe.update($);const He=fe.digest();re(He);for(let Ve=0;Ve<32;Ve++)A[Ve]=Ie[Ve];for(let Ve=0;Ve<32;Ve++)for(let $e=0;$e<32;$e++)A[Ve+$e]+=He[Ve]*I[$e];return Y(ne.subarray(32),A),ne}n.sign=Oe;function ie(M,$){const A=a(),h=a(),I=a(),ne=a(),fe=a(),Ie=a(),He=a();return U(M[2],p),S(M[1],$),_(I,M[1]),u(ne,I,v),m(I,I,M[2]),P(ne,M[2],ne),_(fe,ne),_(Ie,fe),u(He,Ie,fe),u(A,He,I),u(A,A,ne),k(A,A),u(A,A,I),u(A,A,ne),u(A,A,ne),u(M[0],A,ne),_(h,M[0]),u(h,h,ne),C(h,I)&&u(M[0],M[0],j),_(h,M[0]),u(h,h,ne),C(h,I)?-1:(F(M[0])===$[31]>>7&&m(M[0],d,M[0]),u(M[3],M[0],M[1]),0)}function be(M,$,A){const h=new Uint8Array(32),I=[a(),a(),a(),a()],ne=[a(),a(),a(),a()];if(A.length!==n.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${n.SIGNATURE_LENGTH} bytes`);if(ie(ne,M))return!1;const fe=new r.SHA512;fe.update(A.subarray(0,32)),fe.update(M),fe.update($);const Ie=fe.digest();return re(Ie),N(I,ne,Ie),q(ne,A.subarray(32)),se(I,ne),ge(h,I),!oe(A,h)}n.verify=be;function he(M){let $=[a(),a(),a(),a()];if(ie($,M))throw new Error("Ed25519: invalid public key");let A=a(),h=a(),I=$[1];P(A,p,I),m(h,p,I),G(h,h),u(A,A,h);let ne=new Uint8Array(32);return B(ne,A),ne}n.convertPublicKeyToX25519=he;function _e(M){const $=(0,r.hash)(M.subarray(0,32));$[0]&=248,$[31]&=127,$[31]|=64;const A=new Uint8Array($.subarray(0,32));return(0,s.wipe)($),A}n.convertSecretKeyToX25519=_e})(nu);const ib="EdDSA",nb="JWT",dp=".",gp="base64url",sb="utf8",ob="utf8",ab=":",cb="did",ub="key",Xl="base58btc",hb="z",lb="K36",fb=32;function Do(n){return cr(yr(gs(n),sb),gp)}function vp(n){const t=yr(lb,Xl),r=hb+cr(jc([t,n]),Xl);return[cb,ub,r].join(ab)}function pb(n){return cr(n,gp)}function db(n){return yr([Do(n.header),Do(n.payload)].join(dp),ob)}function gb(n){return[Do(n.header),Do(n.payload),pb(n.signature)].join(dp)}function Zl(n=Un.randomBytes(fb)){return nu.generateKeyPairFromSeed(n)}async function vb(n,t,r,s,a=ye.fromMiliseconds(Date.now())){const l={alg:ib,typ:nb},d=vp(s.publicKey),p=a+r,v={iss:d,sub:n,aud:t,iat:a,exp:p},w=db({header:l,payload:v}),x=nu.sign(s.secretKey,w);return gb({header:l,payload:v,signature:x})}var su={},Ko={};Object.defineProperty(Ko,"__esModule",{value:!0});var Zt=Fe,Bc=xr,yb=20;function _b(n,t,r){for(var s=1634760805,a=857760878,l=2036477234,d=1797285236,p=r[3]<<24|r[2]<<16|r[1]<<8|r[0],v=r[7]<<24|r[6]<<16|r[5]<<8|r[4],w=r[11]<<24|r[10]<<16|r[9]<<8|r[8],x=r[15]<<24|r[14]<<16|r[13]<<8|r[12],D=r[19]<<24|r[18]<<16|r[17]<<8|r[16],j=r[23]<<24|r[22]<<16|r[21]<<8|r[20],U=r[27]<<24|r[26]<<16|r[25]<<8|r[24],z=r[31]<<24|r[30]<<16|r[29]<<8|r[28],K=t[3]<<24|t[2]<<16|t[1]<<8|t[0],B=t[7]<<24|t[6]<<16|t[5]<<8|t[4],oe=t[11]<<24|t[10]<<16|t[9]<<8|t[8],C=t[15]<<24|t[14]<<16|t[13]<<8|t[12],F=s,S=a,P=l,m=d,u=p,_=v,G=w,k=x,se=D,ce=j,ge=U,N=z,q=K,le=B,te=oe,W=C,ee=0;ee<yb;ee+=2)F=F+u|0,q^=F,q=q>>>32-16|q<<16,se=se+q|0,u^=se,u=u>>>32-12|u<<12,S=S+_|0,le^=S,le=le>>>32-16|le<<16,ce=ce+le|0,_^=ce,_=_>>>32-12|_<<12,P=P+G|0,te^=P,te=te>>>32-16|te<<16,ge=ge+te|0,G^=ge,G=G>>>32-12|G<<12,m=m+k|0,W^=m,W=W>>>32-16|W<<16,N=N+W|0,k^=N,k=k>>>32-12|k<<12,P=P+G|0,te^=P,te=te>>>32-8|te<<8,ge=ge+te|0,G^=ge,G=G>>>32-7|G<<7,m=m+k|0,W^=m,W=W>>>32-8|W<<8,N=N+W|0,k^=N,k=k>>>32-7|k<<7,S=S+_|0,le^=S,le=le>>>32-8|le<<8,ce=ce+le|0,_^=ce,_=_>>>32-7|_<<7,F=F+u|0,q^=F,q=q>>>32-8|q<<8,se=se+q|0,u^=se,u=u>>>32-7|u<<7,F=F+_|0,W^=F,W=W>>>32-16|W<<16,ge=ge+W|0,_^=ge,_=_>>>32-12|_<<12,S=S+G|0,q^=S,q=q>>>32-16|q<<16,N=N+q|0,G^=N,G=G>>>32-12|G<<12,P=P+k|0,le^=P,le=le>>>32-16|le<<16,se=se+le|0,k^=se,k=k>>>32-12|k<<12,m=m+u|0,te^=m,te=te>>>32-16|te<<16,ce=ce+te|0,u^=ce,u=u>>>32-12|u<<12,P=P+k|0,le^=P,le=le>>>32-8|le<<8,se=se+le|0,k^=se,k=k>>>32-7|k<<7,m=m+u|0,te^=m,te=te>>>32-8|te<<8,ce=ce+te|0,u^=ce,u=u>>>32-7|u<<7,S=S+G|0,q^=S,q=q>>>32-8|q<<8,N=N+q|0,G^=N,G=G>>>32-7|G<<7,F=F+_|0,W^=F,W=W>>>32-8|W<<8,ge=ge+W|0,_^=ge,_=_>>>32-7|_<<7;Zt.writeUint32LE(F+s|0,n,0),Zt.writeUint32LE(S+a|0,n,4),Zt.writeUint32LE(P+l|0,n,8),Zt.writeUint32LE(m+d|0,n,12),Zt.writeUint32LE(u+p|0,n,16),Zt.writeUint32LE(_+v|0,n,20),Zt.writeUint32LE(G+w|0,n,24),Zt.writeUint32LE(k+x|0,n,28),Zt.writeUint32LE(se+D|0,n,32),Zt.writeUint32LE(ce+j|0,n,36),Zt.writeUint32LE(ge+U|0,n,40),Zt.writeUint32LE(N+z|0,n,44),Zt.writeUint32LE(q+K|0,n,48),Zt.writeUint32LE(le+B|0,n,52),Zt.writeUint32LE(te+oe|0,n,56),Zt.writeUint32LE(W+C|0,n,60)}function yp(n,t,r,s,a){if(a===void 0&&(a=0),n.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(s.length<r.length)throw new Error("ChaCha: destination is shorter than source");var l,d;if(a===0){if(t.length!==8&&t.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");l=new Uint8Array(16),d=l.length-t.length,l.set(t,d)}else{if(t.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");l=t,d=a}for(var p=new Uint8Array(64),v=0;v<r.length;v+=64){_b(p,l,n);for(var w=v;w<v+64&&w<r.length;w++)s[w]=r[w]^p[w-v];bb(l,0,d)}return Bc.wipe(p),a===0&&Bc.wipe(l),s}Ko.streamXOR=yp;function mb(n,t,r,s){return s===void 0&&(s=0),Bc.wipe(r),yp(n,t,r,r,s)}Ko.stream=mb;function bb(n,t,r){for(var s=1;r--;)s=s+(n[t]&255)|0,n[t]=s&255,s>>>=8,t++;if(s>0)throw new Error("ChaCha: counter overflow")}var _p={},Ui={};Object.defineProperty(Ui,"__esModule",{value:!0});function wb(n,t,r){return~(n-1)&t|n-1&r}Ui.select=wb;function Eb(n,t){return(n|0)-(t|0)-1>>>31&1}Ui.lessOrEqual=Eb;function mp(n,t){if(n.length!==t.length)return 0;for(var r=0,s=0;s<n.length;s++)r|=n[s]^t[s];return 1&r-1>>>8}Ui.compare=mp;function Sb(n,t){return n.length===0||t.length===0?!1:mp(n,t)!==0}Ui.equal=Sb;(function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=Ui,r=xr;n.DIGEST_LENGTH=16;var s=function(){function d(p){this.digestLength=n.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var v=p[0]|p[1]<<8;this._r[0]=v&8191;var w=p[2]|p[3]<<8;this._r[1]=(v>>>13|w<<3)&8191;var x=p[4]|p[5]<<8;this._r[2]=(w>>>10|x<<6)&7939;var D=p[6]|p[7]<<8;this._r[3]=(x>>>7|D<<9)&8191;var j=p[8]|p[9]<<8;this._r[4]=(D>>>4|j<<12)&255,this._r[5]=j>>>1&8190;var U=p[10]|p[11]<<8;this._r[6]=(j>>>14|U<<2)&8191;var z=p[12]|p[13]<<8;this._r[7]=(U>>>11|z<<5)&8065;var K=p[14]|p[15]<<8;this._r[8]=(z>>>8|K<<8)&8191,this._r[9]=K>>>5&127,this._pad[0]=p[16]|p[17]<<8,this._pad[1]=p[18]|p[19]<<8,this._pad[2]=p[20]|p[21]<<8,this._pad[3]=p[22]|p[23]<<8,this._pad[4]=p[24]|p[25]<<8,this._pad[5]=p[26]|p[27]<<8,this._pad[6]=p[28]|p[29]<<8,this._pad[7]=p[30]|p[31]<<8}return d.prototype._blocks=function(p,v,w){for(var x=this._fin?0:2048,D=this._h[0],j=this._h[1],U=this._h[2],z=this._h[3],K=this._h[4],B=this._h[5],oe=this._h[6],C=this._h[7],F=this._h[8],S=this._h[9],P=this._r[0],m=this._r[1],u=this._r[2],_=this._r[3],G=this._r[4],k=this._r[5],se=this._r[6],ce=this._r[7],ge=this._r[8],N=this._r[9];w>=16;){var q=p[v+0]|p[v+1]<<8;D+=q&8191;var le=p[v+2]|p[v+3]<<8;j+=(q>>>13|le<<3)&8191;var te=p[v+4]|p[v+5]<<8;U+=(le>>>10|te<<6)&8191;var W=p[v+6]|p[v+7]<<8;z+=(te>>>7|W<<9)&8191;var ee=p[v+8]|p[v+9]<<8;K+=(W>>>4|ee<<12)&8191,B+=ee>>>1&8191;var Y=p[v+10]|p[v+11]<<8;oe+=(ee>>>14|Y<<2)&8191;var re=p[v+12]|p[v+13]<<8;C+=(Y>>>11|re<<5)&8191;var Oe=p[v+14]|p[v+15]<<8;F+=(re>>>8|Oe<<8)&8191,S+=Oe>>>5|x;var ie=0,be=ie;be+=D*P,be+=j*(5*N),be+=U*(5*ge),be+=z*(5*ce),be+=K*(5*se),ie=be>>>13,be&=8191,be+=B*(5*k),be+=oe*(5*G),be+=C*(5*_),be+=F*(5*u),be+=S*(5*m),ie+=be>>>13,be&=8191;var he=ie;he+=D*m,he+=j*P,he+=U*(5*N),he+=z*(5*ge),he+=K*(5*ce),ie=he>>>13,he&=8191,he+=B*(5*se),he+=oe*(5*k),he+=C*(5*G),he+=F*(5*_),he+=S*(5*u),ie+=he>>>13,he&=8191;var _e=ie;_e+=D*u,_e+=j*m,_e+=U*P,_e+=z*(5*N),_e+=K*(5*ge),ie=_e>>>13,_e&=8191,_e+=B*(5*ce),_e+=oe*(5*se),_e+=C*(5*k),_e+=F*(5*G),_e+=S*(5*_),ie+=_e>>>13,_e&=8191;var M=ie;M+=D*_,M+=j*u,M+=U*m,M+=z*P,M+=K*(5*N),ie=M>>>13,M&=8191,M+=B*(5*ge),M+=oe*(5*ce),M+=C*(5*se),M+=F*(5*k),M+=S*(5*G),ie+=M>>>13,M&=8191;var $=ie;$+=D*G,$+=j*_,$+=U*u,$+=z*m,$+=K*P,ie=$>>>13,$&=8191,$+=B*(5*N),$+=oe*(5*ge),$+=C*(5*ce),$+=F*(5*se),$+=S*(5*k),ie+=$>>>13,$&=8191;var A=ie;A+=D*k,A+=j*G,A+=U*_,A+=z*u,A+=K*m,ie=A>>>13,A&=8191,A+=B*P,A+=oe*(5*N),A+=C*(5*ge),A+=F*(5*ce),A+=S*(5*se),ie+=A>>>13,A&=8191;var h=ie;h+=D*se,h+=j*k,h+=U*G,h+=z*_,h+=K*u,ie=h>>>13,h&=8191,h+=B*m,h+=oe*P,h+=C*(5*N),h+=F*(5*ge),h+=S*(5*ce),ie+=h>>>13,h&=8191;var I=ie;I+=D*ce,I+=j*se,I+=U*k,I+=z*G,I+=K*_,ie=I>>>13,I&=8191,I+=B*u,I+=oe*m,I+=C*P,I+=F*(5*N),I+=S*(5*ge),ie+=I>>>13,I&=8191;var ne=ie;ne+=D*ge,ne+=j*ce,ne+=U*se,ne+=z*k,ne+=K*G,ie=ne>>>13,ne&=8191,ne+=B*_,ne+=oe*u,ne+=C*m,ne+=F*P,ne+=S*(5*N),ie+=ne>>>13,ne&=8191;var fe=ie;fe+=D*N,fe+=j*ge,fe+=U*ce,fe+=z*se,fe+=K*k,ie=fe>>>13,fe&=8191,fe+=B*G,fe+=oe*_,fe+=C*u,fe+=F*m,fe+=S*P,ie+=fe>>>13,fe&=8191,ie=(ie<<2)+ie|0,ie=ie+be|0,be=ie&8191,ie=ie>>>13,he+=ie,D=be,j=he,U=_e,z=M,K=$,B=A,oe=h,C=I,F=ne,S=fe,v+=16,w-=16}this._h[0]=D,this._h[1]=j,this._h[2]=U,this._h[3]=z,this._h[4]=K,this._h[5]=B,this._h[6]=oe,this._h[7]=C,this._h[8]=F,this._h[9]=S},d.prototype.finish=function(p,v){v===void 0&&(v=0);var w=new Uint16Array(10),x,D,j,U;if(this._leftover){for(U=this._leftover,this._buffer[U++]=1;U<16;U++)this._buffer[U]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(x=this._h[1]>>>13,this._h[1]&=8191,U=2;U<10;U++)this._h[U]+=x,x=this._h[U]>>>13,this._h[U]&=8191;for(this._h[0]+=x*5,x=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=x,x=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=x,w[0]=this._h[0]+5,x=w[0]>>>13,w[0]&=8191,U=1;U<10;U++)w[U]=this._h[U]+x,x=w[U]>>>13,w[U]&=8191;for(w[9]-=1<<13,D=(x^1)-1,U=0;U<10;U++)w[U]&=D;for(D=~D,U=0;U<10;U++)this._h[U]=this._h[U]&D|w[U];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,j=this._h[0]+this._pad[0],this._h[0]=j&65535,U=1;U<8;U++)j=(this._h[U]+this._pad[U]|0)+(j>>>16)|0,this._h[U]=j&65535;return p[v+0]=this._h[0]>>>0,p[v+1]=this._h[0]>>>8,p[v+2]=this._h[1]>>>0,p[v+3]=this._h[1]>>>8,p[v+4]=this._h[2]>>>0,p[v+5]=this._h[2]>>>8,p[v+6]=this._h[3]>>>0,p[v+7]=this._h[3]>>>8,p[v+8]=this._h[4]>>>0,p[v+9]=this._h[4]>>>8,p[v+10]=this._h[5]>>>0,p[v+11]=this._h[5]>>>8,p[v+12]=this._h[6]>>>0,p[v+13]=this._h[6]>>>8,p[v+14]=this._h[7]>>>0,p[v+15]=this._h[7]>>>8,this._finished=!0,this},d.prototype.update=function(p){var v=0,w=p.length,x;if(this._leftover){x=16-this._leftover,x>w&&(x=w);for(var D=0;D<x;D++)this._buffer[this._leftover+D]=p[v+D];if(w-=x,v+=x,this._leftover+=x,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(w>=16&&(x=w-w%16,this._blocks(p,v,x),v+=x,w-=x),w){for(var D=0;D<w;D++)this._buffer[this._leftover+D]=p[v+D];this._leftover+=w}return this},d.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var p=new Uint8Array(16);return this.finish(p),p},d.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},d}();n.Poly1305=s;function a(d,p){var v=new s(d);v.update(p);var w=v.digest();return v.clean(),w}n.oneTimeAuth=a;function l(d,p){return d.length!==n.DIGEST_LENGTH||p.length!==n.DIGEST_LENGTH?!1:t.equal(d,p)}n.equal=l})(_p);(function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=Ko,r=_p,s=xr,a=Fe,l=Ui;n.KEY_LENGTH=32,n.NONCE_LENGTH=12,n.TAG_LENGTH=16;var d=new Uint8Array(16),p=function(){function v(w){if(this.nonceLength=n.NONCE_LENGTH,this.tagLength=n.TAG_LENGTH,w.length!==n.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(w)}return v.prototype.seal=function(w,x,D,j){if(w.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var U=new Uint8Array(16);U.set(w,U.length-w.length);var z=new Uint8Array(32);t.stream(this._key,U,z,4);var K=x.length+this.tagLength,B;if(j){if(j.length!==K)throw new Error("ChaCha20Poly1305: incorrect destination length");B=j}else B=new Uint8Array(K);return t.streamXOR(this._key,U,x,B,4),this._authenticate(B.subarray(B.length-this.tagLength,B.length),z,B.subarray(0,B.length-this.tagLength),D),s.wipe(U),B},v.prototype.open=function(w,x,D,j){if(w.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(x.length<this.tagLength)return null;var U=new Uint8Array(16);U.set(w,U.length-w.length);var z=new Uint8Array(32);t.stream(this._key,U,z,4);var K=new Uint8Array(this.tagLength);if(this._authenticate(K,z,x.subarray(0,x.length-this.tagLength),D),!l.equal(K,x.subarray(x.length-this.tagLength,x.length)))return null;var B=x.length-this.tagLength,oe;if(j){if(j.length!==B)throw new Error("ChaCha20Poly1305: incorrect destination length");oe=j}else oe=new Uint8Array(B);return t.streamXOR(this._key,U,x.subarray(0,x.length-this.tagLength),oe,4),s.wipe(U),oe},v.prototype.clean=function(){return s.wipe(this._key),this},v.prototype._authenticate=function(w,x,D,j){var U=new r.Poly1305(x);j&&(U.update(j),j.length%16>0&&U.update(d.subarray(j.length%16))),U.update(D),D.length%16>0&&U.update(d.subarray(D.length%16));var z=new Uint8Array(8);j&&a.writeUint64LE(j.length,z),U.update(z),a.writeUint64LE(D.length,z),U.update(z);for(var K=U.digest(),B=0;B<K.length;B++)w[B]=K[B];U.clean(),s.wipe(K),s.wipe(z)},v}();n.ChaCha20Poly1305=p})(su);var bp={},_s={},ou={};Object.defineProperty(ou,"__esModule",{value:!0});function Ib(n){return typeof n.saveState<"u"&&typeof n.restoreState<"u"&&typeof n.cleanSavedState<"u"}ou.isSerializableHash=Ib;Object.defineProperty(_s,"__esModule",{value:!0});var ei=ou,xb=Ui,Ob=xr,wp=function(){function n(t,r){this._finished=!1,this._inner=new t,this._outer=new t,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var s=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(s).clean():s.set(r);for(var a=0;a<s.length;a++)s[a]^=54;this._inner.update(s);for(var a=0;a<s.length;a++)s[a]^=106;this._outer.update(s),ei.isSerializableHash(this._inner)&&ei.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),Ob.wipe(s)}return n.prototype.reset=function(){if(!ei.isSerializableHash(this._inner)||!ei.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},n.prototype.clean=function(){ei.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),ei.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},n.prototype.update=function(t){return this._inner.update(t),this},n.prototype.finish=function(t){return this._finished?(this._outer.finish(t),this):(this._inner.finish(t),this._outer.update(t.subarray(0,this.digestLength)).finish(t),this._finished=!0,this)},n.prototype.digest=function(){var t=new Uint8Array(this.digestLength);return this.finish(t),t},n.prototype.saveState=function(){if(!ei.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},n.prototype.restoreState=function(t){if(!ei.isSerializableHash(this._inner)||!ei.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(t),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},n.prototype.cleanSavedState=function(t){if(!ei.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(t)},n}();_s.HMAC=wp;function Pb(n,t,r){var s=new wp(n,t);s.update(r);var a=s.digest();return s.clean(),a}_s.hmac=Pb;_s.equal=xb.equal;Object.defineProperty(bp,"__esModule",{value:!0});var Ql=_s,ef=xr,Ab=function(){function n(t,r,s,a){s===void 0&&(s=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=t,this._info=a;var l=Ql.hmac(this._hash,s,r);this._hmac=new Ql.HMAC(t,l),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return n.prototype._fillBuffer=function(){this._counter[0]++;var t=this._counter[0];if(t===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),t>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},n.prototype.expand=function(t){for(var r=new Uint8Array(t),s=0;s<r.length;s++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[s]=this._buffer[this._bufpos++];return r},n.prototype.clean=function(){this._hmac.clean(),ef.wipe(this._buffer),ef.wipe(this._counter),this._bufpos=0},n}(),Cb=bp.HKDF=Ab,Bo={};(function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=Fe,r=xr;n.DIGEST_LENGTH=32,n.BLOCK_SIZE=64;var s=function(){function p(){this.digestLength=n.DIGEST_LENGTH,this.blockSize=n.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return p.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},p.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},p.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},p.prototype.update=function(v,w){if(w===void 0&&(w=v.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var x=0;if(this._bytesHashed+=w,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&w>0;)this._buffer[this._bufferLength++]=v[x++],w--;this._bufferLength===this.blockSize&&(l(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(w>=this.blockSize&&(x=l(this._temp,this._state,v,x,w),w%=this.blockSize);w>0;)this._buffer[this._bufferLength++]=v[x++],w--;return this},p.prototype.finish=function(v){if(!this._finished){var w=this._bytesHashed,x=this._bufferLength,D=w/536870912|0,j=w<<3,U=w%64<56?64:128;this._buffer[x]=128;for(var z=x+1;z<U-8;z++)this._buffer[z]=0;t.writeUint32BE(D,this._buffer,U-8),t.writeUint32BE(j,this._buffer,U-4),l(this._temp,this._state,this._buffer,0,U),this._finished=!0}for(var z=0;z<this.digestLength/4;z++)t.writeUint32BE(this._state[z],v,z*4);return this},p.prototype.digest=function(){var v=new Uint8Array(this.digestLength);return this.finish(v),v},p.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},p.prototype.restoreState=function(v){return this._state.set(v.state),this._bufferLength=v.bufferLength,v.buffer&&this._buffer.set(v.buffer),this._bytesHashed=v.bytesHashed,this._finished=!1,this},p.prototype.cleanSavedState=function(v){r.wipe(v.state),v.buffer&&r.wipe(v.buffer),v.bufferLength=0,v.bytesHashed=0},p}();n.SHA256=s;var a=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function l(p,v,w,x,D){for(;D>=64;){for(var j=v[0],U=v[1],z=v[2],K=v[3],B=v[4],oe=v[5],C=v[6],F=v[7],S=0;S<16;S++){var P=x+S*4;p[S]=t.readUint32BE(w,P)}for(var S=16;S<64;S++){var m=p[S-2],u=(m>>>17|m<<32-17)^(m>>>19|m<<32-19)^m>>>10;m=p[S-15];var _=(m>>>7|m<<32-7)^(m>>>18|m<<32-18)^m>>>3;p[S]=(u+p[S-7]|0)+(_+p[S-16]|0)}for(var S=0;S<64;S++){var u=(((B>>>6|B<<26)^(B>>>11|B<<21)^(B>>>25|B<<7))+(B&oe^~B&C)|0)+(F+(a[S]+p[S]|0)|0)|0,_=((j>>>2|j<<32-2)^(j>>>13|j<<32-13)^(j>>>22|j<<32-22))+(j&U^j&z^U&z)|0;F=C,C=oe,oe=B,B=K+u|0,K=z,z=U,U=j,j=u+_|0}v[0]+=j,v[1]+=U,v[2]+=z,v[3]+=K,v[4]+=B,v[5]+=oe,v[6]+=C,v[7]+=F,x+=64,D-=64}return x}function d(p){var v=new s;v.update(p);var w=v.digest();return v.clean(),w}n.hash=d})(Bo);var au={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.sharedKey=n.generateKeyPair=n.generateKeyPairFromSeed=n.scalarMultBase=n.scalarMult=n.SHARED_KEY_LENGTH=n.SECRET_KEY_LENGTH=n.PUBLIC_KEY_LENGTH=void 0;const t=Un,r=xr;n.PUBLIC_KEY_LENGTH=32,n.SECRET_KEY_LENGTH=32,n.SHARED_KEY_LENGTH=32;function s(S){const P=new Float64Array(16);if(S)for(let m=0;m<S.length;m++)P[m]=S[m];return P}const a=new Uint8Array(32);a[0]=9;const l=s([56129,1]);function d(S){let P=1;for(let m=0;m<16;m++){let u=S[m]+P+65535;P=Math.floor(u/65536),S[m]=u-P*65536}S[0]+=P-1+37*(P-1)}function p(S,P,m){const u=~(m-1);for(let _=0;_<16;_++){const G=u&(S[_]^P[_]);S[_]^=G,P[_]^=G}}function v(S,P){const m=s(),u=s();for(let _=0;_<16;_++)u[_]=P[_];d(u),d(u),d(u);for(let _=0;_<2;_++){m[0]=u[0]-65517;for(let k=1;k<15;k++)m[k]=u[k]-65535-(m[k-1]>>16&1),m[k-1]&=65535;m[15]=u[15]-32767-(m[14]>>16&1);const G=m[15]>>16&1;m[14]&=65535,p(u,m,1-G)}for(let _=0;_<16;_++)S[2*_]=u[_]&255,S[2*_+1]=u[_]>>8}function w(S,P){for(let m=0;m<16;m++)S[m]=P[2*m]+(P[2*m+1]<<8);S[15]&=32767}function x(S,P,m){for(let u=0;u<16;u++)S[u]=P[u]+m[u]}function D(S,P,m){for(let u=0;u<16;u++)S[u]=P[u]-m[u]}function j(S,P,m){let u,_,G=0,k=0,se=0,ce=0,ge=0,N=0,q=0,le=0,te=0,W=0,ee=0,Y=0,re=0,Oe=0,ie=0,be=0,he=0,_e=0,M=0,$=0,A=0,h=0,I=0,ne=0,fe=0,Ie=0,He=0,Ve=0,$e=0,dt=0,gt=0,je=m[0],xe=m[1],Ue=m[2],De=m[3],qe=m[4],Ae=m[5],Le=m[6],Se=m[7],Ce=m[8],Ke=m[9],Pe=m[10],ke=m[11],We=m[12],et=m[13],tt=m[14],Je=m[15];u=P[0],G+=u*je,k+=u*xe,se+=u*Ue,ce+=u*De,ge+=u*qe,N+=u*Ae,q+=u*Le,le+=u*Se,te+=u*Ce,W+=u*Ke,ee+=u*Pe,Y+=u*ke,re+=u*We,Oe+=u*et,ie+=u*tt,be+=u*Je,u=P[1],k+=u*je,se+=u*xe,ce+=u*Ue,ge+=u*De,N+=u*qe,q+=u*Ae,le+=u*Le,te+=u*Se,W+=u*Ce,ee+=u*Ke,Y+=u*Pe,re+=u*ke,Oe+=u*We,ie+=u*et,be+=u*tt,he+=u*Je,u=P[2],se+=u*je,ce+=u*xe,ge+=u*Ue,N+=u*De,q+=u*qe,le+=u*Ae,te+=u*Le,W+=u*Se,ee+=u*Ce,Y+=u*Ke,re+=u*Pe,Oe+=u*ke,ie+=u*We,be+=u*et,he+=u*tt,_e+=u*Je,u=P[3],ce+=u*je,ge+=u*xe,N+=u*Ue,q+=u*De,le+=u*qe,te+=u*Ae,W+=u*Le,ee+=u*Se,Y+=u*Ce,re+=u*Ke,Oe+=u*Pe,ie+=u*ke,be+=u*We,he+=u*et,_e+=u*tt,M+=u*Je,u=P[4],ge+=u*je,N+=u*xe,q+=u*Ue,le+=u*De,te+=u*qe,W+=u*Ae,ee+=u*Le,Y+=u*Se,re+=u*Ce,Oe+=u*Ke,ie+=u*Pe,be+=u*ke,he+=u*We,_e+=u*et,M+=u*tt,$+=u*Je,u=P[5],N+=u*je,q+=u*xe,le+=u*Ue,te+=u*De,W+=u*qe,ee+=u*Ae,Y+=u*Le,re+=u*Se,Oe+=u*Ce,ie+=u*Ke,be+=u*Pe,he+=u*ke,_e+=u*We,M+=u*et,$+=u*tt,A+=u*Je,u=P[6],q+=u*je,le+=u*xe,te+=u*Ue,W+=u*De,ee+=u*qe,Y+=u*Ae,re+=u*Le,Oe+=u*Se,ie+=u*Ce,be+=u*Ke,he+=u*Pe,_e+=u*ke,M+=u*We,$+=u*et,A+=u*tt,h+=u*Je,u=P[7],le+=u*je,te+=u*xe,W+=u*Ue,ee+=u*De,Y+=u*qe,re+=u*Ae,Oe+=u*Le,ie+=u*Se,be+=u*Ce,he+=u*Ke,_e+=u*Pe,M+=u*ke,$+=u*We,A+=u*et,h+=u*tt,I+=u*Je,u=P[8],te+=u*je,W+=u*xe,ee+=u*Ue,Y+=u*De,re+=u*qe,Oe+=u*Ae,ie+=u*Le,be+=u*Se,he+=u*Ce,_e+=u*Ke,M+=u*Pe,$+=u*ke,A+=u*We,h+=u*et,I+=u*tt,ne+=u*Je,u=P[9],W+=u*je,ee+=u*xe,Y+=u*Ue,re+=u*De,Oe+=u*qe,ie+=u*Ae,be+=u*Le,he+=u*Se,_e+=u*Ce,M+=u*Ke,$+=u*Pe,A+=u*ke,h+=u*We,I+=u*et,ne+=u*tt,fe+=u*Je,u=P[10],ee+=u*je,Y+=u*xe,re+=u*Ue,Oe+=u*De,ie+=u*qe,be+=u*Ae,he+=u*Le,_e+=u*Se,M+=u*Ce,$+=u*Ke,A+=u*Pe,h+=u*ke,I+=u*We,ne+=u*et,fe+=u*tt,Ie+=u*Je,u=P[11],Y+=u*je,re+=u*xe,Oe+=u*Ue,ie+=u*De,be+=u*qe,he+=u*Ae,_e+=u*Le,M+=u*Se,$+=u*Ce,A+=u*Ke,h+=u*Pe,I+=u*ke,ne+=u*We,fe+=u*et,Ie+=u*tt,He+=u*Je,u=P[12],re+=u*je,Oe+=u*xe,ie+=u*Ue,be+=u*De,he+=u*qe,_e+=u*Ae,M+=u*Le,$+=u*Se,A+=u*Ce,h+=u*Ke,I+=u*Pe,ne+=u*ke,fe+=u*We,Ie+=u*et,He+=u*tt,Ve+=u*Je,u=P[13],Oe+=u*je,ie+=u*xe,be+=u*Ue,he+=u*De,_e+=u*qe,M+=u*Ae,$+=u*Le,A+=u*Se,h+=u*Ce,I+=u*Ke,ne+=u*Pe,fe+=u*ke,Ie+=u*We,He+=u*et,Ve+=u*tt,$e+=u*Je,u=P[14],ie+=u*je,be+=u*xe,he+=u*Ue,_e+=u*De,M+=u*qe,$+=u*Ae,A+=u*Le,h+=u*Se,I+=u*Ce,ne+=u*Ke,fe+=u*Pe,Ie+=u*ke,He+=u*We,Ve+=u*et,$e+=u*tt,dt+=u*Je,u=P[15],be+=u*je,he+=u*xe,_e+=u*Ue,M+=u*De,$+=u*qe,A+=u*Ae,h+=u*Le,I+=u*Se,ne+=u*Ce,fe+=u*Ke,Ie+=u*Pe,He+=u*ke,Ve+=u*We,$e+=u*et,dt+=u*tt,gt+=u*Je,G+=38*he,k+=38*_e,se+=38*M,ce+=38*$,ge+=38*A,N+=38*h,q+=38*I,le+=38*ne,te+=38*fe,W+=38*Ie,ee+=38*He,Y+=38*Ve,re+=38*$e,Oe+=38*dt,ie+=38*gt,_=1,u=G+_+65535,_=Math.floor(u/65536),G=u-_*65536,u=k+_+65535,_=Math.floor(u/65536),k=u-_*65536,u=se+_+65535,_=Math.floor(u/65536),se=u-_*65536,u=ce+_+65535,_=Math.floor(u/65536),ce=u-_*65536,u=ge+_+65535,_=Math.floor(u/65536),ge=u-_*65536,u=N+_+65535,_=Math.floor(u/65536),N=u-_*65536,u=q+_+65535,_=Math.floor(u/65536),q=u-_*65536,u=le+_+65535,_=Math.floor(u/65536),le=u-_*65536,u=te+_+65535,_=Math.floor(u/65536),te=u-_*65536,u=W+_+65535,_=Math.floor(u/65536),W=u-_*65536,u=ee+_+65535,_=Math.floor(u/65536),ee=u-_*65536,u=Y+_+65535,_=Math.floor(u/65536),Y=u-_*65536,u=re+_+65535,_=Math.floor(u/65536),re=u-_*65536,u=Oe+_+65535,_=Math.floor(u/65536),Oe=u-_*65536,u=ie+_+65535,_=Math.floor(u/65536),ie=u-_*65536,u=be+_+65535,_=Math.floor(u/65536),be=u-_*65536,G+=_-1+37*(_-1),_=1,u=G+_+65535,_=Math.floor(u/65536),G=u-_*65536,u=k+_+65535,_=Math.floor(u/65536),k=u-_*65536,u=se+_+65535,_=Math.floor(u/65536),se=u-_*65536,u=ce+_+65535,_=Math.floor(u/65536),ce=u-_*65536,u=ge+_+65535,_=Math.floor(u/65536),ge=u-_*65536,u=N+_+65535,_=Math.floor(u/65536),N=u-_*65536,u=q+_+65535,_=Math.floor(u/65536),q=u-_*65536,u=le+_+65535,_=Math.floor(u/65536),le=u-_*65536,u=te+_+65535,_=Math.floor(u/65536),te=u-_*65536,u=W+_+65535,_=Math.floor(u/65536),W=u-_*65536,u=ee+_+65535,_=Math.floor(u/65536),ee=u-_*65536,u=Y+_+65535,_=Math.floor(u/65536),Y=u-_*65536,u=re+_+65535,_=Math.floor(u/65536),re=u-_*65536,u=Oe+_+65535,_=Math.floor(u/65536),Oe=u-_*65536,u=ie+_+65535,_=Math.floor(u/65536),ie=u-_*65536,u=be+_+65535,_=Math.floor(u/65536),be=u-_*65536,G+=_-1+37*(_-1),S[0]=G,S[1]=k,S[2]=se,S[3]=ce,S[4]=ge,S[5]=N,S[6]=q,S[7]=le,S[8]=te,S[9]=W,S[10]=ee,S[11]=Y,S[12]=re,S[13]=Oe,S[14]=ie,S[15]=be}function U(S,P){j(S,P,P)}function z(S,P){const m=s();for(let u=0;u<16;u++)m[u]=P[u];for(let u=253;u>=0;u--)U(m,m),u!==2&&u!==4&&j(m,m,P);for(let u=0;u<16;u++)S[u]=m[u]}function K(S,P){const m=new Uint8Array(32),u=new Float64Array(80),_=s(),G=s(),k=s(),se=s(),ce=s(),ge=s();for(let te=0;te<31;te++)m[te]=S[te];m[31]=S[31]&127|64,m[0]&=248,w(u,P);for(let te=0;te<16;te++)G[te]=u[te];_[0]=se[0]=1;for(let te=254;te>=0;--te){const W=m[te>>>3]>>>(te&7)&1;p(_,G,W),p(k,se,W),x(ce,_,k),D(_,_,k),x(k,G,se),D(G,G,se),U(se,ce),U(ge,_),j(_,k,_),j(k,G,ce),x(ce,_,k),D(_,_,k),U(G,_),D(k,se,ge),j(_,k,l),x(_,_,se),j(k,k,_),j(_,se,ge),j(se,G,u),U(G,ce),p(_,G,W),p(k,se,W)}for(let te=0;te<16;te++)u[te+16]=_[te],u[te+32]=k[te],u[te+48]=G[te],u[te+64]=se[te];const N=u.subarray(32),q=u.subarray(16);z(N,N),j(q,q,N);const le=new Uint8Array(32);return v(le,q),le}n.scalarMult=K;function B(S){return K(S,a)}n.scalarMultBase=B;function oe(S){if(S.length!==n.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${n.SECRET_KEY_LENGTH} bytes`);const P=new Uint8Array(S);return{publicKey:B(P),secretKey:P}}n.generateKeyPairFromSeed=oe;function C(S){const P=(0,t.randomBytes)(32,S),m=oe(P);return(0,r.wipe)(P),m}n.generateKeyPair=C;function F(S,P,m=!1){if(S.length!==n.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(P.length!==n.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const u=K(S,P);if(m){let _=0;for(let G=0;G<u.length;G++)_|=u[G];if(_===0)throw new Error("X25519: invalid shared key")}return u}n.sharedKey=F})(au);var lt={};Object.defineProperty(lt,"__esModule",{value:!0});lt.getLocalStorage=lt.getLocalStorageOrThrow=lt.getCrypto=lt.getCryptoOrThrow=Sp=lt.getLocation=lt.getLocationOrThrow=cu=lt.getNavigator=lt.getNavigatorOrThrow=Ep=lt.getDocument=lt.getDocumentOrThrow=lt.getFromWindowOrThrow=lt.getFromWindow=void 0;function rn(n){let t;return typeof window<"u"&&typeof window[n]<"u"&&(t=window[n]),t}lt.getFromWindow=rn;function Dn(n){const t=rn(n);if(!t)throw new Error(`${n} is not defined in Window`);return t}lt.getFromWindowOrThrow=Dn;function Nb(){return Dn("document")}lt.getDocumentOrThrow=Nb;function Tb(){return rn("document")}var Ep=lt.getDocument=Tb;function Rb(){return Dn("navigator")}lt.getNavigatorOrThrow=Rb;function Ub(){return rn("navigator")}var cu=lt.getNavigator=Ub;function Db(){return Dn("location")}lt.getLocationOrThrow=Db;function Lb(){return rn("location")}var Sp=lt.getLocation=Lb;function Fb(){return Dn("crypto")}lt.getCryptoOrThrow=Fb;function $b(){return rn("crypto")}lt.getCrypto=$b;function Mb(){return Dn("localStorage")}lt.getLocalStorageOrThrow=Mb;function jb(){return rn("localStorage")}lt.getLocalStorage=jb;var uu={};Object.defineProperty(uu,"__esModule",{value:!0});var Ip=uu.getWindowMetadata=void 0;const tf=lt;function qb(){let n,t;try{n=tf.getDocumentOrThrow(),t=tf.getLocationOrThrow()}catch{return null}function r(){const D=n.getElementsByTagName("link"),j=[];for(let U=0;U<D.length;U++){const z=D[U],K=z.getAttribute("rel");if(K&&K.toLowerCase().indexOf("icon")>-1){const B=z.getAttribute("href");if(B)if(B.toLowerCase().indexOf("https:")===-1&&B.toLowerCase().indexOf("http:")===-1&&B.indexOf("//")!==0){let oe=t.protocol+"//"+t.host;if(B.indexOf("/")===0)oe+=B;else{const C=t.pathname.split("/");C.pop();const F=C.join("/");oe+=F+"/"+B}j.push(oe)}else if(B.indexOf("//")===0){const oe=t.protocol+B;j.push(oe)}else j.push(B)}}return j}function s(...D){const j=n.getElementsByTagName("meta");for(let U=0;U<j.length;U++){const z=j[U],K=["itemprop","property","name"].map(B=>z.getAttribute(B)).filter(B=>B?D.includes(B):!1);if(K.length&&K){const B=z.getAttribute("content");if(B)return B}}return""}function a(){let D=s("name","og:site_name","og:title","twitter:title");return D||(D=n.title),D}function l(){return s("description","og:description","twitter:description","keywords")}const d=a(),p=l(),v=t.origin,w=r();return{description:p,url:v,icons:w,name:d}}Ip=uu.getWindowMetadata=qb;var vs={},zb=n=>encodeURIComponent(n).replace(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`),xp="%[a-f0-9]{2}",rf=new RegExp("("+xp+")|([^%]+?)","gi"),nf=new RegExp("("+xp+")+","gi");function Vc(n,t){try{return[decodeURIComponent(n.join(""))]}catch{}if(n.length===1)return n;t=t||1;var r=n.slice(0,t),s=n.slice(t);return Array.prototype.concat.call([],Vc(r),Vc(s))}function Hb(n){try{return decodeURIComponent(n)}catch{for(var t=n.match(rf)||[],r=1;r<t.length;r++)n=Vc(t,r).join(""),t=n.match(rf)||[];return n}}function Kb(n){for(var t={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},r=nf.exec(n);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch{var s=Hb(r[0]);s!==r[0]&&(t[r[0]]=s)}r=nf.exec(n)}t["%C2"]="\uFFFD";for(var a=Object.keys(t),l=0;l<a.length;l++){var d=a[l];n=n.replace(new RegExp(d,"g"),t[d])}return n}var Bb=function(n){if(typeof n!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof n+"`");try{return n=n.replace(/\+/g," "),decodeURIComponent(n)}catch{return Kb(n)}},Vb=(n,t)=>{if(!(typeof n=="string"&&typeof t=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(t==="")return[n];const r=n.indexOf(t);return r===-1?[n]:[n.slice(0,r),n.slice(r+t.length)]},kb=function(n,t){for(var r={},s=Object.keys(n),a=Array.isArray(t),l=0;l<s.length;l++){var d=s[l],p=n[d];(a?t.indexOf(d)!==-1:t(d,p,n))&&(r[d]=p)}return r};(function(n){const t=zb,r=Bb,s=Vb,a=kb,l=C=>C==null,d=Symbol("encodeFragmentIdentifier");function p(C){switch(C.arrayFormat){case"index":return F=>(S,P)=>{const m=S.length;return P===void 0||C.skipNull&&P===null||C.skipEmptyString&&P===""?S:P===null?[...S,[x(F,C),"[",m,"]"].join("")]:[...S,[x(F,C),"[",x(m,C),"]=",x(P,C)].join("")]};case"bracket":return F=>(S,P)=>P===void 0||C.skipNull&&P===null||C.skipEmptyString&&P===""?S:P===null?[...S,[x(F,C),"[]"].join("")]:[...S,[x(F,C),"[]=",x(P,C)].join("")];case"colon-list-separator":return F=>(S,P)=>P===void 0||C.skipNull&&P===null||C.skipEmptyString&&P===""?S:P===null?[...S,[x(F,C),":list="].join("")]:[...S,[x(F,C),":list=",x(P,C)].join("")];case"comma":case"separator":case"bracket-separator":{const F=C.arrayFormat==="bracket-separator"?"[]=":"=";return S=>(P,m)=>m===void 0||C.skipNull&&m===null||C.skipEmptyString&&m===""?P:(m=m===null?"":m,P.length===0?[[x(S,C),F,x(m,C)].join("")]:[[P,x(m,C)].join(C.arrayFormatSeparator)])}default:return F=>(S,P)=>P===void 0||C.skipNull&&P===null||C.skipEmptyString&&P===""?S:P===null?[...S,x(F,C)]:[...S,[x(F,C),"=",x(P,C)].join("")]}}function v(C){let F;switch(C.arrayFormat){case"index":return(S,P,m)=>{if(F=/\[(\d*)\]$/.exec(S),S=S.replace(/\[\d*\]$/,""),!F){m[S]=P;return}m[S]===void 0&&(m[S]={}),m[S][F[1]]=P};case"bracket":return(S,P,m)=>{if(F=/(\[\])$/.exec(S),S=S.replace(/\[\]$/,""),!F){m[S]=P;return}if(m[S]===void 0){m[S]=[P];return}m[S]=[].concat(m[S],P)};case"colon-list-separator":return(S,P,m)=>{if(F=/(:list)$/.exec(S),S=S.replace(/:list$/,""),!F){m[S]=P;return}if(m[S]===void 0){m[S]=[P];return}m[S]=[].concat(m[S],P)};case"comma":case"separator":return(S,P,m)=>{const u=typeof P=="string"&&P.includes(C.arrayFormatSeparator),_=typeof P=="string"&&!u&&D(P,C).includes(C.arrayFormatSeparator);P=_?D(P,C):P;const G=u||_?P.split(C.arrayFormatSeparator).map(k=>D(k,C)):P===null?P:D(P,C);m[S]=G};case"bracket-separator":return(S,P,m)=>{const u=/(\[\])$/.test(S);if(S=S.replace(/\[\]$/,""),!u){m[S]=P&&D(P,C);return}const _=P===null?[]:P.split(C.arrayFormatSeparator).map(G=>D(G,C));if(m[S]===void 0){m[S]=_;return}m[S]=[].concat(m[S],_)};default:return(S,P,m)=>{if(m[S]===void 0){m[S]=P;return}m[S]=[].concat(m[S],P)}}}function w(C){if(typeof C!="string"||C.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function x(C,F){return F.encode?F.strict?t(C):encodeURIComponent(C):C}function D(C,F){return F.decode?r(C):C}function j(C){return Array.isArray(C)?C.sort():typeof C=="object"?j(Object.keys(C)).sort((F,S)=>Number(F)-Number(S)).map(F=>C[F]):C}function U(C){const F=C.indexOf("#");return F!==-1&&(C=C.slice(0,F)),C}function z(C){let F="";const S=C.indexOf("#");return S!==-1&&(F=C.slice(S)),F}function K(C){C=U(C);const F=C.indexOf("?");return F===-1?"":C.slice(F+1)}function B(C,F){return F.parseNumbers&&!Number.isNaN(Number(C))&&typeof C=="string"&&C.trim()!==""?C=Number(C):F.parseBooleans&&C!==null&&(C.toLowerCase()==="true"||C.toLowerCase()==="false")&&(C=C.toLowerCase()==="true"),C}function oe(C,F){F=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},F),w(F.arrayFormatSeparator);const S=v(F),P=Object.create(null);if(typeof C!="string"||(C=C.trim().replace(/^[?#&]/,""),!C))return P;for(const m of C.split("&")){if(m==="")continue;let[u,_]=s(F.decode?m.replace(/\+/g," "):m,"=");_=_===void 0?null:["comma","separator","bracket-separator"].includes(F.arrayFormat)?_:D(_,F),S(D(u,F),_,P)}for(const m of Object.keys(P)){const u=P[m];if(typeof u=="object"&&u!==null)for(const _ of Object.keys(u))u[_]=B(u[_],F);else P[m]=B(u,F)}return F.sort===!1?P:(F.sort===!0?Object.keys(P).sort():Object.keys(P).sort(F.sort)).reduce((m,u)=>{const _=P[u];return Boolean(_)&&typeof _=="object"&&!Array.isArray(_)?m[u]=j(_):m[u]=_,m},Object.create(null))}n.extract=K,n.parse=oe,n.stringify=(C,F)=>{if(!C)return"";F=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},F),w(F.arrayFormatSeparator);const S=_=>F.skipNull&&l(C[_])||F.skipEmptyString&&C[_]==="",P=p(F),m={};for(const _ of Object.keys(C))S(_)||(m[_]=C[_]);const u=Object.keys(m);return F.sort!==!1&&u.sort(F.sort),u.map(_=>{const G=C[_];return G===void 0?"":G===null?x(_,F):Array.isArray(G)?G.length===0&&F.arrayFormat==="bracket-separator"?x(_,F)+"[]":G.reduce(P(_),[]).join("&"):x(_,F)+"="+x(G,F)}).filter(_=>_.length>0).join("&")},n.parseUrl=(C,F)=>{F=Object.assign({decode:!0},F);const[S,P]=s(C,"#");return Object.assign({url:S.split("?")[0]||"",query:oe(K(C),F)},F&&F.parseFragmentIdentifier&&P?{fragmentIdentifier:D(P,F)}:{})},n.stringifyUrl=(C,F)=>{F=Object.assign({encode:!0,strict:!0,[d]:!0},F);const S=U(C.url).split("?")[0]||"",P=n.extract(C.url),m=n.parse(P,{sort:!1}),u=Object.assign(m,C.query);let _=n.stringify(u,F);_&&(_=`?${_}`);let G=z(C.url);return C.fragmentIdentifier&&(G=`#${F[d]?x(C.fragmentIdentifier,F):C.fragmentIdentifier}`),`${S}${_}${G}`},n.pick=(C,F,S)=>{S=Object.assign({parseFragmentIdentifier:!0,[d]:!1},S);const{url:P,query:m,fragmentIdentifier:u}=n.parseUrl(C,S);return n.stringifyUrl({url:P,query:a(m,F),fragmentIdentifier:u},S)},n.exclude=(C,F,S)=>{const P=Array.isArray(F)?m=>!F.includes(m):(m,u)=>!F(m,u);return n.pick(C,P,S)}})(vs);const Gb={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};function Wb(n,t=[]){const r=[];return Object.keys(n).forEach(s=>{if(t.length&&!t.includes(s))return;const a=n[s];r.push(...a.accounts)}),r}function Op(n,t){return n.includes(":")?[n]:t.chains||[]}const Pp="base10",ar="base16",kc="base64pad",hu="utf8",Ap=0,nn=1,Yb=0,sf=1,Gc=12,lu=32;function Jb(){const n=au.generateKeyPair();return{privateKey:cr(n.secretKey,ar),publicKey:cr(n.publicKey,ar)}}function Wc(){const n=Un.randomBytes(lu);return cr(n,ar)}function Xb(n,t){const r=au.sharedKey(yr(n,ar),yr(t,ar)),s=new Cb(Bo.SHA256,r).expand(lu);return cr(s,ar)}function Zb(n){const t=Bo.hash(yr(n,ar));return cr(t,ar)}function Nn(n){const t=Bo.hash(yr(n,hu));return cr(t,ar)}function Qb(n){return yr(`${n}`,Pp)}function ms(n){return Number(cr(n,Pp))}function ew(n){const t=Qb(typeof n.type<"u"?n.type:Ap);if(ms(t)===nn&&typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof n.senderPublicKey<"u"?yr(n.senderPublicKey,ar):void 0,s=typeof n.iv<"u"?yr(n.iv,ar):Un.randomBytes(Gc),a=new su.ChaCha20Poly1305(yr(n.symKey,ar)).seal(s,yr(n.message,hu));return rw({type:t,sealed:a,iv:s,senderPublicKey:r})}function tw(n){const t=new su.ChaCha20Poly1305(yr(n.symKey,ar)),{sealed:r,iv:s}=Lo(n.encoded),a=t.open(s,r);if(a===null)throw new Error("Failed to decrypt");return cr(a,hu)}function rw(n){if(ms(n.type)===nn){if(typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return cr(jc([n.type,n.senderPublicKey,n.iv,n.sealed]),kc)}return cr(jc([n.type,n.iv,n.sealed]),kc)}function Lo(n){const t=yr(n,kc),r=t.slice(Yb,sf),s=sf;if(ms(r)===nn){const p=s+lu,v=p+Gc,w=t.slice(s,p),x=t.slice(p,v),D=t.slice(v);return{type:r,sealed:D,iv:x,senderPublicKey:w}}const a=s+Gc,l=t.slice(s,a),d=t.slice(a);return{type:r,sealed:d,iv:l}}function iw(n,t){const r=Lo(n);return Cp({type:ms(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?cr(r.senderPublicKey,ar):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function Cp(n){const t=(n==null?void 0:n.type)||Ap;if(t===nn){if(typeof(n==null?void 0:n.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(n==null?void 0:n.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:n==null?void 0:n.senderPublicKey,receiverPublicKey:n==null?void 0:n.receiverPublicKey}}function of(n){return n.type===nn&&typeof n.senderPublicKey=="string"&&typeof n.receiverPublicKey=="string"}var nw=Object.defineProperty,af=Object.getOwnPropertySymbols,sw=Object.prototype.hasOwnProperty,ow=Object.prototype.propertyIsEnumerable,cf=(n,t,r)=>t in n?nw(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,uf=(n,t)=>{for(var r in t||(t={}))sw.call(t,r)&&cf(n,r,t[r]);if(af)for(var r of af(t))ow.call(t,r)&&cf(n,r,t[r]);return n};const aw="ReactNative",Ti={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},cw="js";function fu(){return typeof Cn.exports<"u"&&typeof Cn.exports.versions<"u"&&typeof Cn.exports.versions.node<"u"}function Np(){return!Ep()&&!!cu()&&navigator.product===aw}function pu(){return!fu()&&!!cu()}function du(){return Np()?Ti.reactNative:fu()?Ti.node:pu()?Ti.browser:Ti.unknown}function uw(n,t){let r=vs.parse(n);return r=uf(uf({},r),t),n=vs.stringify(r),n}function hw(){return Ip()||{name:"",description:"",url:"",icons:[""]}}function lw(){if(du()===Ti.reactNative&&typeof $r<"u"&&typeof($r==null?void 0:$r.Platform)<"u"){const{OS:r,Version:s}=$r.Platform;return[r,s].join("-")}const n=H_();if(n===null)return"unknown";const t=n.os?n.os.replace(" ","").toLowerCase():"unknown";return n.type==="browser"?[t,n.name,n.version].join("-"):[t,n.version].join("-")}function fw(){var n;const t=du();return t===Ti.browser?[t,((n=Sp())==null?void 0:n.host)||"unknown"].join(":"):t}function pw(n,t,r){const s=lw(),a=fw();return[[n,t].join("-"),[cw,r].join("-"),s,a].join("/")}function dw({protocol:n,version:t,relayUrl:r,sdkVersion:s,auth:a,projectId:l,useOnCloseEvent:d}){const p=r.split("?"),v=pw(n,t,s),w={auth:a,ua:v,projectId:l,useOnCloseEvent:d||void 0},x=uw(p[1]||"",w);return p[0]+"?"+x}function en(n,t){return n.filter(r=>t.includes(r)).length===n.length}function Tp(n){return Object.fromEntries(n.entries())}function Rp(n){return new Map(Object.entries(n))}function An(n=ye.FIVE_MINUTES,t){const r=ye.toMiliseconds(n||ye.FIVE_MINUTES);let s,a,l;return{resolve:d=>{l&&s&&(clearTimeout(l),s(d))},reject:d=>{l&&a&&(clearTimeout(l),a(d))},done:()=>new Promise((d,p)=>{l=setTimeout(()=>{p(new Error(t))},r),s=d,a=p})}}function Fo(n,t,r){return new Promise(async(s,a)=>{const l=setTimeout(()=>a(new Error(r)),t);try{const d=await n;s(d)}catch(d){a(d)}clearTimeout(l)})}function Up(n,t){if(typeof t=="string"&&t.startsWith(`${n}:`))return t;if(n.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(n.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${n}`)}function gw(n){return Up("topic",n)}function vw(n){return Up("id",n)}function Dp(n){const[t,r]=n.split(":"),s={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")s.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return s}function kr(n,t){return ye.fromMiliseconds((t||Date.now())+ye.toMiliseconds(n))}function Ni(n){return Date.now()>=ye.toMiliseconds(n)}function Ht(n,t){return`${n}${t?`:${t}`:""}`}function Cc(n=[],t=[]){return[...new Set([...n,...t])]}async function yw({id:n,topic:t,wcDeepLink:r}){try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r;let a=s==null?void 0:s.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const l=`${a}/wc?requestId=${n}&sessionTopic=${t}`,d=du();d===Ti.browser?l.startsWith("https://")?window.open(l,"_blank","noreferrer noopener"):window.open(l,"_self","noreferrer noopener"):d===Ti.reactNative&&typeof($r==null?void 0:$r.Linking)<"u"&&await $r.Linking.openURL(l)}catch(s){console.error(s)}}const _w="irn";function Yc(n){return(n==null?void 0:n.relay)||{protocol:_w}}function Co(n){const t=Gb[n];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${n}`);return t}var mw=Object.defineProperty,hf=Object.getOwnPropertySymbols,bw=Object.prototype.hasOwnProperty,ww=Object.prototype.propertyIsEnumerable,lf=(n,t,r)=>t in n?mw(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Ew=(n,t)=>{for(var r in t||(t={}))bw.call(t,r)&&lf(n,r,t[r]);if(hf)for(var r of hf(t))ww.call(t,r)&&lf(n,r,t[r]);return n};function Sw(n,t="-"){const r={},s="relay"+t;return Object.keys(n).forEach(a=>{if(a.startsWith(s)){const l=a.replace(s,""),d=n[a];r[l]=d}}),r}function Iw(n){const t=n.indexOf(":"),r=n.indexOf("?")!==-1?n.indexOf("?"):void 0,s=n.substring(0,t),a=n.substring(t+1,r).split("@"),l=typeof r<"u"?n.substring(r):"",d=vs.parse(l);return{protocol:s,topic:xw(a[0]),version:parseInt(a[1],10),symKey:d.symKey,relay:Sw(d)}}function xw(n){return n.startsWith("//")?n.substring(2):n}function Ow(n,t="-"){const r="relay",s={};return Object.keys(n).forEach(a=>{const l=r+t+a;n[a]&&(s[l]=n[a])}),s}function Pw(n){return`${n.protocol}:${n.topic}@${n.version}?`+vs.stringify(Ew({symKey:n.symKey},Ow(n.relay)))}function Ln(n){const t=[];return n.forEach(r=>{const[s,a]=r.split(":");t.push(`${s}:${a}`)}),t}function Aw(n){const t=[];return Object.values(n).forEach(r=>{t.push(...Ln(r.accounts))}),t}function Cw(n,t){const r=[];return Object.values(n).forEach(s=>{Ln(s.accounts).includes(t)&&r.push(...s.methods)}),r}function Nw(n,t){const r=[];return Object.values(n).forEach(s=>{Ln(s.accounts).includes(t)&&r.push(...s.events)}),r}function Tw(n,t){const r=To(n,t);if(r)throw new Error(r.message);const s={};for(const[a,l]of Object.entries(n))s[a]={methods:l.methods,events:l.events,chains:l.accounts.map(d=>`${d.split(":")[0]}:${d.split(":")[1]}`)};return s}function gu(n){return n.includes(":")}function No(n){return gu(n)?n.split(":")[0]:n}const Rw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Uw={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function ue(n,t){const{message:r,code:s}=Uw[n];return{message:t?`${r} ${t}`:r,code:s}}function Ut(n,t){const{message:r,code:s}=Rw[n];return{message:t?`${r} ${t}`:r,code:s}}function ii(n,t){return Array.isArray(n)?typeof t<"u"&&n.length?n.every(t):!0:!1}function Tn(n){return Object.getPrototypeOf(n)===Object.prototype&&Object.keys(n).length}function or(n){return typeof n>"u"}function Gt(n,t){return t&&or(n)?!0:typeof n=="string"&&!!n.trim().length}function vu(n,t){return t&&or(n)?!0:typeof n=="number"&&!isNaN(n)}function Dw(n,t){const{requiredNamespaces:r}=t,s=Object.keys(n.namespaces),a=Object.keys(r);let l=!0;return en(a,s)?(s.forEach(d=>{const{accounts:p,methods:v,events:w}=n.namespaces[d],x=Ln(p),D=r[d];(!en(Op(d,D),x)||!en(D.methods,v)||!en(D.events,w))&&(l=!1)}),l):!1}function $o(n){return Gt(n,!1)&&n.includes(":")?n.split(":").length===2:!1}function Lw(n){if(Gt(n,!1)&&n.includes(":")){const t=n.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&$o(r)}}return!1}function Fw(n){if(Gt(n,!1))try{return typeof new URL(n)<"u"}catch{return!1}return!1}function $w(n){var t;return(t=n==null?void 0:n.proposer)==null?void 0:t.publicKey}function Mw(n){return n==null?void 0:n.topic}function jw(n,t){let r=null;return Gt(n==null?void 0:n.publicKey,!1)||(r=ue("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function ff(n){let t=!0;return ii(n)?n.length&&(t=n.every(r=>Gt(r,!1))):t=!1,t}function qw(n,t,r){let s=null;return ii(t)&&t.length?t.forEach(a=>{s||$o(a)||(s=Ut("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):$o(n)||(s=Ut("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function zw(n,t,r){let s=null;return Object.entries(n).forEach(([a,l])=>{if(s)return;const d=qw(a,Op(a,l),`${t} ${r}`);d&&(s=d)}),s}function Hw(n,t){let r=null;return ii(n)?n.forEach(s=>{r||Lw(s)||(r=Ut("UNSUPPORTED_ACCOUNTS",`${t}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=Ut("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function Kw(n,t){let r=null;return Object.values(n).forEach(s=>{if(r)return;const a=Hw(s==null?void 0:s.accounts,`${t} namespace`);a&&(r=a)}),r}function Bw(n,t){let r=null;return ff(n==null?void 0:n.methods)?ff(n==null?void 0:n.events)||(r=Ut("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=Ut("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function Lp(n,t){let r=null;return Object.values(n).forEach(s=>{if(r)return;const a=Bw(s,`${t}, namespace`);a&&(r=a)}),r}function Vw(n,t,r){let s=null;if(n&&Tn(n)){const a=Lp(n,t);a&&(s=a);const l=zw(n,t,r);l&&(s=l)}else s=ue("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return s}function To(n,t){let r=null;if(n&&Tn(n)){const s=Lp(n,t);s&&(r=s);const a=Kw(n,t);a&&(r=a)}else r=ue("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function Fp(n){return Gt(n.protocol,!0)}function kw(n,t){let r=!1;return t&&!n?r=!0:n&&ii(n)&&n.length&&n.forEach(s=>{r=Fp(s)}),r}function Gw(n){return typeof n=="number"}function vr(n){return typeof n<"u"&&typeof n!==null}function Ww(n){return!(!n||typeof n!="object"||!n.code||!vu(n.code,!1)||!n.message||!Gt(n.message,!1))}function Yw(n){return!(or(n)||!Gt(n.method,!1))}function Jw(n){return!(or(n)||or(n.result)&&or(n.error)||!vu(n.id,!1)||!Gt(n.jsonrpc,!1))}function Xw(n){return!(or(n)||!Gt(n.name,!1))}function pf(n,t){return!(!$o(t)||!Aw(n).includes(t))}function Zw(n,t,r){return Gt(r,!1)?Cw(n,t).includes(r):!1}function Qw(n,t,r){return Gt(r,!1)?Nw(n,t).includes(r):!1}function df(n,t,r){let s=null;const a=eE(n),l=tE(t),d=Object.keys(a),p=Object.keys(l),v=gf(Object.keys(n)),w=gf(Object.keys(t)),x=v.filter(D=>!w.includes(D));return x.length&&(s=ue("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${x.toString()}
      Received: ${Object.keys(t).toString()}`)),en(d,p)||(s=ue("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${d.toString()}
      Approved: ${p.toString()}`)),Object.keys(t).forEach(D=>{if(!D.includes(":")||s)return;const j=Ln(t[D].accounts);j.includes(D)||(s=ue("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${D}
        Required: ${D}
        Approved: ${j.toString()}`))}),d.forEach(D=>{s||(en(a[D].methods,l[D].methods)?en(a[D].events,l[D].events)||(s=ue("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${D}`)):s=ue("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${D}`))}),s}function eE(n){const t={};return Object.keys(n).forEach(r=>{var s;r.includes(":")?t[r]=n[r]:(s=n[r].chains)==null||s.forEach(a=>{t[a]={methods:n[r].methods,events:n[r].events}})}),t}function gf(n){return[...new Set(n.map(t=>t.includes(":")?t.split(":")[0]:t))]}function tE(n){const t={};return Object.keys(n).forEach(r=>{if(r.includes(":"))t[r]=n[r];else{const s=Ln(n[r].accounts);s==null||s.forEach(a=>{t[a]={accounts:n[r].accounts.filter(l=>l.includes(`${a}:`)),methods:n[r].methods,events:n[r].events}})}}),t}function rE(n,t){return vu(n,!1)&&n<=t.max&&n>=t.min}const iE="PARSE_ERROR",nE="INVALID_REQUEST",sE="METHOD_NOT_FOUND",oE="INVALID_PARAMS",$p="INTERNAL_ERROR",yu="SERVER_ERROR",aE=[-32700,-32600,-32601,-32602,-32603],ds={[iE]:{code:-32700,message:"Parse error"},[nE]:{code:-32600,message:"Invalid Request"},[sE]:{code:-32601,message:"Method not found"},[oE]:{code:-32602,message:"Invalid params"},[$p]:{code:-32603,message:"Internal error"},[yu]:{code:-32e3,message:"Server error"}},Mp=yu;function cE(n){return aE.includes(n)}function vf(n){return Object.keys(ds).includes(n)?ds[n]:ds[Mp]}function uE(n){const t=Object.values(ds).find(r=>r.code===n);return t||ds[Mp]}function jp(n,t,r){return n.message.includes("getaddrinfo ENOTFOUND")||n.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${t}`):n}var qp={},vi={},yf;function hE(){if(yf)return vi;yf=1,Object.defineProperty(vi,"__esModule",{value:!0}),vi.isBrowserCryptoAvailable=vi.getSubtleCrypto=vi.getBrowerCrypto=void 0;function n(){return(Ir===null||Ir===void 0?void 0:Ir.crypto)||(Ir===null||Ir===void 0?void 0:Ir.msCrypto)||{}}vi.getBrowerCrypto=n;function t(){const s=n();return s.subtle||s.webkitSubtle}vi.getSubtleCrypto=t;function r(){return!!n()&&!!t()}return vi.isBrowserCryptoAvailable=r,vi}var yi={},_f;function lE(){if(_f)return yi;_f=1,Object.defineProperty(yi,"__esModule",{value:!0}),yi.isBrowser=yi.isNode=yi.isReactNative=void 0;function n(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}yi.isReactNative=n;function t(){return typeof Cn.exports<"u"&&typeof Cn.exports.versions<"u"&&typeof Cn.exports.versions.node<"u"}yi.isNode=t;function r(){return!n()&&!t()}return yi.isBrowser=r,yi}(function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=jr.exports;t.__exportStar(hE(),n),t.__exportStar(lE(),n)})(qp);function zp(n=3){const t=Date.now()*Math.pow(10,n),r=Math.floor(Math.random()*Math.pow(10,n));return t+r}function _u(n=6){return BigInt(zp(n))}function Vo(n,t,r){return{id:r||zp(),jsonrpc:"2.0",method:n,params:t}}function mu(n,t){return{id:n,jsonrpc:"2.0",result:t}}function ko(n,t,r){return{id:n,jsonrpc:"2.0",error:fE(t,r)}}function fE(n,t){return typeof n>"u"?vf($p):(typeof n=="string"&&(n=Object.assign(Object.assign({},vf(yu)),{message:n})),typeof t<"u"&&(n.data=t),cE(n.code)&&(n=uE(n.code)),n)}class pE{}class dE extends pE{constructor(){super()}}class gE extends dE{constructor(t){super()}}const vE="^https?:",yE="^wss?:";function _E(n){const t=n.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function Hp(n,t){const r=_E(n);return typeof r>"u"?!1:new RegExp(t).test(r)}function mf(n){return Hp(n,vE)}function bf(n){return Hp(n,yE)}function mE(n){return new RegExp("wss?://localhost(:d{2,5})?").test(n)}function Kp(n){return typeof n=="object"&&"id"in n&&"jsonrpc"in n&&n.jsonrpc==="2.0"}function bu(n){return Kp(n)&&"method"in n}function Go(n){return Kp(n)&&(_i(n)||Gr(n))}function _i(n){return"result"in n}function Gr(n){return"error"in n}class Di extends gE{constructor(t){super(t),this.events=new ur.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(Vo(t.method,t.params||[],t.id||_u().toString()),r)}async requestStrict(t,r){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(l){a(l)}this.events.on(`${t.id}`,l=>{Gr(l)?a(l.error):s(l.result)});try{await this.connection.send(t,r)}catch(l){a(l)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Go(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const bE=()=>typeof $r<"u"&&typeof $r.WebSocket<"u"?$r.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),wE=()=>typeof window<"u",wf=n=>n.split("?")[0],Ef=10,EE=bE();class SE{constructor(t){if(this.url=t,this.events=new ur.exports.EventEmitter,this.registering=!1,!bf(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),t()},this.socket.close()})}async send(t,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(gs(t))}catch(s){this.onError(t.id,s)}}register(t=this.url){if(!bf(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),a(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,s)=>{const a=qp.isReactNative()?void 0:{rejectUnauthorized:!mE(t)},l=new EE(t,[],a);wE()?l.onerror=d=>{const p=d;s(this.emitError(p.error))}:l.on("error",d=>{s(this.emitError(d))}),l.onopen=()=>{this.onOpen(l),r(l)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?iu(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),l=ko(t,a);this.events.emit("payload",l)}parseError(t,r=this.url){return jp(t,wf(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Ef&&this.events.setMaxListeners(Ef)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${wf(this.url)}`));return this.events.emit("register_error",r),r}}var Jc={exports:{}};(function(n,t){var r=200,s="__lodash_hash_undefined__",a=1,l=2,d=9007199254740991,p="[object Arguments]",v="[object Array]",w="[object AsyncFunction]",x="[object Boolean]",D="[object Date]",j="[object Error]",U="[object Function]",z="[object GeneratorFunction]",K="[object Map]",B="[object Number]",oe="[object Null]",C="[object Object]",F="[object Promise]",S="[object Proxy]",P="[object RegExp]",m="[object Set]",u="[object String]",_="[object Symbol]",G="[object Undefined]",k="[object WeakMap]",se="[object ArrayBuffer]",ce="[object DataView]",ge="[object Float32Array]",N="[object Float64Array]",q="[object Int8Array]",le="[object Int16Array]",te="[object Int32Array]",W="[object Uint8Array]",ee="[object Uint8ClampedArray]",Y="[object Uint16Array]",re="[object Uint32Array]",Oe=/[\\^$.*+?()[\]{}|]/g,ie=/^\[object .+?Constructor\]$/,be=/^(?:0|[1-9]\d*)$/,he={};he[ge]=he[N]=he[q]=he[le]=he[te]=he[W]=he[ee]=he[Y]=he[re]=!0,he[p]=he[v]=he[se]=he[x]=he[ce]=he[D]=he[j]=he[U]=he[K]=he[B]=he[C]=he[P]=he[m]=he[u]=he[k]=!1;var _e=typeof Ir=="object"&&Ir&&Ir.Object===Object&&Ir,M=typeof self=="object"&&self&&self.Object===Object&&self,$=_e||M||Function("return this")(),A=t&&!t.nodeType&&t,h=A&&!0&&n&&!n.nodeType&&n,I=h&&h.exports===A,ne=I&&_e.process,fe=function(){try{return ne&&ne.binding&&ne.binding("util")}catch{}}(),Ie=fe&&fe.isTypedArray;function He(b,T){for(var Z=-1,pe=b==null?0:b.length,at=0,Te=[];++Z<pe;){var ft=b[Z];T(ft,Z,b)&&(Te[at++]=ft)}return Te}function Ve(b,T){for(var Z=-1,pe=T.length,at=b.length;++Z<pe;)b[at+Z]=T[Z];return b}function $e(b,T){for(var Z=-1,pe=b==null?0:b.length;++Z<pe;)if(T(b[Z],Z,b))return!0;return!1}function dt(b,T){for(var Z=-1,pe=Array(b);++Z<b;)pe[Z]=T(Z);return pe}function gt(b){return function(T){return b(T)}}function je(b,T){return b.has(T)}function xe(b,T){return b==null?void 0:b[T]}function Ue(b){var T=-1,Z=Array(b.size);return b.forEach(function(pe,at){Z[++T]=[at,pe]}),Z}function De(b,T){return function(Z){return b(T(Z))}}function qe(b){var T=-1,Z=Array(b.size);return b.forEach(function(pe){Z[++T]=pe}),Z}var Ae=Array.prototype,Le=Function.prototype,Se=Object.prototype,Ce=$["__core-js_shared__"],Ke=Le.toString,Pe=Se.hasOwnProperty,ke=function(){var b=/[^.]+$/.exec(Ce&&Ce.keys&&Ce.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}(),We=Se.toString,et=RegExp("^"+Ke.call(Pe).replace(Oe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),tt=I?$.Buffer:void 0,Je=$.Symbol,Qt=$.Uint8Array,hr=Se.propertyIsEnumerable,Wr=Ae.splice,er=Je?Je.toStringTag:void 0,ni=Object.getOwnPropertySymbols,mi=tt?tt.isBuffer:void 0,Fi=De(Object.keys,Object),wt=_r($,"DataView"),vt=_r($,"Map"),Et=_r($,"Promise"),St=_r($,"Set"),mt=_r($,"WeakMap"),yt=_r(Object,"create"),Lt=oi(wt),Ft=oi(vt),It=oi(Et),$t=oi(St),xt=oi(mt),Ct=Je?Je.prototype:void 0,Ot=Ct?Ct.valueOf:void 0;function ht(b){var T=-1,Z=b==null?0:b.length;for(this.clear();++T<Z;){var pe=b[T];this.set(pe[0],pe[1])}}function Mt(){this.__data__=yt?yt(null):{},this.size=0}function jt(b){var T=this.has(b)&&delete this.__data__[b];return this.size-=T?1:0,T}function Jo(b){var T=this.__data__;if(yt){var Z=T[b];return Z===s?void 0:Z}return Pe.call(T,b)?T[b]:void 0}function Xo(b){var T=this.__data__;return yt?T[b]!==void 0:Pe.call(T,b)}function Zo(b,T){var Z=this.__data__;return this.size+=this.has(b)?0:1,Z[b]=yt&&T===void 0?s:T,this}ht.prototype.clear=Mt,ht.prototype.delete=jt,ht.prototype.get=Jo,ht.prototype.has=Xo,ht.prototype.set=Zo;function Or(b){var T=-1,Z=b==null?0:b.length;for(this.clear();++T<Z;){var pe=b[T];this.set(pe[0],pe[1])}}function Qo(){this.__data__=[],this.size=0}function ea(b){var T=this.__data__,Z=$i(T,b);if(Z<0)return!1;var pe=T.length-1;return Z==pe?T.pop():Wr.call(T,Z,1),--this.size,!0}function ta(b){var T=this.__data__,Z=$i(T,b);return Z<0?void 0:T[Z][1]}function ra(b){return $i(this.__data__,b)>-1}function ia(b,T){var Z=this.__data__,pe=$i(Z,b);return pe<0?(++this.size,Z.push([b,T])):Z[pe][1]=T,this}Or.prototype.clear=Qo,Or.prototype.delete=ea,Or.prototype.get=ta,Or.prototype.has=ra,Or.prototype.set=ia;function si(b){var T=-1,Z=b==null?0:b.length;for(this.clear();++T<Z;){var pe=b[T];this.set(pe[0],pe[1])}}function on(){this.size=0,this.__data__={hash:new ht,map:new(vt||Or),string:new ht}}function na(b){var T=bi(this,b).delete(b);return this.size-=T?1:0,T}function an(b){return bi(this,b).get(b)}function sa(b){return bi(this,b).has(b)}function oa(b,T){var Z=bi(this,b),pe=Z.size;return Z.set(b,T),this.size+=Z.size==pe?0:1,this}si.prototype.clear=on,si.prototype.delete=na,si.prototype.get=an,si.prototype.has=sa,si.prototype.set=oa;function cn(b){var T=-1,Z=b==null?0:b.length;for(this.__data__=new si;++T<Z;)this.add(b[T])}function ws(b){return this.__data__.set(b,s),this}function Es(b){return this.__data__.has(b)}cn.prototype.add=cn.prototype.push=ws,cn.prototype.has=Es;function qr(b){var T=this.__data__=new Or(b);this.size=T.size}function aa(){this.__data__=new Or,this.size=0}function ca(b){var T=this.__data__,Z=T.delete(b);return this.size=T.size,Z}function ua(b){return this.__data__.get(b)}function ha(b){return this.__data__.has(b)}function Ss(b,T){var Z=this.__data__;if(Z instanceof Or){var pe=Z.__data__;if(!vt||pe.length<r-1)return pe.push([b,T]),this.size=++Z.size,this;Z=this.__data__=new si(pe)}return Z.set(b,T),this.size=Z.size,this}qr.prototype.clear=aa,qr.prototype.delete=ca,qr.prototype.get=ua,qr.prototype.has=ha,qr.prototype.set=Ss;function Is(b,T){var Z=ln(b),pe=!Z&&Fs(b),at=!Z&&!pe&&Mn(b),Te=!Z&&!pe&&!at&&js(b),ft=Z||pe||at||Te,qt=ft?dt(b.length,String):[],Xe=qt.length;for(var ct in b)(T||Pe.call(b,ct))&&!(ft&&(ct=="length"||at&&(ct=="offset"||ct=="parent")||Te&&(ct=="buffer"||ct=="byteLength"||ct=="byteOffset")||Ts(ct,Xe)))&&qt.push(ct);return qt}function $i(b,T){for(var Z=b.length;Z--;)if(Ls(b[Z][0],T))return Z;return-1}function Fn(b,T,Z){var pe=T(b);return ln(b)?pe:Ve(pe,Z(b))}function Mi(b){return b==null?b===void 0?G:oe:er&&er in Object(b)?Cs(b):pa(b)}function $n(b){return qi(b)&&Mi(b)==p}function ji(b,T,Z,pe,at){return b===T?!0:b==null||T==null||!qi(b)&&!qi(T)?b!==b&&T!==T:xs(b,T,Z,pe,ji,at)}function xs(b,T,Z,pe,at,Te){var ft=ln(b),qt=ln(T),Xe=ft?v:Yr(b),ct=qt?v:Yr(T);Xe=Xe==p?C:Xe,ct=ct==p?C:ct;var Nt=Xe==C,lr=ct==C,zt=Xe==ct;if(zt&&Mn(b)){if(!Mn(T))return!1;ft=!0,Nt=!1}if(zt&&!Nt)return Te||(Te=new qr),ft||js(b)?un(b,T,Z,pe,at,Te):fa(b,T,Xe,Z,pe,at,Te);if(!(Z&a)){var pt=Nt&&Pe.call(b,"__wrapped__"),tr=lr&&Pe.call(T,"__wrapped__");if(pt||tr){var zr=pt?b.value():b,Pr=tr?T.value():T;return Te||(Te=new qr),at(zr,Pr,Z,pe,Te)}}return zt?(Te||(Te=new qr),As(b,T,Z,pe,at,Te)):!1}function la(b){if(!Ms(b)||Us(b))return!1;var T=fn(b)?et:ie;return T.test(oi(b))}function Os(b){return qi(b)&&$s(b.length)&&!!he[Mi(b)]}function Ps(b){if(!Ds(b))return Fi(b);var T=[];for(var Z in Object(b))Pe.call(b,Z)&&Z!="constructor"&&T.push(Z);return T}function un(b,T,Z,pe,at,Te){var ft=Z&a,qt=b.length,Xe=T.length;if(qt!=Xe&&!(ft&&Xe>qt))return!1;var ct=Te.get(b);if(ct&&Te.get(T))return ct==T;var Nt=-1,lr=!0,zt=Z&l?new cn:void 0;for(Te.set(b,T),Te.set(T,b);++Nt<qt;){var pt=b[Nt],tr=T[Nt];if(pe)var zr=ft?pe(tr,pt,Nt,T,b,Te):pe(pt,tr,Nt,b,T,Te);if(zr!==void 0){if(zr)continue;lr=!1;break}if(zt){if(!$e(T,function(Pr,Jr){if(!je(zt,Jr)&&(pt===Pr||at(pt,Pr,Z,pe,Te)))return zt.push(Jr)})){lr=!1;break}}else if(!(pt===tr||at(pt,tr,Z,pe,Te))){lr=!1;break}}return Te.delete(b),Te.delete(T),lr}function fa(b,T,Z,pe,at,Te,ft){switch(Z){case ce:if(b.byteLength!=T.byteLength||b.byteOffset!=T.byteOffset)return!1;b=b.buffer,T=T.buffer;case se:return!(b.byteLength!=T.byteLength||!Te(new Qt(b),new Qt(T)));case x:case D:case B:return Ls(+b,+T);case j:return b.name==T.name&&b.message==T.message;case P:case u:return b==T+"";case K:var qt=Ue;case m:var Xe=pe&a;if(qt||(qt=qe),b.size!=T.size&&!Xe)return!1;var ct=ft.get(b);if(ct)return ct==T;pe|=l,ft.set(b,T);var Nt=un(qt(b),qt(T),pe,at,Te,ft);return ft.delete(b),Nt;case _:if(Ot)return Ot.call(b)==Ot.call(T)}return!1}function As(b,T,Z,pe,at,Te){var ft=Z&a,qt=hn(b),Xe=qt.length,ct=hn(T),Nt=ct.length;if(Xe!=Nt&&!ft)return!1;for(var lr=Xe;lr--;){var zt=qt[lr];if(!(ft?zt in T:Pe.call(T,zt)))return!1}var pt=Te.get(b);if(pt&&Te.get(T))return pt==T;var tr=!0;Te.set(b,T),Te.set(T,b);for(var zr=ft;++lr<Xe;){zt=qt[lr];var Pr=b[zt],Jr=T[zt];if(pe)var jn=ft?pe(Jr,Pr,zt,T,b,Te):pe(Pr,Jr,zt,b,T,Te);if(!(jn===void 0?Pr===Jr||at(Pr,Jr,Z,pe,Te):jn)){tr=!1;break}zr||(zr=zt=="constructor")}if(tr&&!zr){var zi=b.constructor,Vt=T.constructor;zi!=Vt&&"constructor"in b&&"constructor"in T&&!(typeof zi=="function"&&zi instanceof zi&&typeof Vt=="function"&&Vt instanceof Vt)&&(tr=!1)}return Te.delete(b),Te.delete(T),tr}function hn(b){return Fn(b,va,Ns)}function bi(b,T){var Z=b.__data__;return Rs(T)?Z[typeof T=="string"?"string":"hash"]:Z.map}function _r(b,T){var Z=xe(b,T);return la(Z)?Z:void 0}function Cs(b){var T=Pe.call(b,er),Z=b[er];try{b[er]=void 0;var pe=!0}catch{}var at=We.call(b);return pe&&(T?b[er]=Z:delete b[er]),at}var Ns=ni?function(b){return b==null?[]:(b=Object(b),He(ni(b),function(T){return hr.call(b,T)}))}:ot,Yr=Mi;(wt&&Yr(new wt(new ArrayBuffer(1)))!=ce||vt&&Yr(new vt)!=K||Et&&Yr(Et.resolve())!=F||St&&Yr(new St)!=m||mt&&Yr(new mt)!=k)&&(Yr=function(b){var T=Mi(b),Z=T==C?b.constructor:void 0,pe=Z?oi(Z):"";if(pe)switch(pe){case Lt:return ce;case Ft:return K;case It:return F;case $t:return m;case xt:return k}return T});function Ts(b,T){return T=T==null?d:T,!!T&&(typeof b=="number"||be.test(b))&&b>-1&&b%1==0&&b<T}function Rs(b){var T=typeof b;return T=="string"||T=="number"||T=="symbol"||T=="boolean"?b!=="__proto__":b===null}function Us(b){return!!ke&&ke in b}function Ds(b){var T=b&&b.constructor,Z=typeof T=="function"&&T.prototype||Se;return b===Z}function pa(b){return We.call(b)}function oi(b){if(b!=null){try{return Ke.call(b)}catch{}try{return b+""}catch{}}return""}function Ls(b,T){return b===T||b!==b&&T!==T}var Fs=$n(function(){return arguments}())?$n:function(b){return qi(b)&&Pe.call(b,"callee")&&!hr.call(b,"callee")},ln=Array.isArray;function da(b){return b!=null&&$s(b.length)&&!fn(b)}var Mn=mi||st;function ga(b,T){return ji(b,T)}function fn(b){if(!Ms(b))return!1;var T=Mi(b);return T==U||T==z||T==w||T==S}function $s(b){return typeof b=="number"&&b>-1&&b%1==0&&b<=d}function Ms(b){var T=typeof b;return b!=null&&(T=="object"||T=="function")}function qi(b){return b!=null&&typeof b=="object"}var js=Ie?gt(Ie):Os;function va(b){return da(b)?Is(b):Ps(b)}function ot(){return[]}function st(){return!1}n.exports=ga})(Jc,Jc.exports);const IE=Jc.exports;function xE(n,t){if(n.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<n.length;a++){var l=n.charAt(a),d=l.charCodeAt(0);if(r[d]!==255)throw new TypeError(l+" is ambiguous");r[d]=a}var p=n.length,v=n.charAt(0),w=Math.log(p)/Math.log(256),x=Math.log(256)/Math.log(p);function D(z){if(z instanceof Uint8Array||(ArrayBuffer.isView(z)?z=new Uint8Array(z.buffer,z.byteOffset,z.byteLength):Array.isArray(z)&&(z=Uint8Array.from(z))),!(z instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(z.length===0)return"";for(var K=0,B=0,oe=0,C=z.length;oe!==C&&z[oe]===0;)oe++,K++;for(var F=(C-oe)*x+1>>>0,S=new Uint8Array(F);oe!==C;){for(var P=z[oe],m=0,u=F-1;(P!==0||m<B)&&u!==-1;u--,m++)P+=256*S[u]>>>0,S[u]=P%p>>>0,P=P/p>>>0;if(P!==0)throw new Error("Non-zero carry");B=m,oe++}for(var _=F-B;_!==F&&S[_]===0;)_++;for(var G=v.repeat(K);_<F;++_)G+=n.charAt(S[_]);return G}function j(z){if(typeof z!="string")throw new TypeError("Expected String");if(z.length===0)return new Uint8Array;var K=0;if(z[K]!==" "){for(var B=0,oe=0;z[K]===v;)B++,K++;for(var C=(z.length-K)*w+1>>>0,F=new Uint8Array(C);z[K];){var S=r[z.charCodeAt(K)];if(S===255)return;for(var P=0,m=C-1;(S!==0||P<oe)&&m!==-1;m--,P++)S+=p*F[m]>>>0,F[m]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");oe=P,K++}if(z[K]!==" "){for(var u=C-oe;u!==C&&F[u]===0;)u++;for(var _=new Uint8Array(B+(C-u)),G=B;u!==C;)_[G++]=F[u++];return _}}}function U(z){var K=j(z);if(K)return K;throw new Error(`Non-${t} character`)}return{encode:D,decodeUnsafe:j,decode:U}}var OE=xE,PE=OE;const Bp=n=>{if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")},AE=n=>new TextEncoder().encode(n),CE=n=>new TextDecoder().decode(n);class NE{constructor(t,r,s){this.name=t,this.prefix=r,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class TE{constructor(t,r,s){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Vp(this,t)}}class RE{constructor(t){this.decoders=t}or(t){return Vp(this,t)}decode(t){const r=t[0],s=this.decoders[r];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Vp=(n,t)=>new RE({...n.decoders||{[n.prefix]:n},...t.decoders||{[t.prefix]:t}});class UE{constructor(t,r,s,a){this.name=t,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new NE(t,r,s),this.decoder=new TE(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Wo=({name:n,prefix:t,encode:r,decode:s})=>new UE(n,t,r,s),bs=({prefix:n,name:t,alphabet:r})=>{const{encode:s,decode:a}=PE(r,t);return Wo({prefix:n,name:t,encode:s,decode:l=>Bp(a(l))})},DE=(n,t,r,s)=>{const a={};for(let x=0;x<t.length;++x)a[t[x]]=x;let l=n.length;for(;n[l-1]==="=";)--l;const d=new Uint8Array(l*r/8|0);let p=0,v=0,w=0;for(let x=0;x<l;++x){const D=a[n[x]];if(D===void 0)throw new SyntaxError(`Non-${s} character`);v=v<<r|D,p+=r,p>=8&&(p-=8,d[w++]=255&v>>p)}if(p>=r||255&v<<8-p)throw new SyntaxError("Unexpected end of data");return d},LE=(n,t,r)=>{const s=t[t.length-1]==="=",a=(1<<r)-1;let l="",d=0,p=0;for(let v=0;v<n.length;++v)for(p=p<<8|n[v],d+=8;d>r;)d-=r,l+=t[a&p>>d];if(d&&(l+=t[a&p<<r-d]),s)for(;l.length*r&7;)l+="=";return l},Yt=({name:n,prefix:t,bitsPerChar:r,alphabet:s})=>Wo({prefix:t,name:n,encode(a){return LE(a,s,r)},decode(a){return DE(a,s,r,n)}}),FE=Wo({prefix:"\0",name:"identity",encode:n=>CE(n),decode:n=>AE(n)});var $E=Object.freeze({__proto__:null,identity:FE});const ME=Yt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var jE=Object.freeze({__proto__:null,base2:ME});const qE=Yt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var zE=Object.freeze({__proto__:null,base8:qE});const HE=bs({prefix:"9",name:"base10",alphabet:"0123456789"});var KE=Object.freeze({__proto__:null,base10:HE});const BE=Yt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),VE=Yt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var kE=Object.freeze({__proto__:null,base16:BE,base16upper:VE});const GE=Yt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),WE=Yt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),YE=Yt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),JE=Yt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),XE=Yt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ZE=Yt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),QE=Yt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),e6=Yt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),t6=Yt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var r6=Object.freeze({__proto__:null,base32:GE,base32upper:WE,base32pad:YE,base32padupper:JE,base32hex:XE,base32hexupper:ZE,base32hexpad:QE,base32hexpadupper:e6,base32z:t6});const i6=bs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),n6=bs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var s6=Object.freeze({__proto__:null,base36:i6,base36upper:n6});const o6=bs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),a6=bs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var c6=Object.freeze({__proto__:null,base58btc:o6,base58flickr:a6});const u6=Yt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),h6=Yt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),l6=Yt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),f6=Yt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var p6=Object.freeze({__proto__:null,base64:u6,base64pad:h6,base64url:l6,base64urlpad:f6});const kp=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),d6=kp.reduce((n,t,r)=>(n[r]=t,n),[]),g6=kp.reduce((n,t,r)=>(n[t.codePointAt(0)]=r,n),[]);function v6(n){return n.reduce((t,r)=>(t+=d6[r],t),"")}function y6(n){const t=[];for(const r of n){const s=g6[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(s)}return new Uint8Array(t)}const _6=Wo({prefix:"\u{1F680}",name:"base256emoji",encode:v6,decode:y6});var m6=Object.freeze({__proto__:null,base256emoji:_6}),b6=Gp,Sf=128,w6=127,E6=~w6,S6=Math.pow(2,31);function Gp(n,t,r){t=t||[],r=r||0;for(var s=r;n>=S6;)t[r++]=n&255|Sf,n/=128;for(;n&E6;)t[r++]=n&255|Sf,n>>>=7;return t[r]=n|0,Gp.bytes=r-s+1,t}var I6=Xc,x6=128,If=127;function Xc(n,s){var r=0,s=s||0,a=0,l=s,d,p=n.length;do{if(l>=p)throw Xc.bytes=0,new RangeError("Could not decode varint");d=n[l++],r+=a<28?(d&If)<<a:(d&If)*Math.pow(2,a),a+=7}while(d>=x6);return Xc.bytes=l-s,r}var O6=Math.pow(2,7),P6=Math.pow(2,14),A6=Math.pow(2,21),C6=Math.pow(2,28),N6=Math.pow(2,35),T6=Math.pow(2,42),R6=Math.pow(2,49),U6=Math.pow(2,56),D6=Math.pow(2,63),L6=function(n){return n<O6?1:n<P6?2:n<A6?3:n<C6?4:n<N6?5:n<T6?6:n<R6?7:n<U6?8:n<D6?9:10},F6={encode:b6,decode:I6,encodingLength:L6},Wp=F6;const xf=(n,t,r=0)=>(Wp.encode(n,t,r),t),Of=n=>Wp.encodingLength(n),Zc=(n,t)=>{const r=t.byteLength,s=Of(n),a=s+Of(r),l=new Uint8Array(a+r);return xf(n,l,0),xf(r,l,s),l.set(t,a),new $6(n,r,t,l)};class $6{constructor(t,r,s,a){this.code=t,this.size=r,this.digest=s,this.bytes=a}}const Yp=({name:n,code:t,encode:r})=>new M6(n,t,r);class M6{constructor(t,r,s){this.name=t,this.code=r,this.encode=s}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Zc(this.code,r):r.then(s=>Zc(this.code,s))}else throw Error("Unknown type, must be binary type")}}const Jp=n=>async t=>new Uint8Array(await crypto.subtle.digest(n,t)),j6=Yp({name:"sha2-256",code:18,encode:Jp("SHA-256")}),q6=Yp({name:"sha2-512",code:19,encode:Jp("SHA-512")});var z6=Object.freeze({__proto__:null,sha256:j6,sha512:q6});const Xp=0,H6="identity",Zp=Bp,K6=n=>Zc(Xp,Zp(n)),B6={code:Xp,name:H6,encode:Zp,digest:K6};var V6=Object.freeze({__proto__:null,identity:B6});new TextEncoder,new TextDecoder;const Pf={...$E,...jE,...zE,...KE,...kE,...r6,...s6,...c6,...p6,...m6};({...z6,...V6});function Qp(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function k6(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Qp(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function ed(n,t,r,s){return{name:n,prefix:t,encoder:{name:n,prefix:t,encode:r},decoder:{decode:s}}}const Af=ed("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),Nc=ed("ascii","a",n=>{let t="a";for(let r=0;r<n.length;r++)t+=String.fromCharCode(n[r]);return t},n=>{n=n.substring(1);const t=k6(n.length);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}),G6={utf8:Af,"utf-8":Af,hex:Pf.base16,latin1:Nc,ascii:Nc,binary:Nc,...Pf};function W6(n,t="utf8"){const r=G6[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Qp(globalThis.Buffer.from(n,"utf-8")):r.decoder.decode(`${r.prefix}${n}`)}const td="wc",Y6=2,wu="core",Ri=`${td}@2:${wu}:`,J6={name:wu,logger:"error"},X6={database:":memory:"},Z6="crypto",Cf="client_ed25519_seed",Q6=ye.ONE_DAY,e2="keychain",t2="0.3",r2="messages",i2="0.3",n2=ye.SIX_HOURS,s2="publisher",rd="irn",o2="error",id="wss://relay.walletconnect.com",Nf="wss://relay.walletconnect.org",a2="relayer",At={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},c2="_subscription",cs={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},u2=ye.ONE_SECOND/2,h2="2.9.0",l2=1e4,f2="0.3",p2="WALLETCONNECT_CLIENT_ID",ri={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},d2="subscription",g2="0.3",v2=ye.FIVE_SECONDS*1e3,y2="pairing",_2="0.3",us={wc_pairingDelete:{req:{ttl:ye.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ye.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ye.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ye.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ye.ONE_DAY,prompt:!1,tag:0},res:{ttl:ye.ONE_DAY,prompt:!1,tag:0}}},ti={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},m2="history",b2="0.3",w2="expirer",Fr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},E2="0.3",Tc="verify-api",Tf="https://verify.walletconnect.com";class S2{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=e2,this.version=t2,this.initialized=!1,this.storagePrefix=Ri,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:l}=ue("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(l)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=Qe.generateChildLogger(r,this.name)}get context(){return Qe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Tp(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Rp(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}}class I2{constructor(t,r,s){this.core=t,this.logger=r,this.name=Z6,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),l=Zl(a);return vp(l.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=Jb();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const l=await this.getClientSeed(),d=Zl(l),p=Wc();return await vb(p,a,Q6,d)},this.generateSharedKey=(a,l,d)=>{this.isInitialized();const p=this.getPrivateKey(a),v=Xb(p,l);return this.setSymKey(v,d)},this.setSymKey=async(a,l)=>{this.isInitialized();const d=l||Zb(a);return await this.keychain.set(d,a),d},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,l,d)=>{this.isInitialized();const p=Cp(d),v=gs(l);if(of(p)){const j=p.senderPublicKey,U=p.receiverPublicKey;a=await this.generateSharedKey(j,U)}const w=this.getSymKey(a),{type:x,senderPublicKey:D}=p;return ew({type:x,symKey:w,message:v,senderPublicKey:D})},this.decode=async(a,l,d)=>{this.isInitialized();const p=iw(l,d);if(of(p)){const x=p.receiverPublicKey,D=p.senderPublicKey;a=await this.generateSharedKey(x,D)}const v=this.getSymKey(a),w=tw({symKey:v,encoded:l});return iu(w)},this.getPayloadType=a=>{const l=Lo(a);return ms(l.type)},this.getPayloadSenderPublicKey=a=>{const l=Lo(a);return l.senderPublicKey?cr(l.senderPublicKey,ar):void 0},this.core=t,this.logger=Qe.generateChildLogger(r,this.name),this.keychain=s||new S2(this.core,this.logger)}get context(){return Qe.getLoggerContext(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Cf)}catch{t=Wc(),await this.keychain.set(Cf,t)}return W6(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}}class x2 extends mm{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=r2,this.version=i2,this.initialized=!1,this.storagePrefix=Ri,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const l=Nn(a);let d=this.messages.get(s);return typeof d>"u"&&(d={}),typeof d[l]<"u"||(d[l]=a,this.messages.set(s,d),await this.persist()),l},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const l=this.get(s),d=Nn(a);return typeof l[d]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=Qe.generateChildLogger(t,this.name),this.core=r}get context(){return Qe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Tp(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Rp(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}}class O2 extends bm{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new ur.exports.EventEmitter,this.name=s2,this.queue=new Map,this.publishTimeout=ye.toMiliseconds(ye.TEN_SECONDS),this.queueTimeout=ye.toMiliseconds(ye.FIVE_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,l)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:l}});try{const d=(l==null?void 0:l.ttl)||n2,p=Yc(l),v=(l==null?void 0:l.prompt)||!1,w=(l==null?void 0:l.tag)||0,x=(l==null?void 0:l.id)||_u().toString(),D={topic:s,message:a,opts:{ttl:d,relay:p,prompt:v,tag:w,id:x}},j=setTimeout(()=>this.queue.set(x,D),this.queueTimeout);try{await await Fo(this.rpcPublish(s,a,d,p,v,w,x),this.publishTimeout),clearTimeout(j),this.relayer.events.emit(At.publish,D)}catch{this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0;return}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:l}})}catch(d){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(d),d}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=t,this.logger=Qe.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Qe.getLoggerContext(this.logger)}rpcPublish(t,r,s,a,l,d,p){var v,w,x,D;const j={method:Co(a.protocol).publish,params:{topic:t,message:r,ttl:s,prompt:l,tag:d},id:p};return or((v=j.params)==null?void 0:v.prompt)&&((w=j.params)==null||delete w.prompt),or((x=j.params)==null?void 0:x.tag)&&((D=j.params)==null||delete D.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:j}),this.relayer.request(j)}onPublish(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:s,opts:a}=t;await this.publish(r,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Rn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(At.connection_stalled);return}this.checkQueue()}),this.relayer.on(At.message_ack,t=>{this.onPublish(t.id.toString())})}}class P2{constructor(){this.map=new Map,this.set=(t,r)=>{const s=this.get(t);this.exists(t,r)||this.map.set(t,[...s,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,r))return;const a=s.filter(l=>l!==r);if(!a.length){this.map.delete(t);return}this.map.set(t,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var A2=Object.defineProperty,C2=Object.defineProperties,N2=Object.getOwnPropertyDescriptors,Rf=Object.getOwnPropertySymbols,T2=Object.prototype.hasOwnProperty,R2=Object.prototype.propertyIsEnumerable,Uf=(n,t,r)=>t in n?A2(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,hs=(n,t)=>{for(var r in t||(t={}))T2.call(t,r)&&Uf(n,r,t[r]);if(Rf)for(var r of Rf(t))R2.call(t,r)&&Uf(n,r,t[r]);return n},Rc=(n,t)=>C2(n,N2(t));class U2 extends Sm{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new P2,this.events=new ur.exports.EventEmitter,this.name=d2,this.version=g2,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Ri,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const l=Yc(a),d={topic:s,relay:l};this.pending.set(s,d);const p=await this.rpcSubscribe(s,l);return this.onSubscribe(p,d),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),p}catch(l){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(l),l}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,l)=>{const d=new ye.Watch;d.start(this.pendingSubscriptionWatchLabel);const p=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(p),d.stop(this.pendingSubscriptionWatchLabel),a(!0)),d.elapsed(this.pendingSubscriptionWatchLabel)>=v2&&(clearInterval(p),d.stop(this.pendingSubscriptionWatchLabel),l(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Qe.generateChildLogger(r,this.name),this.clientId=""}get context(){return Qe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let s=!1;try{s=this.getSubscription(t).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const s=this.topicMap.get(t);await Promise.all(s.map(async a=>await this.unsubscribeById(t,a,r)))}async unsubscribeById(t,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}});try{const a=Yc(s);await this.rpcUnsubscribe(t,r,a);const l=Ut("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,l),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(t,r){const s={method:Co(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await Fo(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(At.connection_stalled)}return Nn(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,s={method:Co(r.protocol).batchSubscribe,params:{topics:t.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await Fo(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(At.connection_stalled)}}rpcUnsubscribe(t,r,s){const a={method:Co(s.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(t,r){this.setSubscription(t,Rc(hs({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,hs({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,hs({},r)),this.topicMap.set(r.topic,t),this.events.emit(ri.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:s}=ue("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(ri.deleted,Rc(hs({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(ri.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(ri.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=ue("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);ii(r)&&this.onBatchSubscribe(r.map((s,a)=>Rc(hs({},t[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(Rn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(At.connect,async()=>{await this.onConnect()}),this.relayer.on(At.disconnect,()=>{this.onDisconnect()}),this.events.on(ri.created,async t=>{const r=ri.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(ri.deleted,async t=>{const r=ri.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var D2=Object.defineProperty,Df=Object.getOwnPropertySymbols,L2=Object.prototype.hasOwnProperty,F2=Object.prototype.propertyIsEnumerable,Lf=(n,t,r)=>t in n?D2(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,$2=(n,t)=>{for(var r in t||(t={}))L2.call(t,r)&&Lf(n,r,t[r]);if(Df)for(var r of Df(t))F2.call(t,r)&&Lf(n,r,t[r]);return n};class M2 extends wm{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new ur.exports.EventEmitter,this.name=a2,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Qe.generateChildLogger(t.logger,this.name):Qe.pino(Qe.getDefaultLoggerOptions({level:t.logger||o2})),this.messages=new x2(this.logger,t.core),this.subscriber=new U2(this,this.logger),this.publisher=new O2(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||id,this.projectId=t.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Nf}...`),await this.restartTransport(Nf)}this.registerEventListeners(),this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},l2)}get context(){return Qe.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,s){this.isInitialized(),await this.publisher.publish(t,r,s),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";return a||(await Promise.all([new Promise(l=>{this.subscriber.once(ri.created,d=>{d.topic===t&&l()})}),new Promise(async l=>{a=await this.subscriber.subscribe(t,r),l()})]),a)}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(At.transport_closed))}async transportOpen(t){if(this.transportExplicitlyClosed=!1,!this.reconnecting){this.relayUrl=t||this.relayUrl,this.reconnecting=!0;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(ri.resubscribed,()=>{r()})}),await Promise.race([new Promise(async(r,s)=>{await Fo(this.provider.connect(),5e3,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(a=>s(a)).then(()=>r()).finally(()=>this.removeListener(At.transport_closed,this.rejectTransportOpen))}),new Promise(r=>this.once(At.transport_closed,this.rejectTransportOpen))])])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.events.emit(At.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(t){this.transportExplicitlyClosed||this.reconnecting||(this.relayUrl=t||this.relayUrl,this.connected&&await Promise.all([new Promise(r=>{this.provider.once(cs.disconnect,()=>{r()})}),this.transportClose()]),await this.createProvider(),await this.transportOpen())}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}rejectTransportOpen(){throw new Error("Attempt to connect to relay via `transportOpen` has stalled. Retrying...")}async createProvider(){const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Di(new SE(dw({sdkVersion:h2,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:s}=t;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(t){const{topic:r,message:s}=t;return await this.subscriber.isSubscribed(r)?this.messages.has(r,s):!0}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),bu(t)){if(!t.method.endsWith(c2))return;const r=t.params,{topic:s,message:a,publishedAt:l}=r.data,d={topic:s,message:a,publishedAt:l};this.logger.debug("Emitting Relayer Payload"),this.logger.trace($2({type:"event",event:r.id},d)),this.events.emit(r.id,d),await this.acknowledgePayload(t),await this.onMessageEvent(d)}else Go(t)&&this.events.emit(At.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(At.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=mu(t.id,!0);await this.provider.connection.send(r)}registerProviderListeners(){this.provider.on(cs.payload,t=>this.onProviderPayload(t)),this.provider.on(cs.connect,()=>{this.events.emit(At.connect)}),this.provider.on(cs.disconnect,()=>{this.onProviderDisconnect()}),this.provider.on(cs.error,t=>{this.logger.error(t),this.events.emit(At.error,t)})}registerEventListeners(){this.events.on(At.connection_stalled,async()=>{await this.restartTransport()})}onProviderDisconnect(){this.events.emit(At.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.restartTransport()},ye.toMiliseconds(u2))}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(!this.connected){if(this.connecting)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var j2=Object.defineProperty,Ff=Object.getOwnPropertySymbols,q2=Object.prototype.hasOwnProperty,z2=Object.prototype.propertyIsEnumerable,$f=(n,t,r)=>t in n?j2(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Mf=(n,t)=>{for(var r in t||(t={}))q2.call(t,r)&&$f(n,r,t[r]);if(Ff)for(var r of Ff(t))z2.call(t,r)&&$f(n,r,t[r]);return n};class Yo extends Em{constructor(t,r,s,a=Ri,l=void 0){super(t,r,s,a),this.core=t,this.logger=r,this.name=s,this.map=new Map,this.version=f2,this.cached=[],this.initialized=!1,this.storagePrefix=Ri,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(d=>{this.getKey&&d!==null&&!or(d)?this.map.set(this.getKey(d),d):$w(d)?this.map.set(d.id,d):Mw(d)&&this.map.set(d.topic,d)}),this.cached=[],this.initialized=!0)},this.set=async(d,p)=>{this.isInitialized(),this.map.has(d)?await this.update(d,p):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:d,value:p}),this.map.set(d,p),await this.persist())},this.get=d=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:d}),this.getData(d)),this.getAll=d=>(this.isInitialized(),d?this.values.filter(p=>Object.keys(d).every(v=>IE(p[v],d[v]))):this.values),this.update=async(d,p)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:d,update:p});const v=Mf(Mf({},this.getData(d)),p);this.map.set(d,v),await this.persist()},this.delete=async(d,p)=>{this.isInitialized(),this.map.has(d)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:d,reason:p}),this.map.delete(d),await this.persist())},this.logger=Qe.generateChildLogger(r,this.name),this.storagePrefix=a,this.getKey=l}get context(){return Qe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:s}=ue("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=ue("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}}class H2{constructor(t,r){this.core=t,this.logger=r,this.name=y2,this.version=_2,this.events=new ur.exports,this.initialized=!1,this.storagePrefix=Ri,this.ignoredPayloadTypes=[nn],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=Wc(),a=await this.core.crypto.setSymKey(s),l=kr(ye.FIVE_MINUTES),d={protocol:rd},p={topic:a,expiry:l,relay:d,active:!1},v=Pw({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:d});return await this.pairings.set(a,p),await this.core.relayer.subscribe(a),this.core.expirer.set(a,l),{topic:a,uri:v}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:l,relay:d}=Iw(s.uri);if(this.pairings.keys.includes(a))throw new Error(`Pairing already exists: ${a}`);if(this.core.crypto.hasKeys(a))throw new Error(`Keychain already exists: ${a}`);const p=kr(ye.FIVE_MINUTES),v={topic:a,relay:d,expiry:p,active:!1};return await this.pairings.set(a,v),await this.core.crypto.setSymKey(l,a),await this.core.relayer.subscribe(a,{relay:d}),this.core.expirer.set(a,p),s.activatePairing&&await this.activate({topic:a}),v},this.activate=async({topic:s})=>{this.isInitialized();const a=kr(ye.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const l=await this.sendRequest(a,"wc_pairingPing",{}),{done:d,resolve:p,reject:v}=An();this.events.once(Ht("pairing_ping",l),({error:w})=>{w?v(w):p()}),await d()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",Ut("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,l)=>{const d=Vo(a,l),p=await this.core.crypto.encode(s,d),v=us[a].req;return this.core.history.set(s,d),this.core.relayer.publish(s,p,v),d.id},this.sendResult=async(s,a,l)=>{const d=mu(s,l),p=await this.core.crypto.encode(a,d),v=await this.core.history.get(a,s),w=us[v.request.method].res;await this.core.relayer.publish(a,p,w),await this.core.history.resolve(d)},this.sendError=async(s,a,l)=>{const d=ko(s,l),p=await this.core.crypto.encode(a,d),v=await this.core.history.get(a,s),w=us[v.request.method]?us[v.request.method].res:us.unregistered_method.res;await this.core.relayer.publish(a,p,w),await this.core.history.resolve(d)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,Ut("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>Ni(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:l}=s,d=l.method;if(this.pairings.keys.includes(a))switch(d){case"wc_pairingPing":return this.onPairingPingRequest(a,l);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,l);default:return this.onUnknownRpcMethodRequest(a,l)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:l}=s,d=(await this.core.history.get(a,l.id)).request.method;if(this.pairings.keys.includes(a))switch(d){case"wc_pairingPing":return this.onPairingPingResponse(a,l);default:return this.onUnknownRpcMethodResponse(d)}},this.onPairingPingRequest=async(s,a)=>{const{id:l}=a;try{this.isValidPing({topic:s}),await this.sendResult(l,s,!0),this.events.emit("pairing_ping",{id:l,topic:s})}catch(d){await this.sendError(l,s,d),this.logger.error(d)}},this.onPairingPingResponse=(s,a)=>{const{id:l}=a;setTimeout(()=>{_i(a)?this.events.emit(Ht("pairing_ping",l),{}):Gr(a)&&this.events.emit(Ht("pairing_ping",l),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:l}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit("pairing_delete",{id:l,topic:s})}catch(d){await this.sendError(l,s,d),this.logger.error(d)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:l,method:d}=a;try{if(this.registeredMethods.includes(d))return;const p=Ut("WC_METHOD_UNSUPPORTED",d);await this.sendError(l,s,p),this.logger.error(p)}catch(p){await this.sendError(l,s,p),this.logger.error(p)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(Ut("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{if(!vr(s)){const{message:a}=ue("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(a)}if(!Fw(s.uri)){const{message:a}=ue("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(a)}},this.isValidPing=async s=>{if(!vr(s)){const{message:l}=ue("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(l)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!vr(s)){const{message:l}=ue("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(l)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!Gt(s,!1)){const{message:a}=ue("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=ue("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(Ni(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=ue("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=t,this.logger=Qe.generateChildLogger(r,this.name),this.pairings=new Yo(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Qe.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(At.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(r,s);bu(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Go(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))})}registerExpirerEvents(){this.core.expirer.on(Fr.expired,async t=>{const{topic:r}=Dp(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class K2 extends _m{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new ur.exports.EventEmitter,this.name=m2,this.version=b2,this.cached=[],this.initialized=!1,this.storagePrefix=Ri,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,l)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:l}),this.records.has(a.id))return;const d={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:l,expiry:kr(ye.THIRTY_DAYS)};this.records.set(d.id,d),this.events.emit(ti.created,d)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=Gr(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(ti.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(l=>{if(l.topic===s){if(typeof a<"u"&&l.id!==a)return;this.records.delete(l.id),this.events.emit(ti.deleted,l)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Qe.generateChildLogger(r,this.name)}get context(){return Qe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:Vo(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:s}=ue("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(ti.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=ue("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(ti.created,t=>{const r=ti.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(ti.updated,t=>{const r=ti.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(ti.deleted,t=>{const r=ti.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(Rn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{ye.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}}class B2 extends Im{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new ur.exports.EventEmitter,this.name=w2,this.version=E2,this.cached=[],this.initialized=!1,this.storagePrefix=Ri,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const l=this.formatTarget(s),d={target:l,expiry:a};this.expirations.set(l,d),this.checkExpiry(l,d),this.events.emit(Fr.created,{target:l,expiration:d})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),l=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Fr.deleted,{target:a,expiration:l})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Qe.generateChildLogger(r,this.name)}get context(){return Qe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return gw(t);if(typeof t=="number")return vw(t);const{message:r}=ue("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Fr.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=ue("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:s}=ue("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(t,r){const{expiry:s}=r;ye.toMiliseconds(s)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Fr.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(Rn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Fr.created,t=>{const r=Fr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Fr.expired,t=>{const r=Fr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Fr.deleted,t=>{const r=Fr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}}class V2 extends xm{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=Tc,this.initialized=!1,this.init=async s=>{Np()||!pu()||(this.verifyUrl=(s==null?void 0:s.verifyUrl)||Tf,await this.createIframe())},this.register=async s=>{var a;if(this.initialized||await this.init(),!!this.iframe)try{(a=this.iframe.contentWindow)==null||a.postMessage(s.attestationId,this.verifyUrl),this.logger.info(`postMessage sent: ${s.attestationId} ${this.verifyUrl}`)}catch{}},this.resolve=async s=>{var a;if(this.isDevEnv)return"";this.logger.info(`resolving attestation: ${s.attestationId}`);const l=this.startAbortTimer(ye.FIVE_SECONDS),d=await fetch(`${this.verifyUrl}/attestation/${s.attestationId}`,{signal:this.abortController.signal});return clearTimeout(l),d.status===200?(a=await d.json())==null?void 0:a.origin:""},this.createIframe=async()=>{try{await Promise.race([new Promise((s,a)=>{if(document.getElementById(Tc))return s();const l=document.createElement("iframe");l.setAttribute("id",Tc),l.setAttribute("src",`${this.verifyUrl}/${this.projectId}`),l.style.display="none",l.addEventListener("load",()=>{this.initialized=!0,s()}),l.addEventListener("error",d=>{a(d)}),document.body.append(l),this.iframe=l}),new Promise(s=>{setTimeout(()=>s("iframe load timeout"),ye.toMiliseconds(ye.ONE_SECOND/2))})])}catch(s){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(s)}},this.logger=Qe.generateChildLogger(r,this.name),this.verifyUrl=Tf,this.abortController=new AbortController,this.isDevEnv=fu()&&{}.IS_VITEST}get context(){return Qe.getLoggerContext(this.logger)}startAbortTimer(t){return setTimeout(()=>this.abortController.abort(),ye.toMiliseconds(t))}}var k2=Object.defineProperty,jf=Object.getOwnPropertySymbols,G2=Object.prototype.hasOwnProperty,W2=Object.prototype.propertyIsEnumerable,qf=(n,t,r)=>t in n?k2(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,zf=(n,t)=>{for(var r in t||(t={}))G2.call(t,r)&&qf(n,r,t[r]);if(jf)for(var r of jf(t))W2.call(t,r)&&qf(n,r,t[r]);return n};class Eu extends ym{constructor(t){super(t),this.protocol=td,this.version=Y6,this.name=wu,this.events=new ur.exports.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||id;const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Qe.pino(Qe.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||J6.logger}));this.logger=Qe.generateChildLogger(r,this.name),this.heartbeat=new Rn.HeartBeat,this.crypto=new I2(this,this.logger,t==null?void 0:t.keychain),this.history=new K2(this,this.logger),this.expirer=new B2(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new em(zf(zf({},X6),t==null?void 0:t.storageOptions)),this.relayer=new M2({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new H2(this,this.logger),this.verify=new V2(this.projectId||"",this.logger)}static async init(t){const r=new Eu(t);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(p2,s),r}get context(){return Qe.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const Y2=Eu,nd="wc",sd=2,od="client",Su=`${nd}@${sd}:${od}:`,Uc={name:od,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},J2="WALLETCONNECT_DEEPLINK_CHOICE",X2="proposal",ad="Proposal expired",Z2="session",Oo=ye.SEVEN_DAYS,Q2="engine",ls={wc_sessionPropose:{req:{ttl:ye.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ye.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ye.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ye.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ye.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ye.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ye.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ye.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ye.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ye.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ye.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ye.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ye.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ye.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ye.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ye.THIRTY_SECONDS,prompt:!1,tag:1115}}},Dc={min:ye.FIVE_MINUTES,max:ye.SEVEN_DAYS},e5="request",t5=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var r5=Object.defineProperty,i5=Object.defineProperties,n5=Object.getOwnPropertyDescriptors,Hf=Object.getOwnPropertySymbols,s5=Object.prototype.hasOwnProperty,o5=Object.prototype.propertyIsEnumerable,Kf=(n,t,r)=>t in n?r5(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Lr=(n,t)=>{for(var r in t||(t={}))s5.call(t,r)&&Kf(n,r,t[r]);if(Hf)for(var r of Hf(t))o5.call(t,r)&&Kf(n,r,t[r]);return n},Lc=(n,t)=>i5(n,n5(t));class a5 extends Pm{constructor(t){super(t),this.name=Q2,this.events=new ur.exports,this.initialized=!1,this.ignoredPayloadTypes=[nn],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(ls)}),this.initialized=!0)},this.connect=async r=>{this.isInitialized();const s=Lc(Lr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:l,optionalNamespaces:d,sessionProperties:p,relays:v}=s;let w=a,x,D=!1;if(w&&(D=this.client.core.pairing.pairings.get(w).active),!w||!D){const{topic:F,uri:S}=await this.client.core.pairing.create();w=F,x=S}const j=await this.client.core.crypto.generateKeyPair(),U=Lr({requiredNamespaces:l,optionalNamespaces:d,relays:v!=null?v:[{protocol:rd}],proposer:{publicKey:j,metadata:this.client.metadata}},p&&{sessionProperties:p}),{reject:z,resolve:K,done:B}=An(ye.FIVE_MINUTES,ad);if(this.events.once(Ht("session_connect"),async({error:F,session:S})=>{if(F)z(F);else if(S){S.self.publicKey=j;const P=Lc(Lr({},S),{requiredNamespaces:S.requiredNamespaces,optionalNamespaces:S.optionalNamespaces});await this.client.session.set(S.topic,P),await this.setExpiry(S.topic,S.expiry),w&&await this.client.core.pairing.updateMetadata({topic:w,metadata:S.peer.metadata}),K(P)}}),!w){const{message:F}=ue("NO_MATCHING_KEY",`connect() pairing topic: ${w}`);throw new Error(F)}const oe=await this.sendRequest(w,"wc_sessionPropose",U),C=kr(ye.FIVE_MINUTES);return await this.setProposal(oe,Lr({id:oe,expiry:C},U)),{uri:x,approval:B}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:a,namespaces:l,sessionProperties:d}=r,p=this.client.proposal.get(s);let{pairingTopic:v,proposer:w,requiredNamespaces:x,optionalNamespaces:D}=p;v=v||"",Tn(x)||(x=Tw(l,"approve()"));const j=await this.client.core.crypto.generateKeyPair(),U=w.publicKey,z=await this.client.core.crypto.generateSharedKey(j,U);v&&s&&(await this.client.core.pairing.updateMetadata({topic:v,metadata:w.metadata}),await this.sendResult(s,v,{relay:{protocol:a!=null?a:"irn"},responderPublicKey:j}),await this.client.proposal.delete(s,Ut("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:v}));const K=Lr({relay:{protocol:a!=null?a:"irn"},namespaces:l,requiredNamespaces:x,optionalNamespaces:D,pairingTopic:v,controller:{publicKey:j,metadata:this.client.metadata},expiry:kr(Oo)},d&&{sessionProperties:d});await this.client.core.relayer.subscribe(z),await this.sendRequest(z,"wc_sessionSettle",K);const B=Lc(Lr({},K),{topic:z,pairingTopic:v,acknowledged:!1,self:K.controller,peer:{publicKey:w.publicKey,metadata:w.metadata},controller:j});return await this.client.session.set(z,B),await this.setExpiry(z,kr(Oo)),{topic:z,acknowledged:()=>new Promise(oe=>setTimeout(()=>oe(this.client.session.get(z)),500))}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:s,reason:a}=r,{pairingTopic:l}=this.client.proposal.get(s);l&&(await this.sendError(s,l,a),await this.client.proposal.delete(s,Ut("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:a}=r,l=await this.sendRequest(s,"wc_sessionUpdate",{namespaces:a}),{done:d,resolve:p,reject:v}=An();return this.events.once(Ht("session_update",l),({error:w})=>{w?v(w):p()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:d}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,a=await this.sendRequest(s,"wc_sessionExtend",{}),{done:l,resolve:d,reject:p}=An();return this.events.once(Ht("session_extend",a),({error:v})=>{v?p(v):d()}),await this.setExpiry(s,kr(Oo)),{acknowledged:l}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:a,topic:l,expiry:d}=r,p=await this.sendRequest(l,"wc_sessionRequest",{request:a,chainId:s},d),{done:v,resolve:w,reject:x}=An(d);this.events.once(Ht("session_request",p),({error:j,result:U})=>{j?x(j):w(U)}),this.client.events.emit("session_request_sent",{topic:l,request:a,chainId:s,id:p});const D=await this.client.core.storage.getItem(J2);return yw({id:p,topic:l,wcDeepLink:D}),await v()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:a}=r,{id:l}=a;_i(a)?await this.sendResult(l,s,a.result):Gr(a)&&await this.sendError(l,s,a.error),this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0})},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=await this.sendRequest(s,"wc_sessionPing",{}),{done:l,resolve:d,reject:p}=An();this.events.once(Ht("session_ping",a),({error:v})=>{v?p(v):d()}),await l()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:a,chainId:l}=r;await this.sendRequest(s,"wc_sessionEvent",{event:a,chainId:l})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=_u().toString();let l;const d=p=>{(p==null?void 0:p.id.toString())===a&&(this.client.core.relayer.events.removeListener(At.message_ack,d),l())};await Promise.all([new Promise(p=>{l=p,this.client.core.relayer.on(At.message_ack,d)}),this.sendRequest(s,"wc_sessionDelete",Ut("USER_DISCONNECTED"),void 0,a)]),await this.deleteSession(s)}else await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>Dw(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(l=>{var d,p;return((d=l.peerMetadata)==null?void 0:d.url)&&((p=l.peerMetadata)==null?void 0:p.url)===r.peer.metadata.url&&l.topic&&l.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(l=>this.client.core.pairing.disconnect({topic:l.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,Ut("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r)},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,Ut("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),a?Promise.resolve():this.client.core.expirer.del(r)])},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=ls.wc_sessionRequest.req.ttl,{id:a,topic:l,params:d}=r;await this.client.pendingRequest.set(a,{id:a,topic:l,params:d}),s&&this.client.core.expirer.set(a,kr(s))},this.sendRequest=async(r,s,a,l,d)=>{const p=Vo(s,a);if(pu()&&t5.includes(s)){const x=Nn(JSON.stringify(p));await this.client.core.verify.register({attestationId:x})}const v=await this.client.core.crypto.encode(r,p),w=ls[s].req;return l&&(w.ttl=l),d&&(w.id=d),this.client.core.history.set(r,p),this.client.core.relayer.publish(r,v,w),p.id},this.sendResult=async(r,s,a)=>{const l=mu(r,a),d=await this.client.core.crypto.encode(s,l),p=await this.client.core.history.get(s,r),v=ls[p.request.method].res;this.client.core.relayer.publish(s,d,v),await this.client.core.history.resolve(l)},this.sendError=async(r,s,a)=>{const l=ko(r,a),d=await this.client.core.crypto.encode(s,l),p=await this.client.core.history.get(s,r),v=ls[p.request.method].res;this.client.core.relayer.publish(s,d,v),await this.client.core.history.resolve(l)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(a=>{Ni(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Ni(a.expiry)&&s.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=r=>{const{topic:s,payload:a}=r,l=a.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${l}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:a}=r,l=(await this.client.core.history.get(s,a.id)).request.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${l}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:a}=ue("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,s)=>{const{params:a,id:l}=s;try{this.isValidConnect(Lr({},s.params));const d=kr(ye.FIVE_MINUTES),p=Lr({id:l,pairingTopic:r,expiry:d},a);await this.setProposal(l,p);const v=Nn(JSON.stringify(s)),w=await this.getVerifyContext(v,p.proposer.metadata);this.client.events.emit("session_proposal",{id:l,params:p,verifyContext:w})}catch(d){await this.sendError(l,r,d),this.client.logger.error(d)}},this.onSessionProposeResponse=async(r,s)=>{const{id:a}=s;if(_i(s)){const{result:l}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:l});const d=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:d});const p=d.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:p});const v=l.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:v});const w=await this.client.core.crypto.generateSharedKey(p,v);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:w});const x=await this.client.core.relayer.subscribe(w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:x}),await this.client.core.pairing.activate({topic:r})}else Gr(s)&&(await this.client.proposal.delete(a,Ut("USER_DISCONNECTED")),this.events.emit(Ht("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:a,params:l}=s;try{this.isValidSessionSettleRequest(l);const{relay:d,controller:p,expiry:v,namespaces:w,requiredNamespaces:x,optionalNamespaces:D,sessionProperties:j,pairingTopic:U}=s.params,z=Lr({topic:r,relay:d,expiry:v,namespaces:w,acknowledged:!0,pairingTopic:U,requiredNamespaces:x,optionalNamespaces:D,controller:p.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:p.publicKey,metadata:p.metadata}},j&&{sessionProperties:j});await this.sendResult(s.id,r,!0),this.events.emit(Ht("session_connect"),{session:z}),this.cleanupDuplicatePairings(z)}catch(d){await this.sendError(a,r,d),this.client.logger.error(d)}},this.onSessionSettleResponse=async(r,s)=>{const{id:a}=s;_i(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ht("session_approve",a),{})):Gr(s)&&(await this.client.session.delete(r,Ut("USER_DISCONNECTED")),this.events.emit(Ht("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:a,id:l}=s;try{this.isValidUpdate(Lr({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult(l,r,!0),this.client.events.emit("session_update",{id:l,topic:r,params:a})}catch(d){await this.sendError(l,r,d),this.client.logger.error(d)}},this.onSessionUpdateResponse=(r,s)=>{const{id:a}=s;_i(s)?this.events.emit(Ht("session_update",a),{}):Gr(s)&&this.events.emit(Ht("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:a}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,kr(Oo)),await this.sendResult(a,r,!0),this.client.events.emit("session_extend",{id:a,topic:r})}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionExtendResponse=(r,s)=>{const{id:a}=s;_i(s)?this.events.emit(Ht("session_extend",a),{}):Gr(s)&&this.events.emit(Ht("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:a}=s;try{this.isValidPing({topic:r}),await this.sendResult(a,r,!0),this.client.events.emit("session_ping",{id:a,topic:r})}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionPingResponse=(r,s)=>{const{id:a}=s;setTimeout(()=>{_i(s)?this.events.emit(Ht("session_ping",a),{}):Gr(s)&&this.events.emit(Ht("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(l=>{this.client.core.relayer.once(At.publish,async()=>{l(await this.deleteSession(r))})}),this.sendResult(a,r,!0)]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(l){this.client.logger.error(l)}},this.onSessionRequest=async(r,s)=>{const{id:a,params:l}=s;try{this.isValidRequest(Lr({topic:r},l)),await this.setPendingSessionRequest({id:a,topic:r,params:l});const d=Nn(JSON.stringify(s)),p=this.client.session.get(r),v=await this.getVerifyContext(d,p.peer.metadata);this.client.events.emit("session_request",{id:a,topic:r,params:l,verifyContext:v})}catch(d){await this.sendError(a,r,d),this.client.logger.error(d)}},this.onSessionRequestResponse=(r,s)=>{const{id:a}=s;_i(s)?this.events.emit(Ht("session_request",a),{result:s.result}):Gr(s)&&this.events.emit(Ht("session_request",a),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:a,params:l}=s;try{this.isValidEmit(Lr({topic:r},l)),this.client.events.emit("session_event",{id:a,topic:r,params:l})}catch(d){await this.sendError(a,r,d),this.client.logger.error(d)}},this.isValidConnect=async r=>{if(!vr(r)){const{message:v}=ue("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(v)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:l,sessionProperties:d,relays:p}=r;if(or(s)||await this.isValidPairingTopic(s),!kw(p,!0)){const{message:v}=ue("MISSING_OR_INVALID",`connect() relays: ${p}`);throw new Error(v)}!or(a)&&Tn(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!or(l)&&Tn(l)!==0&&this.validateNamespaces(l,"optionalNamespaces"),or(d)||this.validateSessionProps(d,"sessionProperties")},this.validateNamespaces=(r,s)=>{const a=Vw(r,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!vr(r))throw new Error(ue("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:a,relayProtocol:l,sessionProperties:d}=r;await this.isValidProposalId(s);const p=this.client.proposal.get(s),v=To(a,"approve()");if(v)throw new Error(v.message);const w=df(p.requiredNamespaces,a,"approve()");if(w)throw new Error(w.message);if(!Gt(l,!0)){const{message:x}=ue("MISSING_OR_INVALID",`approve() relayProtocol: ${l}`);throw new Error(x)}or(d)||this.validateSessionProps(d,"sessionProperties")},this.isValidReject=async r=>{if(!vr(r)){const{message:l}=ue("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(l)}const{id:s,reason:a}=r;if(await this.isValidProposalId(s),!Ww(a)){const{message:l}=ue("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(l)}},this.isValidSessionSettleRequest=r=>{if(!vr(r)){const{message:w}=ue("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(w)}const{relay:s,controller:a,namespaces:l,expiry:d}=r;if(!Fp(s)){const{message:w}=ue("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(w)}const p=jw(a,"onSessionSettleRequest()");if(p)throw new Error(p.message);const v=To(l,"onSessionSettleRequest()");if(v)throw new Error(v.message);if(Ni(d)){const{message:w}=ue("EXPIRED","onSessionSettleRequest()");throw new Error(w)}},this.isValidUpdate=async r=>{if(!vr(r)){const{message:v}=ue("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(v)}const{topic:s,namespaces:a}=r;await this.isValidSessionTopic(s);const l=this.client.session.get(s),d=To(a,"update()");if(d)throw new Error(d.message);const p=df(l.requiredNamespaces,a,"update()");if(p)throw new Error(p.message)},this.isValidExtend=async r=>{if(!vr(r)){const{message:a}=ue("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!vr(r)){const{message:v}=ue("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(v)}const{topic:s,request:a,chainId:l,expiry:d}=r;await this.isValidSessionTopic(s);const{namespaces:p}=this.client.session.get(s);if(!pf(p,l)){const{message:v}=ue("MISSING_OR_INVALID",`request() chainId: ${l}`);throw new Error(v)}if(!Yw(a)){const{message:v}=ue("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(v)}if(!Zw(p,l,a.method)){const{message:v}=ue("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(v)}if(d&&!rE(d,Dc)){const{message:v}=ue("MISSING_OR_INVALID",`request() expiry: ${d}. Expiry must be a number (in seconds) between ${Dc.min} and ${Dc.max}`);throw new Error(v)}},this.isValidRespond=async r=>{if(!vr(r)){const{message:l}=ue("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:s,response:a}=r;if(await this.isValidSessionTopic(s),!Jw(a)){const{message:l}=ue("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!vr(r)){const{message:a}=ue("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!vr(r)){const{message:p}=ue("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(p)}const{topic:s,event:a,chainId:l}=r;await this.isValidSessionTopic(s);const{namespaces:d}=this.client.session.get(s);if(!pf(d,l)){const{message:p}=ue("MISSING_OR_INVALID",`emit() chainId: ${l}`);throw new Error(p)}if(!Xw(a)){const{message:p}=ue("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(p)}if(!Qw(d,l,a.name)){const{message:p}=ue("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(p)}},this.isValidDisconnect=async r=>{if(!vr(r)){const{message:a}=ue("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const a={verified:{verifyUrl:s.verifyUrl||"",validation:"UNKNOWN",origin:s.url||""}};try{const l=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});l&&(a.verified.origin=l,a.verified.validation=l===s.url?"VALID":"INVALID")}catch(l){this.client.logger.error(l)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(a=>{if(!Gt(a,!1)){const{message:l}=ue("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(l)}})}}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.client.core.relayer.on(At.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(r,s);bu(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Go(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})})}registerExpirerEvents(){this.client.core.expirer.on(Fr.expired,async t=>{const{topic:r,id:s}=Dp(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,ue("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}isValidPairingTopic(t){if(!Gt(t,!1)){const{message:r}=ue("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=ue("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(Ni(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=ue("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!Gt(t,!1)){const{message:r}=ue("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=ue("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(Ni(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=ue("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(Gt(t,!1)){const{message:r}=ue("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=ue("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!Gw(t)){const{message:r}=ue("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=ue("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(Ni(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=ue("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class c5 extends Yo{constructor(t,r){super(t,r,X2,Su),this.core=t,this.logger=r}}class u5 extends Yo{constructor(t,r){super(t,r,Z2,Su),this.core=t,this.logger=r}}class h5 extends Yo{constructor(t,r){super(t,r,e5,Su,s=>s.id),this.core=t,this.logger=r}}class Iu extends Om{constructor(t){super(t),this.protocol=nd,this.version=sd,this.name=Uc.name,this.events=new ur.exports.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||Uc.name,this.metadata=(t==null?void 0:t.metadata)||hw();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Qe.pino(Qe.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||Uc.logger}));this.core=(t==null?void 0:t.core)||new Y2(t),this.logger=Qe.generateChildLogger(r,this.name),this.session=new u5(this.core,this.logger),this.proposal=new c5(this.core,this.logger),this.pendingRequest=new h5(this.core,this.logger),this.engine=new a5(this)}static async init(t){const r=new Iu(t);return await r.initialize(),r}get context(){return Qe.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}}const l5={Accept:"application/json","Content-Type":"application/json"},f5="POST",Bf={headers:l5,method:f5},Vf=10;class sn{constructor(t,r=!1){if(this.url=t,this.disableProviderPing=r,this.events=new ur.exports.EventEmitter,this.isAvailable=!1,this.registering=!1,!mf(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t,r){this.isAvailable||await this.register();try{const s=gs(t),l=await(await Ol(this.url,Object.assign(Object.assign({},Bf),{body:s}))).json();this.onPayload({data:l})}catch(s){this.onError(t.id,s)}}async register(t=this.url){if(!mf(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),a(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return a(new Error("HTTP connection is missing or invalid"));s()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const r=gs({id:1,jsonrpc:"2.0",method:"test",params:[]});await Ol(t,Object.assign(Object.assign({},Bf),{body:r}))}this.onOpen()}catch(r){const s=this.parseError(r);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?iu(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),l=ko(t,a);this.events.emit("payload",l)}parseError(t,r=this.url){return jp(t,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Vf&&this.events.setMaxListeners(Vf)}}const kf="error",p5="wss://relay.walletconnect.com",d5="wc",g5="universal_provider",Gf=`${d5}@2:${g5}:`,v5="https://rpc.walletconnect.com/v1",Li={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var fs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof $r<"u"?$r:typeof self<"u"?self:{},Qc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(n,t){(function(){var r,s="4.17.21",a=200,l="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",d="Expected a function",p="Invalid `variable` option passed into `_.template`",v="__lodash_hash_undefined__",w=500,x="__lodash_placeholder__",D=1,j=2,U=4,z=1,K=2,B=1,oe=2,C=4,F=8,S=16,P=32,m=64,u=128,_=256,G=512,k=30,se="...",ce=800,ge=16,N=1,q=2,le=3,te=1/0,W=9007199254740991,ee=17976931348623157e292,Y=0/0,re=4294967295,Oe=re-1,ie=re>>>1,be=[["ary",u],["bind",B],["bindKey",oe],["curry",F],["curryRight",S],["flip",G],["partial",P],["partialRight",m],["rearg",_]],he="[object Arguments]",_e="[object Array]",M="[object AsyncFunction]",$="[object Boolean]",A="[object Date]",h="[object DOMException]",I="[object Error]",ne="[object Function]",fe="[object GeneratorFunction]",Ie="[object Map]",He="[object Number]",Ve="[object Null]",$e="[object Object]",dt="[object Promise]",gt="[object Proxy]",je="[object RegExp]",xe="[object Set]",Ue="[object String]",De="[object Symbol]",qe="[object Undefined]",Ae="[object WeakMap]",Le="[object WeakSet]",Se="[object ArrayBuffer]",Ce="[object DataView]",Ke="[object Float32Array]",Pe="[object Float64Array]",ke="[object Int8Array]",We="[object Int16Array]",et="[object Int32Array]",tt="[object Uint8Array]",Je="[object Uint8ClampedArray]",Qt="[object Uint16Array]",hr="[object Uint32Array]",Wr=/\b__p \+= '';/g,er=/\b(__p \+=) '' \+/g,ni=/(__e\(.*?\)|\b__t\)) \+\n'';/g,mi=/&(?:amp|lt|gt|quot|#39);/g,Fi=/[&<>"']/g,wt=RegExp(mi.source),vt=RegExp(Fi.source),Et=/<%-([\s\S]+?)%>/g,St=/<%([\s\S]+?)%>/g,mt=/<%=([\s\S]+?)%>/g,yt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Lt=/^\w*$/,Ft=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,It=/[\\^$.*+?()[\]{}|]/g,$t=RegExp(It.source),xt=/^\s+/,Ct=/\s/,Ot=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ht=/\{\n\/\* \[wrapped with (.+)\] \*/,Mt=/,? & /,jt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Jo=/[()=,{}\[\]\/\s]/,Xo=/\\(\\)?/g,Zo=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Or=/\w*$/,Qo=/^[-+]0x[0-9a-f]+$/i,ea=/^0b[01]+$/i,ta=/^\[object .+?Constructor\]$/,ra=/^0o[0-7]+$/i,ia=/^(?:0|[1-9]\d*)$/,si=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,on=/($^)/,na=/['\n\r\u2028\u2029\\]/g,an="\\ud800-\\udfff",sa="\\u0300-\\u036f",oa="\\ufe20-\\ufe2f",cn="\\u20d0-\\u20ff",ws=sa+oa+cn,Es="\\u2700-\\u27bf",qr="a-z\\xdf-\\xf6\\xf8-\\xff",aa="\\xac\\xb1\\xd7\\xf7",ca="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ua="\\u2000-\\u206f",ha=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ss="A-Z\\xc0-\\xd6\\xd8-\\xde",Is="\\ufe0e\\ufe0f",$i=aa+ca+ua+ha,Fn="['\u2019]",Mi="["+an+"]",$n="["+$i+"]",ji="["+ws+"]",xs="\\d+",la="["+Es+"]",Os="["+qr+"]",Ps="[^"+an+$i+xs+Es+qr+Ss+"]",un="\\ud83c[\\udffb-\\udfff]",fa="(?:"+ji+"|"+un+")",As="[^"+an+"]",hn="(?:\\ud83c[\\udde6-\\uddff]){2}",bi="[\\ud800-\\udbff][\\udc00-\\udfff]",_r="["+Ss+"]",Cs="\\u200d",Ns="(?:"+Os+"|"+Ps+")",Yr="(?:"+_r+"|"+Ps+")",Ts="(?:"+Fn+"(?:d|ll|m|re|s|t|ve))?",Rs="(?:"+Fn+"(?:D|LL|M|RE|S|T|VE))?",Us=fa+"?",Ds="["+Is+"]?",pa="(?:"+Cs+"(?:"+[As,hn,bi].join("|")+")"+Ds+Us+")*",oi="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ls="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Fs=Ds+Us+pa,ln="(?:"+[la,hn,bi].join("|")+")"+Fs,da="(?:"+[As+ji+"?",ji,hn,bi,Mi].join("|")+")",Mn=RegExp(Fn,"g"),ga=RegExp(ji,"g"),fn=RegExp(un+"(?="+un+")|"+da+Fs,"g"),$s=RegExp([_r+"?"+Os+"+"+Ts+"(?="+[$n,_r,"$"].join("|")+")",Yr+"+"+Rs+"(?="+[$n,_r+Ns,"$"].join("|")+")",_r+"?"+Ns+"+"+Ts,_r+"+"+Rs,Ls,oi,xs,ln].join("|"),"g"),Ms=RegExp("["+Cs+an+ws+Is+"]"),qi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,js=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],va=-1,ot={};ot[Ke]=ot[Pe]=ot[ke]=ot[We]=ot[et]=ot[tt]=ot[Je]=ot[Qt]=ot[hr]=!0,ot[he]=ot[_e]=ot[Se]=ot[$]=ot[Ce]=ot[A]=ot[I]=ot[ne]=ot[Ie]=ot[He]=ot[$e]=ot[je]=ot[xe]=ot[Ue]=ot[Ae]=!1;var st={};st[he]=st[_e]=st[Se]=st[Ce]=st[$]=st[A]=st[Ke]=st[Pe]=st[ke]=st[We]=st[et]=st[Ie]=st[He]=st[$e]=st[je]=st[xe]=st[Ue]=st[De]=st[tt]=st[Je]=st[Qt]=st[hr]=!0,st[I]=st[ne]=st[Ae]=!1;var b={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},T={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Z={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},pe={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},at=parseFloat,Te=parseInt,ft=typeof fs=="object"&&fs&&fs.Object===Object&&fs,qt=typeof self=="object"&&self&&self.Object===Object&&self,Xe=ft||qt||Function("return this")(),ct=t&&!t.nodeType&&t,Nt=ct&&!0&&n&&!n.nodeType&&n,lr=Nt&&Nt.exports===ct,zt=lr&&ft.process,pt=function(){try{var R=Nt&&Nt.require&&Nt.require("util").types;return R||zt&&zt.binding&&zt.binding("util")}catch{}}(),tr=pt&&pt.isArrayBuffer,zr=pt&&pt.isDate,Pr=pt&&pt.isMap,Jr=pt&&pt.isRegExp,jn=pt&&pt.isSet,zi=pt&&pt.isTypedArray;function Vt(R,V,H){switch(H.length){case 0:return R.call(V);case 1:return R.call(V,H[0]);case 2:return R.call(V,H[0],H[1]);case 3:return R.call(V,H[0],H[1],H[2])}return R.apply(V,H)}function hd(R,V,H,de){for(var Ne=-1,rt=R==null?0:R.length;++Ne<rt;){var Kt=R[Ne];V(de,Kt,H(Kt),R)}return de}function Ar(R,V){for(var H=-1,de=R==null?0:R.length;++H<de&&V(R[H],H,R)!==!1;);return R}function ld(R,V){for(var H=R==null?0:R.length;H--&&V(R[H],H,R)!==!1;);return R}function Pu(R,V){for(var H=-1,de=R==null?0:R.length;++H<de;)if(!V(R[H],H,R))return!1;return!0}function wi(R,V){for(var H=-1,de=R==null?0:R.length,Ne=0,rt=[];++H<de;){var Kt=R[H];V(Kt,H,R)&&(rt[Ne++]=Kt)}return rt}function qs(R,V){var H=R==null?0:R.length;return!!H&&pn(R,V,0)>-1}function ya(R,V,H){for(var de=-1,Ne=R==null?0:R.length;++de<Ne;)if(H(V,R[de]))return!0;return!1}function _t(R,V){for(var H=-1,de=R==null?0:R.length,Ne=Array(de);++H<de;)Ne[H]=V(R[H],H,R);return Ne}function Ei(R,V){for(var H=-1,de=V.length,Ne=R.length;++H<de;)R[Ne+H]=V[H];return R}function _a(R,V,H,de){var Ne=-1,rt=R==null?0:R.length;for(de&&rt&&(H=R[++Ne]);++Ne<rt;)H=V(H,R[Ne],Ne,R);return H}function fd(R,V,H,de){var Ne=R==null?0:R.length;for(de&&Ne&&(H=R[--Ne]);Ne--;)H=V(H,R[Ne],Ne,R);return H}function ma(R,V){for(var H=-1,de=R==null?0:R.length;++H<de;)if(V(R[H],H,R))return!0;return!1}var pd=ba("length");function dd(R){return R.split("")}function gd(R){return R.match(jt)||[]}function Au(R,V,H){var de;return H(R,function(Ne,rt,Kt){if(V(Ne,rt,Kt))return de=rt,!1}),de}function zs(R,V,H,de){for(var Ne=R.length,rt=H+(de?1:-1);de?rt--:++rt<Ne;)if(V(R[rt],rt,R))return rt;return-1}function pn(R,V,H){return V===V?Pd(R,V,H):zs(R,Cu,H)}function vd(R,V,H,de){for(var Ne=H-1,rt=R.length;++Ne<rt;)if(de(R[Ne],V))return Ne;return-1}function Cu(R){return R!==R}function Nu(R,V){var H=R==null?0:R.length;return H?Ea(R,V)/H:Y}function ba(R){return function(V){return V==null?r:V[R]}}function wa(R){return function(V){return R==null?r:R[V]}}function Tu(R,V,H,de,Ne){return Ne(R,function(rt,Kt,ut){H=de?(de=!1,rt):V(H,rt,Kt,ut)}),H}function yd(R,V){var H=R.length;for(R.sort(V);H--;)R[H]=R[H].value;return R}function Ea(R,V){for(var H,de=-1,Ne=R.length;++de<Ne;){var rt=V(R[de]);rt!==r&&(H=H===r?rt:H+rt)}return H}function Sa(R,V){for(var H=-1,de=Array(R);++H<R;)de[H]=V(H);return de}function _d(R,V){return _t(V,function(H){return[H,R[H]]})}function Ru(R){return R&&R.slice(0,Fu(R)+1).replace(xt,"")}function mr(R){return function(V){return R(V)}}function Ia(R,V){return _t(V,function(H){return R[H]})}function qn(R,V){return R.has(V)}function Uu(R,V){for(var H=-1,de=R.length;++H<de&&pn(V,R[H],0)>-1;);return H}function Du(R,V){for(var H=R.length;H--&&pn(V,R[H],0)>-1;);return H}function md(R,V){for(var H=R.length,de=0;H--;)R[H]===V&&++de;return de}var bd=wa(b),wd=wa(T);function Ed(R){return"\\"+pe[R]}function Sd(R,V){return R==null?r:R[V]}function dn(R){return Ms.test(R)}function Id(R){return qi.test(R)}function xd(R){for(var V,H=[];!(V=R.next()).done;)H.push(V.value);return H}function xa(R){var V=-1,H=Array(R.size);return R.forEach(function(de,Ne){H[++V]=[Ne,de]}),H}function Lu(R,V){return function(H){return R(V(H))}}function Si(R,V){for(var H=-1,de=R.length,Ne=0,rt=[];++H<de;){var Kt=R[H];(Kt===V||Kt===x)&&(R[H]=x,rt[Ne++]=H)}return rt}function Hs(R){var V=-1,H=Array(R.size);return R.forEach(function(de){H[++V]=de}),H}function Od(R){var V=-1,H=Array(R.size);return R.forEach(function(de){H[++V]=[de,de]}),H}function Pd(R,V,H){for(var de=H-1,Ne=R.length;++de<Ne;)if(R[de]===V)return de;return-1}function Ad(R,V,H){for(var de=H+1;de--;)if(R[de]===V)return de;return de}function gn(R){return dn(R)?Nd(R):pd(R)}function Hr(R){return dn(R)?Td(R):dd(R)}function Fu(R){for(var V=R.length;V--&&Ct.test(R.charAt(V)););return V}var Cd=wa(Z);function Nd(R){for(var V=fn.lastIndex=0;fn.test(R);)++V;return V}function Td(R){return R.match(fn)||[]}function Rd(R){return R.match($s)||[]}var Ud=function R(V){V=V==null?Xe:vn.defaults(Xe.Object(),V,vn.pick(Xe,js));var H=V.Array,de=V.Date,Ne=V.Error,rt=V.Function,Kt=V.Math,ut=V.Object,Oa=V.RegExp,Dd=V.String,Cr=V.TypeError,Ks=H.prototype,Ld=rt.prototype,yn=ut.prototype,Bs=V["__core-js_shared__"],Vs=Ld.toString,nt=yn.hasOwnProperty,Fd=0,$u=function(){var e=/[^.]+$/.exec(Bs&&Bs.keys&&Bs.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),ks=yn.toString,$d=Vs.call(ut),Md=Xe._,jd=Oa("^"+Vs.call(nt).replace(It,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gs=lr?V.Buffer:r,Ii=V.Symbol,Ws=V.Uint8Array,Mu=Gs?Gs.allocUnsafe:r,Ys=Lu(ut.getPrototypeOf,ut),ju=ut.create,qu=yn.propertyIsEnumerable,Js=Ks.splice,zu=Ii?Ii.isConcatSpreadable:r,zn=Ii?Ii.iterator:r,Hi=Ii?Ii.toStringTag:r,Xs=function(){try{var e=Gi(ut,"defineProperty");return e({},"",{}),e}catch{}}(),qd=V.clearTimeout!==Xe.clearTimeout&&V.clearTimeout,zd=de&&de.now!==Xe.Date.now&&de.now,Hd=V.setTimeout!==Xe.setTimeout&&V.setTimeout,Zs=Kt.ceil,Qs=Kt.floor,Pa=ut.getOwnPropertySymbols,Kd=Gs?Gs.isBuffer:r,Hu=V.isFinite,Bd=Ks.join,Vd=Lu(ut.keys,ut),Bt=Kt.max,Jt=Kt.min,kd=de.now,Gd=V.parseInt,Ku=Kt.random,Wd=Ks.reverse,Aa=Gi(V,"DataView"),Hn=Gi(V,"Map"),Ca=Gi(V,"Promise"),_n=Gi(V,"Set"),Kn=Gi(V,"WeakMap"),Bn=Gi(ut,"create"),eo=Kn&&new Kn,mn={},Yd=Wi(Aa),Jd=Wi(Hn),Xd=Wi(Ca),Zd=Wi(_n),Qd=Wi(Kn),to=Ii?Ii.prototype:r,Vn=to?to.valueOf:r,Bu=to?to.toString:r;function g(e){if(Pt(e)&&!Re(e)&&!(e instanceof Ye)){if(e instanceof Nr)return e;if(nt.call(e,"__wrapped__"))return Vh(e)}return new Nr(e)}var bn=function(){function e(){}return function(i){if(!bt(i))return{};if(ju)return ju(i);e.prototype=i;var o=new e;return e.prototype=r,o}}();function ro(){}function Nr(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}g.templateSettings={escape:Et,evaluate:St,interpolate:mt,variable:"",imports:{_:g}},g.prototype=ro.prototype,g.prototype.constructor=g,Nr.prototype=bn(ro.prototype),Nr.prototype.constructor=Nr;function Ye(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=re,this.__views__=[]}function eg(){var e=new Ye(this.__wrapped__);return e.__actions__=fr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=fr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=fr(this.__views__),e}function tg(){if(this.__filtered__){var e=new Ye(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function rg(){var e=this.__wrapped__.value(),i=this.__dir__,o=Re(e),c=i<0,f=o?e.length:0,y=d0(0,f,this.__views__),E=y.start,O=y.end,L=O-E,J=c?O:E-1,X=this.__iteratees__,Q=X.length,ae=0,ve=Jt(L,this.__takeCount__);if(!o||!c&&f==L&&ve==L)return dh(e,this.__actions__);var we=[];e:for(;L--&&ae<ve;){J+=i;for(var ze=-1,Ee=e[J];++ze<Q;){var Ge=X[ze],Ze=Ge.iteratee,Er=Ge.type,nr=Ze(Ee);if(Er==q)Ee=nr;else if(!nr){if(Er==N)continue e;break e}}we[ae++]=Ee}return we}Ye.prototype=bn(ro.prototype),Ye.prototype.constructor=Ye;function Ki(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function ig(){this.__data__=Bn?Bn(null):{},this.size=0}function ng(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function sg(e){var i=this.__data__;if(Bn){var o=i[e];return o===v?r:o}return nt.call(i,e)?i[e]:r}function og(e){var i=this.__data__;return Bn?i[e]!==r:nt.call(i,e)}function ag(e,i){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=Bn&&i===r?v:i,this}Ki.prototype.clear=ig,Ki.prototype.delete=ng,Ki.prototype.get=sg,Ki.prototype.has=og,Ki.prototype.set=ag;function ai(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function cg(){this.__data__=[],this.size=0}function ug(e){var i=this.__data__,o=io(i,e);if(o<0)return!1;var c=i.length-1;return o==c?i.pop():Js.call(i,o,1),--this.size,!0}function hg(e){var i=this.__data__,o=io(i,e);return o<0?r:i[o][1]}function lg(e){return io(this.__data__,e)>-1}function fg(e,i){var o=this.__data__,c=io(o,e);return c<0?(++this.size,o.push([e,i])):o[c][1]=i,this}ai.prototype.clear=cg,ai.prototype.delete=ug,ai.prototype.get=hg,ai.prototype.has=lg,ai.prototype.set=fg;function ci(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function pg(){this.size=0,this.__data__={hash:new Ki,map:new(Hn||ai),string:new Ki}}function dg(e){var i=vo(this,e).delete(e);return this.size-=i?1:0,i}function gg(e){return vo(this,e).get(e)}function vg(e){return vo(this,e).has(e)}function yg(e,i){var o=vo(this,e),c=o.size;return o.set(e,i),this.size+=o.size==c?0:1,this}ci.prototype.clear=pg,ci.prototype.delete=dg,ci.prototype.get=gg,ci.prototype.has=vg,ci.prototype.set=yg;function Bi(e){var i=-1,o=e==null?0:e.length;for(this.__data__=new ci;++i<o;)this.add(e[i])}function _g(e){return this.__data__.set(e,v),this}function mg(e){return this.__data__.has(e)}Bi.prototype.add=Bi.prototype.push=_g,Bi.prototype.has=mg;function Kr(e){var i=this.__data__=new ai(e);this.size=i.size}function bg(){this.__data__=new ai,this.size=0}function wg(e){var i=this.__data__,o=i.delete(e);return this.size=i.size,o}function Eg(e){return this.__data__.get(e)}function Sg(e){return this.__data__.has(e)}function Ig(e,i){var o=this.__data__;if(o instanceof ai){var c=o.__data__;if(!Hn||c.length<a-1)return c.push([e,i]),this.size=++o.size,this;o=this.__data__=new ci(c)}return o.set(e,i),this.size=o.size,this}Kr.prototype.clear=bg,Kr.prototype.delete=wg,Kr.prototype.get=Eg,Kr.prototype.has=Sg,Kr.prototype.set=Ig;function Vu(e,i){var o=Re(e),c=!o&&Yi(e),f=!o&&!c&&Ci(e),y=!o&&!c&&!f&&In(e),E=o||c||f||y,O=E?Sa(e.length,Dd):[],L=O.length;for(var J in e)(i||nt.call(e,J))&&!(E&&(J=="length"||f&&(J=="offset"||J=="parent")||y&&(J=="buffer"||J=="byteLength"||J=="byteOffset")||fi(J,L)))&&O.push(J);return O}function ku(e){var i=e.length;return i?e[qa(0,i-1)]:r}function xg(e,i){return yo(fr(e),Vi(i,0,e.length))}function Og(e){return yo(fr(e))}function Na(e,i,o){(o!==r&&!Br(e[i],o)||o===r&&!(i in e))&&ui(e,i,o)}function kn(e,i,o){var c=e[i];(!(nt.call(e,i)&&Br(c,o))||o===r&&!(i in e))&&ui(e,i,o)}function io(e,i){for(var o=e.length;o--;)if(Br(e[o][0],i))return o;return-1}function Pg(e,i,o,c){return xi(e,function(f,y,E){i(c,f,o(f),E)}),c}function Gu(e,i){return e&&Zr(i,kt(i),e)}function Ag(e,i){return e&&Zr(i,dr(i),e)}function ui(e,i,o){i=="__proto__"&&Xs?Xs(e,i,{configurable:!0,enumerable:!0,value:o,writable:!0}):e[i]=o}function Ta(e,i){for(var o=-1,c=i.length,f=H(c),y=e==null;++o<c;)f[o]=y?r:lc(e,i[o]);return f}function Vi(e,i,o){return e===e&&(o!==r&&(e=e<=o?e:o),i!==r&&(e=e>=i?e:i)),e}function Tr(e,i,o,c,f,y){var E,O=i&D,L=i&j,J=i&U;if(o&&(E=f?o(e,c,f,y):o(e)),E!==r)return E;if(!bt(e))return e;var X=Re(e);if(X){if(E=v0(e),!O)return fr(e,E)}else{var Q=Xt(e),ae=Q==ne||Q==fe;if(Ci(e))return yh(e,O);if(Q==$e||Q==he||ae&&!f){if(E=L||ae?{}:Fh(e),!O)return L?s0(e,Ag(E,e)):n0(e,Gu(E,e))}else{if(!st[Q])return f?e:{};E=y0(e,Q,O)}}y||(y=new Kr);var ve=y.get(e);if(ve)return ve;y.set(e,E),ll(e)?e.forEach(function(Ee){E.add(Tr(Ee,i,o,Ee,e,y))}):ul(e)&&e.forEach(function(Ee,Ge){E.set(Ge,Tr(Ee,i,o,Ge,e,y))});var we=J?L?Xa:Ja:L?dr:kt,ze=X?r:we(e);return Ar(ze||e,function(Ee,Ge){ze&&(Ge=Ee,Ee=e[Ge]),kn(E,Ge,Tr(Ee,i,o,Ge,e,y))}),E}function Cg(e){var i=kt(e);return function(o){return Wu(o,e,i)}}function Wu(e,i,o){var c=o.length;if(e==null)return!c;for(e=ut(e);c--;){var f=o[c],y=i[f],E=e[f];if(E===r&&!(f in e)||!y(E))return!1}return!0}function Yu(e,i,o){if(typeof e!="function")throw new Cr(d);return Qn(function(){e.apply(r,o)},i)}function Gn(e,i,o,c){var f=-1,y=qs,E=!0,O=e.length,L=[],J=i.length;if(!O)return L;o&&(i=_t(i,mr(o))),c?(y=ya,E=!1):i.length>=a&&(y=qn,E=!1,i=new Bi(i));e:for(;++f<O;){var X=e[f],Q=o==null?X:o(X);if(X=c||X!==0?X:0,E&&Q===Q){for(var ae=J;ae--;)if(i[ae]===Q)continue e;L.push(X)}else y(i,Q,c)||L.push(X)}return L}var xi=Eh(Xr),Ju=Eh(Ua,!0);function Ng(e,i){var o=!0;return xi(e,function(c,f,y){return o=!!i(c,f,y),o}),o}function no(e,i,o){for(var c=-1,f=e.length;++c<f;){var y=e[c],E=i(y);if(E!=null&&(O===r?E===E&&!wr(E):o(E,O)))var O=E,L=y}return L}function Tg(e,i,o,c){var f=e.length;for(o=Me(o),o<0&&(o=-o>f?0:f+o),c=c===r||c>f?f:Me(c),c<0&&(c+=f),c=o>c?0:pl(c);o<c;)e[o++]=i;return e}function Xu(e,i){var o=[];return xi(e,function(c,f,y){i(c,f,y)&&o.push(c)}),o}function Wt(e,i,o,c,f){var y=-1,E=e.length;for(o||(o=m0),f||(f=[]);++y<E;){var O=e[y];i>0&&o(O)?i>1?Wt(O,i-1,o,c,f):Ei(f,O):c||(f[f.length]=O)}return f}var Ra=Sh(),Zu=Sh(!0);function Xr(e,i){return e&&Ra(e,i,kt)}function Ua(e,i){return e&&Zu(e,i,kt)}function so(e,i){return wi(i,function(o){return pi(e[o])})}function ki(e,i){i=Pi(i,e);for(var o=0,c=i.length;e!=null&&o<c;)e=e[Qr(i[o++])];return o&&o==c?e:r}function Qu(e,i,o){var c=i(e);return Re(e)?c:Ei(c,o(e))}function rr(e){return e==null?e===r?qe:Ve:Hi&&Hi in ut(e)?p0(e):O0(e)}function Da(e,i){return e>i}function Rg(e,i){return e!=null&&nt.call(e,i)}function Ug(e,i){return e!=null&&i in ut(e)}function Dg(e,i,o){return e>=Jt(i,o)&&e<Bt(i,o)}function La(e,i,o){for(var c=o?ya:qs,f=e[0].length,y=e.length,E=y,O=H(y),L=1/0,J=[];E--;){var X=e[E];E&&i&&(X=_t(X,mr(i))),L=Jt(X.length,L),O[E]=!o&&(i||f>=120&&X.length>=120)?new Bi(E&&X):r}X=e[0];var Q=-1,ae=O[0];e:for(;++Q<f&&J.length<L;){var ve=X[Q],we=i?i(ve):ve;if(ve=o||ve!==0?ve:0,!(ae?qn(ae,we):c(J,we,o))){for(E=y;--E;){var ze=O[E];if(!(ze?qn(ze,we):c(e[E],we,o)))continue e}ae&&ae.push(we),J.push(ve)}}return J}function Lg(e,i,o,c){return Xr(e,function(f,y,E){i(c,o(f),y,E)}),c}function Wn(e,i,o){i=Pi(i,e),e=qh(e,i);var c=e==null?e:e[Qr(Ur(i))];return c==null?r:Vt(c,e,o)}function eh(e){return Pt(e)&&rr(e)==he}function Fg(e){return Pt(e)&&rr(e)==Se}function $g(e){return Pt(e)&&rr(e)==A}function Yn(e,i,o,c,f){return e===i?!0:e==null||i==null||!Pt(e)&&!Pt(i)?e!==e&&i!==i:Mg(e,i,o,c,Yn,f)}function Mg(e,i,o,c,f,y){var E=Re(e),O=Re(i),L=E?_e:Xt(e),J=O?_e:Xt(i);L=L==he?$e:L,J=J==he?$e:J;var X=L==$e,Q=J==$e,ae=L==J;if(ae&&Ci(e)){if(!Ci(i))return!1;E=!0,X=!1}if(ae&&!X)return y||(y=new Kr),E||In(e)?Uh(e,i,o,c,f,y):l0(e,i,L,o,c,f,y);if(!(o&z)){var ve=X&&nt.call(e,"__wrapped__"),we=Q&&nt.call(i,"__wrapped__");if(ve||we){var ze=ve?e.value():e,Ee=we?i.value():i;return y||(y=new Kr),f(ze,Ee,o,c,y)}}return ae?(y||(y=new Kr),f0(e,i,o,c,f,y)):!1}function jg(e){return Pt(e)&&Xt(e)==Ie}function Fa(e,i,o,c){var f=o.length,y=f,E=!c;if(e==null)return!y;for(e=ut(e);f--;){var O=o[f];if(E&&O[2]?O[1]!==e[O[0]]:!(O[0]in e))return!1}for(;++f<y;){O=o[f];var L=O[0],J=e[L],X=O[1];if(E&&O[2]){if(J===r&&!(L in e))return!1}else{var Q=new Kr;if(c)var ae=c(J,X,L,e,i,Q);if(!(ae===r?Yn(X,J,z|K,c,Q):ae))return!1}}return!0}function th(e){if(!bt(e)||w0(e))return!1;var i=pi(e)?jd:ta;return i.test(Wi(e))}function qg(e){return Pt(e)&&rr(e)==je}function zg(e){return Pt(e)&&Xt(e)==xe}function Hg(e){return Pt(e)&&So(e.length)&&!!ot[rr(e)]}function rh(e){return typeof e=="function"?e:e==null?gr:typeof e=="object"?Re(e)?sh(e[0],e[1]):nh(e):Il(e)}function $a(e){if(!Zn(e))return Vd(e);var i=[];for(var o in ut(e))nt.call(e,o)&&o!="constructor"&&i.push(o);return i}function Kg(e){if(!bt(e))return x0(e);var i=Zn(e),o=[];for(var c in e)c=="constructor"&&(i||!nt.call(e,c))||o.push(c);return o}function Ma(e,i){return e<i}function ih(e,i){var o=-1,c=pr(e)?H(e.length):[];return xi(e,function(f,y,E){c[++o]=i(f,y,E)}),c}function nh(e){var i=Qa(e);return i.length==1&&i[0][2]?Mh(i[0][0],i[0][1]):function(o){return o===e||Fa(o,e,i)}}function sh(e,i){return tc(e)&&$h(i)?Mh(Qr(e),i):function(o){var c=lc(o,e);return c===r&&c===i?fc(o,e):Yn(i,c,z|K)}}function oo(e,i,o,c,f){e!==i&&Ra(i,function(y,E){if(f||(f=new Kr),bt(y))Bg(e,i,E,o,oo,c,f);else{var O=c?c(ic(e,E),y,E+"",e,i,f):r;O===r&&(O=y),Na(e,E,O)}},dr)}function Bg(e,i,o,c,f,y,E){var O=ic(e,o),L=ic(i,o),J=E.get(L);if(J){Na(e,o,J);return}var X=y?y(O,L,o+"",e,i,E):r,Q=X===r;if(Q){var ae=Re(L),ve=!ae&&Ci(L),we=!ae&&!ve&&In(L);X=L,ae||ve||we?Re(O)?X=O:Tt(O)?X=fr(O):ve?(Q=!1,X=yh(L,!0)):we?(Q=!1,X=_h(L,!0)):X=[]:es(L)||Yi(L)?(X=O,Yi(O)?X=dl(O):(!bt(O)||pi(O))&&(X=Fh(L))):Q=!1}Q&&(E.set(L,X),f(X,L,c,y,E),E.delete(L)),Na(e,o,X)}function oh(e,i){var o=e.length;if(o)return i+=i<0?o:0,fi(i,o)?e[i]:r}function ah(e,i,o){i.length?i=_t(i,function(y){return Re(y)?function(E){return ki(E,y.length===1?y[0]:y)}:y}):i=[gr];var c=-1;i=_t(i,mr(me()));var f=ih(e,function(y,E,O){var L=_t(i,function(J){return J(y)});return{criteria:L,index:++c,value:y}});return yd(f,function(y,E){return i0(y,E,o)})}function Vg(e,i){return ch(e,i,function(o,c){return fc(e,c)})}function ch(e,i,o){for(var c=-1,f=i.length,y={};++c<f;){var E=i[c],O=ki(e,E);o(O,E)&&Jn(y,Pi(E,e),O)}return y}function kg(e){return function(i){return ki(i,e)}}function ja(e,i,o,c){var f=c?vd:pn,y=-1,E=i.length,O=e;for(e===i&&(i=fr(i)),o&&(O=_t(e,mr(o)));++y<E;)for(var L=0,J=i[y],X=o?o(J):J;(L=f(O,X,L,c))>-1;)O!==e&&Js.call(O,L,1),Js.call(e,L,1);return e}function uh(e,i){for(var o=e?i.length:0,c=o-1;o--;){var f=i[o];if(o==c||f!==y){var y=f;fi(f)?Js.call(e,f,1):Ka(e,f)}}return e}function qa(e,i){return e+Qs(Ku()*(i-e+1))}function Gg(e,i,o,c){for(var f=-1,y=Bt(Zs((i-e)/(o||1)),0),E=H(y);y--;)E[c?y:++f]=e,e+=o;return E}function za(e,i){var o="";if(!e||i<1||i>W)return o;do i%2&&(o+=e),i=Qs(i/2),i&&(e+=e);while(i);return o}function Be(e,i){return nc(jh(e,i,gr),e+"")}function Wg(e){return ku(xn(e))}function Yg(e,i){var o=xn(e);return yo(o,Vi(i,0,o.length))}function Jn(e,i,o,c){if(!bt(e))return e;i=Pi(i,e);for(var f=-1,y=i.length,E=y-1,O=e;O!=null&&++f<y;){var L=Qr(i[f]),J=o;if(L==="__proto__"||L==="constructor"||L==="prototype")return e;if(f!=E){var X=O[L];J=c?c(X,L,O):r,J===r&&(J=bt(X)?X:fi(i[f+1])?[]:{})}kn(O,L,J),O=O[L]}return e}var hh=eo?function(e,i){return eo.set(e,i),e}:gr,Jg=Xs?function(e,i){return Xs(e,"toString",{configurable:!0,enumerable:!1,value:dc(i),writable:!0})}:gr;function Xg(e){return yo(xn(e))}function Rr(e,i,o){var c=-1,f=e.length;i<0&&(i=-i>f?0:f+i),o=o>f?f:o,o<0&&(o+=f),f=i>o?0:o-i>>>0,i>>>=0;for(var y=H(f);++c<f;)y[c]=e[c+i];return y}function Zg(e,i){var o;return xi(e,function(c,f,y){return o=i(c,f,y),!o}),!!o}function ao(e,i,o){var c=0,f=e==null?c:e.length;if(typeof i=="number"&&i===i&&f<=ie){for(;c<f;){var y=c+f>>>1,E=e[y];E!==null&&!wr(E)&&(o?E<=i:E<i)?c=y+1:f=y}return f}return Ha(e,i,gr,o)}function Ha(e,i,o,c){var f=0,y=e==null?0:e.length;if(y===0)return 0;i=o(i);for(var E=i!==i,O=i===null,L=wr(i),J=i===r;f<y;){var X=Qs((f+y)/2),Q=o(e[X]),ae=Q!==r,ve=Q===null,we=Q===Q,ze=wr(Q);if(E)var Ee=c||we;else J?Ee=we&&(c||ae):O?Ee=we&&ae&&(c||!ve):L?Ee=we&&ae&&!ve&&(c||!ze):ve||ze?Ee=!1:Ee=c?Q<=i:Q<i;Ee?f=X+1:y=X}return Jt(y,Oe)}function lh(e,i){for(var o=-1,c=e.length,f=0,y=[];++o<c;){var E=e[o],O=i?i(E):E;if(!o||!Br(O,L)){var L=O;y[f++]=E===0?0:E}}return y}function fh(e){return typeof e=="number"?e:wr(e)?Y:+e}function br(e){if(typeof e=="string")return e;if(Re(e))return _t(e,br)+"";if(wr(e))return Bu?Bu.call(e):"";var i=e+"";return i=="0"&&1/e==-te?"-0":i}function Oi(e,i,o){var c=-1,f=qs,y=e.length,E=!0,O=[],L=O;if(o)E=!1,f=ya;else if(y>=a){var J=i?null:u0(e);if(J)return Hs(J);E=!1,f=qn,L=new Bi}else L=i?[]:O;e:for(;++c<y;){var X=e[c],Q=i?i(X):X;if(X=o||X!==0?X:0,E&&Q===Q){for(var ae=L.length;ae--;)if(L[ae]===Q)continue e;i&&L.push(Q),O.push(X)}else f(L,Q,o)||(L!==O&&L.push(Q),O.push(X))}return O}function Ka(e,i){return i=Pi(i,e),e=qh(e,i),e==null||delete e[Qr(Ur(i))]}function ph(e,i,o,c){return Jn(e,i,o(ki(e,i)),c)}function co(e,i,o,c){for(var f=e.length,y=c?f:-1;(c?y--:++y<f)&&i(e[y],y,e););return o?Rr(e,c?0:y,c?y+1:f):Rr(e,c?y+1:0,c?f:y)}function dh(e,i){var o=e;return o instanceof Ye&&(o=o.value()),_a(i,function(c,f){return f.func.apply(f.thisArg,Ei([c],f.args))},o)}function Ba(e,i,o){var c=e.length;if(c<2)return c?Oi(e[0]):[];for(var f=-1,y=H(c);++f<c;)for(var E=e[f],O=-1;++O<c;)O!=f&&(y[f]=Gn(y[f]||E,e[O],i,o));return Oi(Wt(y,1),i,o)}function gh(e,i,o){for(var c=-1,f=e.length,y=i.length,E={};++c<f;){var O=c<y?i[c]:r;o(E,e[c],O)}return E}function Va(e){return Tt(e)?e:[]}function ka(e){return typeof e=="function"?e:gr}function Pi(e,i){return Re(e)?e:tc(e,i)?[e]:Bh(it(e))}var Qg=Be;function Ai(e,i,o){var c=e.length;return o=o===r?c:o,!i&&o>=c?e:Rr(e,i,o)}var vh=qd||function(e){return Xe.clearTimeout(e)};function yh(e,i){if(i)return e.slice();var o=e.length,c=Mu?Mu(o):new e.constructor(o);return e.copy(c),c}function Ga(e){var i=new e.constructor(e.byteLength);return new Ws(i).set(new Ws(e)),i}function e0(e,i){var o=i?Ga(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.byteLength)}function t0(e){var i=new e.constructor(e.source,Or.exec(e));return i.lastIndex=e.lastIndex,i}function r0(e){return Vn?ut(Vn.call(e)):{}}function _h(e,i){var o=i?Ga(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.length)}function mh(e,i){if(e!==i){var o=e!==r,c=e===null,f=e===e,y=wr(e),E=i!==r,O=i===null,L=i===i,J=wr(i);if(!O&&!J&&!y&&e>i||y&&E&&L&&!O&&!J||c&&E&&L||!o&&L||!f)return 1;if(!c&&!y&&!J&&e<i||J&&o&&f&&!c&&!y||O&&o&&f||!E&&f||!L)return-1}return 0}function i0(e,i,o){for(var c=-1,f=e.criteria,y=i.criteria,E=f.length,O=o.length;++c<E;){var L=mh(f[c],y[c]);if(L){if(c>=O)return L;var J=o[c];return L*(J=="desc"?-1:1)}}return e.index-i.index}function bh(e,i,o,c){for(var f=-1,y=e.length,E=o.length,O=-1,L=i.length,J=Bt(y-E,0),X=H(L+J),Q=!c;++O<L;)X[O]=i[O];for(;++f<E;)(Q||f<y)&&(X[o[f]]=e[f]);for(;J--;)X[O++]=e[f++];return X}function wh(e,i,o,c){for(var f=-1,y=e.length,E=-1,O=o.length,L=-1,J=i.length,X=Bt(y-O,0),Q=H(X+J),ae=!c;++f<X;)Q[f]=e[f];for(var ve=f;++L<J;)Q[ve+L]=i[L];for(;++E<O;)(ae||f<y)&&(Q[ve+o[E]]=e[f++]);return Q}function fr(e,i){var o=-1,c=e.length;for(i||(i=H(c));++o<c;)i[o]=e[o];return i}function Zr(e,i,o,c){var f=!o;o||(o={});for(var y=-1,E=i.length;++y<E;){var O=i[y],L=c?c(o[O],e[O],O,o,e):r;L===r&&(L=e[O]),f?ui(o,O,L):kn(o,O,L)}return o}function n0(e,i){return Zr(e,ec(e),i)}function s0(e,i){return Zr(e,Dh(e),i)}function uo(e,i){return function(o,c){var f=Re(o)?hd:Pg,y=i?i():{};return f(o,e,me(c,2),y)}}function wn(e){return Be(function(i,o){var c=-1,f=o.length,y=f>1?o[f-1]:r,E=f>2?o[2]:r;for(y=e.length>3&&typeof y=="function"?(f--,y):r,E&&ir(o[0],o[1],E)&&(y=f<3?r:y,f=1),i=ut(i);++c<f;){var O=o[c];O&&e(i,O,c,y)}return i})}function Eh(e,i){return function(o,c){if(o==null)return o;if(!pr(o))return e(o,c);for(var f=o.length,y=i?f:-1,E=ut(o);(i?y--:++y<f)&&c(E[y],y,E)!==!1;);return o}}function Sh(e){return function(i,o,c){for(var f=-1,y=ut(i),E=c(i),O=E.length;O--;){var L=E[e?O:++f];if(o(y[L],L,y)===!1)break}return i}}function o0(e,i,o){var c=i&B,f=Xn(e);function y(){var E=this&&this!==Xe&&this instanceof y?f:e;return E.apply(c?o:this,arguments)}return y}function Ih(e){return function(i){i=it(i);var o=dn(i)?Hr(i):r,c=o?o[0]:i.charAt(0),f=o?Ai(o,1).join(""):i.slice(1);return c[e]()+f}}function En(e){return function(i){return _a(El(wl(i).replace(Mn,"")),e,"")}}function Xn(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var o=bn(e.prototype),c=e.apply(o,i);return bt(c)?c:o}}function a0(e,i,o){var c=Xn(e);function f(){for(var y=arguments.length,E=H(y),O=y,L=Sn(f);O--;)E[O]=arguments[O];var J=y<3&&E[0]!==L&&E[y-1]!==L?[]:Si(E,L);if(y-=J.length,y<o)return Ch(e,i,ho,f.placeholder,r,E,J,r,r,o-y);var X=this&&this!==Xe&&this instanceof f?c:e;return Vt(X,this,E)}return f}function xh(e){return function(i,o,c){var f=ut(i);if(!pr(i)){var y=me(o,3);i=kt(i),o=function(O){return y(f[O],O,f)}}var E=e(i,o,c);return E>-1?f[y?i[E]:E]:r}}function Oh(e){return li(function(i){var o=i.length,c=o,f=Nr.prototype.thru;for(e&&i.reverse();c--;){var y=i[c];if(typeof y!="function")throw new Cr(d);if(f&&!E&&go(y)=="wrapper")var E=new Nr([],!0)}for(c=E?c:o;++c<o;){y=i[c];var O=go(y),L=O=="wrapper"?Za(y):r;L&&rc(L[0])&&L[1]==(u|F|P|_)&&!L[4].length&&L[9]==1?E=E[go(L[0])].apply(E,L[3]):E=y.length==1&&rc(y)?E[O]():E.thru(y)}return function(){var J=arguments,X=J[0];if(E&&J.length==1&&Re(X))return E.plant(X).value();for(var Q=0,ae=o?i[Q].apply(this,J):X;++Q<o;)ae=i[Q].call(this,ae);return ae}})}function ho(e,i,o,c,f,y,E,O,L,J){var X=i&u,Q=i&B,ae=i&oe,ve=i&(F|S),we=i&G,ze=ae?r:Xn(e);function Ee(){for(var Ge=arguments.length,Ze=H(Ge),Er=Ge;Er--;)Ze[Er]=arguments[Er];if(ve)var nr=Sn(Ee),Sr=md(Ze,nr);if(c&&(Ze=bh(Ze,c,f,ve)),y&&(Ze=wh(Ze,y,E,ve)),Ge-=Sr,ve&&Ge<J){var Rt=Si(Ze,nr);return Ch(e,i,ho,Ee.placeholder,o,Ze,Rt,O,L,J-Ge)}var Vr=Q?o:this,gi=ae?Vr[e]:e;return Ge=Ze.length,O?Ze=P0(Ze,O):we&&Ge>1&&Ze.reverse(),X&&L<Ge&&(Ze.length=L),this&&this!==Xe&&this instanceof Ee&&(gi=ze||Xn(gi)),gi.apply(Vr,Ze)}return Ee}function Ph(e,i){return function(o,c){return Lg(o,e,i(c),{})}}function lo(e,i){return function(o,c){var f;if(o===r&&c===r)return i;if(o!==r&&(f=o),c!==r){if(f===r)return c;typeof o=="string"||typeof c=="string"?(o=br(o),c=br(c)):(o=fh(o),c=fh(c)),f=e(o,c)}return f}}function Wa(e){return li(function(i){return i=_t(i,mr(me())),Be(function(o){var c=this;return e(i,function(f){return Vt(f,c,o)})})})}function fo(e,i){i=i===r?" ":br(i);var o=i.length;if(o<2)return o?za(i,e):i;var c=za(i,Zs(e/gn(i)));return dn(i)?Ai(Hr(c),0,e).join(""):c.slice(0,e)}function c0(e,i,o,c){var f=i&B,y=Xn(e);function E(){for(var O=-1,L=arguments.length,J=-1,X=c.length,Q=H(X+L),ae=this&&this!==Xe&&this instanceof E?y:e;++J<X;)Q[J]=c[J];for(;L--;)Q[J++]=arguments[++O];return Vt(ae,f?o:this,Q)}return E}function Ah(e){return function(i,o,c){return c&&typeof c!="number"&&ir(i,o,c)&&(o=c=r),i=di(i),o===r?(o=i,i=0):o=di(o),c=c===r?i<o?1:-1:di(c),Gg(i,o,c,e)}}function po(e){return function(i,o){return typeof i=="string"&&typeof o=="string"||(i=Dr(i),o=Dr(o)),e(i,o)}}function Ch(e,i,o,c,f,y,E,O,L,J){var X=i&F,Q=X?E:r,ae=X?r:E,ve=X?y:r,we=X?r:y;i|=X?P:m,i&=~(X?m:P),i&C||(i&=~(B|oe));var ze=[e,i,f,ve,Q,we,ae,O,L,J],Ee=o.apply(r,ze);return rc(e)&&zh(Ee,ze),Ee.placeholder=c,Hh(Ee,e,i)}function Ya(e){var i=Kt[e];return function(o,c){if(o=Dr(o),c=c==null?0:Jt(Me(c),292),c&&Hu(o)){var f=(it(o)+"e").split("e"),y=i(f[0]+"e"+(+f[1]+c));return f=(it(y)+"e").split("e"),+(f[0]+"e"+(+f[1]-c))}return i(o)}}var u0=_n&&1/Hs(new _n([,-0]))[1]==te?function(e){return new _n(e)}:yc;function Nh(e){return function(i){var o=Xt(i);return o==Ie?xa(i):o==xe?Od(i):_d(i,e(i))}}function hi(e,i,o,c,f,y,E,O){var L=i&oe;if(!L&&typeof e!="function")throw new Cr(d);var J=c?c.length:0;if(J||(i&=~(P|m),c=f=r),E=E===r?E:Bt(Me(E),0),O=O===r?O:Me(O),J-=f?f.length:0,i&m){var X=c,Q=f;c=f=r}var ae=L?r:Za(e),ve=[e,i,o,c,f,X,Q,y,E,O];if(ae&&I0(ve,ae),e=ve[0],i=ve[1],o=ve[2],c=ve[3],f=ve[4],O=ve[9]=ve[9]===r?L?0:e.length:Bt(ve[9]-J,0),!O&&i&(F|S)&&(i&=~(F|S)),!i||i==B)var we=o0(e,i,o);else i==F||i==S?we=a0(e,i,O):(i==P||i==(B|P))&&!f.length?we=c0(e,i,o,c):we=ho.apply(r,ve);var ze=ae?hh:zh;return Hh(ze(we,ve),e,i)}function Th(e,i,o,c){return e===r||Br(e,yn[o])&&!nt.call(c,o)?i:e}function Rh(e,i,o,c,f,y){return bt(e)&&bt(i)&&(y.set(i,e),oo(e,i,r,Rh,y),y.delete(i)),e}function h0(e){return es(e)?r:e}function Uh(e,i,o,c,f,y){var E=o&z,O=e.length,L=i.length;if(O!=L&&!(E&&L>O))return!1;var J=y.get(e),X=y.get(i);if(J&&X)return J==i&&X==e;var Q=-1,ae=!0,ve=o&K?new Bi:r;for(y.set(e,i),y.set(i,e);++Q<O;){var we=e[Q],ze=i[Q];if(c)var Ee=E?c(ze,we,Q,i,e,y):c(we,ze,Q,e,i,y);if(Ee!==r){if(Ee)continue;ae=!1;break}if(ve){if(!ma(i,function(Ge,Ze){if(!qn(ve,Ze)&&(we===Ge||f(we,Ge,o,c,y)))return ve.push(Ze)})){ae=!1;break}}else if(!(we===ze||f(we,ze,o,c,y))){ae=!1;break}}return y.delete(e),y.delete(i),ae}function l0(e,i,o,c,f,y,E){switch(o){case Ce:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Se:return!(e.byteLength!=i.byteLength||!y(new Ws(e),new Ws(i)));case $:case A:case He:return Br(+e,+i);case I:return e.name==i.name&&e.message==i.message;case je:case Ue:return e==i+"";case Ie:var O=xa;case xe:var L=c&z;if(O||(O=Hs),e.size!=i.size&&!L)return!1;var J=E.get(e);if(J)return J==i;c|=K,E.set(e,i);var X=Uh(O(e),O(i),c,f,y,E);return E.delete(e),X;case De:if(Vn)return Vn.call(e)==Vn.call(i)}return!1}function f0(e,i,o,c,f,y){var E=o&z,O=Ja(e),L=O.length,J=Ja(i),X=J.length;if(L!=X&&!E)return!1;for(var Q=L;Q--;){var ae=O[Q];if(!(E?ae in i:nt.call(i,ae)))return!1}var ve=y.get(e),we=y.get(i);if(ve&&we)return ve==i&&we==e;var ze=!0;y.set(e,i),y.set(i,e);for(var Ee=E;++Q<L;){ae=O[Q];var Ge=e[ae],Ze=i[ae];if(c)var Er=E?c(Ze,Ge,ae,i,e,y):c(Ge,Ze,ae,e,i,y);if(!(Er===r?Ge===Ze||f(Ge,Ze,o,c,y):Er)){ze=!1;break}Ee||(Ee=ae=="constructor")}if(ze&&!Ee){var nr=e.constructor,Sr=i.constructor;nr!=Sr&&"constructor"in e&&"constructor"in i&&!(typeof nr=="function"&&nr instanceof nr&&typeof Sr=="function"&&Sr instanceof Sr)&&(ze=!1)}return y.delete(e),y.delete(i),ze}function li(e){return nc(jh(e,r,Wh),e+"")}function Ja(e){return Qu(e,kt,ec)}function Xa(e){return Qu(e,dr,Dh)}var Za=eo?function(e){return eo.get(e)}:yc;function go(e){for(var i=e.name+"",o=mn[i],c=nt.call(mn,i)?o.length:0;c--;){var f=o[c],y=f.func;if(y==null||y==e)return f.name}return i}function Sn(e){var i=nt.call(g,"placeholder")?g:e;return i.placeholder}function me(){var e=g.iteratee||gc;return e=e===gc?rh:e,arguments.length?e(arguments[0],arguments[1]):e}function vo(e,i){var o=e.__data__;return b0(i)?o[typeof i=="string"?"string":"hash"]:o.map}function Qa(e){for(var i=kt(e),o=i.length;o--;){var c=i[o],f=e[c];i[o]=[c,f,$h(f)]}return i}function Gi(e,i){var o=Sd(e,i);return th(o)?o:r}function p0(e){var i=nt.call(e,Hi),o=e[Hi];try{e[Hi]=r;var c=!0}catch{}var f=ks.call(e);return c&&(i?e[Hi]=o:delete e[Hi]),f}var ec=Pa?function(e){return e==null?[]:(e=ut(e),wi(Pa(e),function(i){return qu.call(e,i)}))}:_c,Dh=Pa?function(e){for(var i=[];e;)Ei(i,ec(e)),e=Ys(e);return i}:_c,Xt=rr;(Aa&&Xt(new Aa(new ArrayBuffer(1)))!=Ce||Hn&&Xt(new Hn)!=Ie||Ca&&Xt(Ca.resolve())!=dt||_n&&Xt(new _n)!=xe||Kn&&Xt(new Kn)!=Ae)&&(Xt=function(e){var i=rr(e),o=i==$e?e.constructor:r,c=o?Wi(o):"";if(c)switch(c){case Yd:return Ce;case Jd:return Ie;case Xd:return dt;case Zd:return xe;case Qd:return Ae}return i});function d0(e,i,o){for(var c=-1,f=o.length;++c<f;){var y=o[c],E=y.size;switch(y.type){case"drop":e+=E;break;case"dropRight":i-=E;break;case"take":i=Jt(i,e+E);break;case"takeRight":e=Bt(e,i-E);break}}return{start:e,end:i}}function g0(e){var i=e.match(ht);return i?i[1].split(Mt):[]}function Lh(e,i,o){i=Pi(i,e);for(var c=-1,f=i.length,y=!1;++c<f;){var E=Qr(i[c]);if(!(y=e!=null&&o(e,E)))break;e=e[E]}return y||++c!=f?y:(f=e==null?0:e.length,!!f&&So(f)&&fi(E,f)&&(Re(e)||Yi(e)))}function v0(e){var i=e.length,o=new e.constructor(i);return i&&typeof e[0]=="string"&&nt.call(e,"index")&&(o.index=e.index,o.input=e.input),o}function Fh(e){return typeof e.constructor=="function"&&!Zn(e)?bn(Ys(e)):{}}function y0(e,i,o){var c=e.constructor;switch(i){case Se:return Ga(e);case $:case A:return new c(+e);case Ce:return e0(e,o);case Ke:case Pe:case ke:case We:case et:case tt:case Je:case Qt:case hr:return _h(e,o);case Ie:return new c;case He:case Ue:return new c(e);case je:return t0(e);case xe:return new c;case De:return r0(e)}}function _0(e,i){var o=i.length;if(!o)return e;var c=o-1;return i[c]=(o>1?"& ":"")+i[c],i=i.join(o>2?", ":" "),e.replace(Ot,`{
/* [wrapped with `+i+`] */
`)}function m0(e){return Re(e)||Yi(e)||!!(zu&&e&&e[zu])}function fi(e,i){var o=typeof e;return i=i!=null?i:W,!!i&&(o=="number"||o!="symbol"&&ia.test(e))&&e>-1&&e%1==0&&e<i}function ir(e,i,o){if(!bt(o))return!1;var c=typeof i;return(c=="number"?pr(o)&&fi(i,o.length):c=="string"&&i in o)?Br(o[i],e):!1}function tc(e,i){if(Re(e))return!1;var o=typeof e;return o=="number"||o=="symbol"||o=="boolean"||e==null||wr(e)?!0:Lt.test(e)||!yt.test(e)||i!=null&&e in ut(i)}function b0(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function rc(e){var i=go(e),o=g[i];if(typeof o!="function"||!(i in Ye.prototype))return!1;if(e===o)return!0;var c=Za(o);return!!c&&e===c[0]}function w0(e){return!!$u&&$u in e}var E0=Bs?pi:mc;function Zn(e){var i=e&&e.constructor,o=typeof i=="function"&&i.prototype||yn;return e===o}function $h(e){return e===e&&!bt(e)}function Mh(e,i){return function(o){return o==null?!1:o[e]===i&&(i!==r||e in ut(o))}}function S0(e){var i=wo(e,function(c){return o.size===w&&o.clear(),c}),o=i.cache;return i}function I0(e,i){var o=e[1],c=i[1],f=o|c,y=f<(B|oe|u),E=c==u&&o==F||c==u&&o==_&&e[7].length<=i[8]||c==(u|_)&&i[7].length<=i[8]&&o==F;if(!(y||E))return e;c&B&&(e[2]=i[2],f|=o&B?0:C);var O=i[3];if(O){var L=e[3];e[3]=L?bh(L,O,i[4]):O,e[4]=L?Si(e[3],x):i[4]}return O=i[5],O&&(L=e[5],e[5]=L?wh(L,O,i[6]):O,e[6]=L?Si(e[5],x):i[6]),O=i[7],O&&(e[7]=O),c&u&&(e[8]=e[8]==null?i[8]:Jt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=f,e}function x0(e){var i=[];if(e!=null)for(var o in ut(e))i.push(o);return i}function O0(e){return ks.call(e)}function jh(e,i,o){return i=Bt(i===r?e.length-1:i,0),function(){for(var c=arguments,f=-1,y=Bt(c.length-i,0),E=H(y);++f<y;)E[f]=c[i+f];f=-1;for(var O=H(i+1);++f<i;)O[f]=c[f];return O[i]=o(E),Vt(e,this,O)}}function qh(e,i){return i.length<2?e:ki(e,Rr(i,0,-1))}function P0(e,i){for(var o=e.length,c=Jt(i.length,o),f=fr(e);c--;){var y=i[c];e[c]=fi(y,o)?f[y]:r}return e}function ic(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var zh=Kh(hh),Qn=Hd||function(e,i){return Xe.setTimeout(e,i)},nc=Kh(Jg);function Hh(e,i,o){var c=i+"";return nc(e,_0(c,A0(g0(c),o)))}function Kh(e){var i=0,o=0;return function(){var c=kd(),f=ge-(c-o);if(o=c,f>0){if(++i>=ce)return arguments[0]}else i=0;return e.apply(r,arguments)}}function yo(e,i){var o=-1,c=e.length,f=c-1;for(i=i===r?c:i;++o<i;){var y=qa(o,f),E=e[y];e[y]=e[o],e[o]=E}return e.length=i,e}var Bh=S0(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Ft,function(o,c,f,y){i.push(f?y.replace(Xo,"$1"):c||o)}),i});function Qr(e){if(typeof e=="string"||wr(e))return e;var i=e+"";return i=="0"&&1/e==-te?"-0":i}function Wi(e){if(e!=null){try{return Vs.call(e)}catch{}try{return e+""}catch{}}return""}function A0(e,i){return Ar(be,function(o){var c="_."+o[0];i&o[1]&&!qs(e,c)&&e.push(c)}),e.sort()}function Vh(e){if(e instanceof Ye)return e.clone();var i=new Nr(e.__wrapped__,e.__chain__);return i.__actions__=fr(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function C0(e,i,o){(o?ir(e,i,o):i===r)?i=1:i=Bt(Me(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var f=0,y=0,E=H(Zs(c/i));f<c;)E[y++]=Rr(e,f,f+=i);return E}function N0(e){for(var i=-1,o=e==null?0:e.length,c=0,f=[];++i<o;){var y=e[i];y&&(f[c++]=y)}return f}function T0(){var e=arguments.length;if(!e)return[];for(var i=H(e-1),o=arguments[0],c=e;c--;)i[c-1]=arguments[c];return Ei(Re(o)?fr(o):[o],Wt(i,1))}var R0=Be(function(e,i){return Tt(e)?Gn(e,Wt(i,1,Tt,!0)):[]}),U0=Be(function(e,i){var o=Ur(i);return Tt(o)&&(o=r),Tt(e)?Gn(e,Wt(i,1,Tt,!0),me(o,2)):[]}),D0=Be(function(e,i){var o=Ur(i);return Tt(o)&&(o=r),Tt(e)?Gn(e,Wt(i,1,Tt,!0),r,o):[]});function L0(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:Me(i),Rr(e,i<0?0:i,c)):[]}function F0(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:Me(i),i=c-i,Rr(e,0,i<0?0:i)):[]}function $0(e,i){return e&&e.length?co(e,me(i,3),!0,!0):[]}function M0(e,i){return e&&e.length?co(e,me(i,3),!0):[]}function j0(e,i,o,c){var f=e==null?0:e.length;return f?(o&&typeof o!="number"&&ir(e,i,o)&&(o=0,c=f),Tg(e,i,o,c)):[]}function kh(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var f=o==null?0:Me(o);return f<0&&(f=Bt(c+f,0)),zs(e,me(i,3),f)}function Gh(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var f=c-1;return o!==r&&(f=Me(o),f=o<0?Bt(c+f,0):Jt(f,c-1)),zs(e,me(i,3),f,!0)}function Wh(e){var i=e==null?0:e.length;return i?Wt(e,1):[]}function q0(e){var i=e==null?0:e.length;return i?Wt(e,te):[]}function z0(e,i){var o=e==null?0:e.length;return o?(i=i===r?1:Me(i),Wt(e,i)):[]}function H0(e){for(var i=-1,o=e==null?0:e.length,c={};++i<o;){var f=e[i];c[f[0]]=f[1]}return c}function Yh(e){return e&&e.length?e[0]:r}function K0(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var f=o==null?0:Me(o);return f<0&&(f=Bt(c+f,0)),pn(e,i,f)}function B0(e){var i=e==null?0:e.length;return i?Rr(e,0,-1):[]}var V0=Be(function(e){var i=_t(e,Va);return i.length&&i[0]===e[0]?La(i):[]}),k0=Be(function(e){var i=Ur(e),o=_t(e,Va);return i===Ur(o)?i=r:o.pop(),o.length&&o[0]===e[0]?La(o,me(i,2)):[]}),G0=Be(function(e){var i=Ur(e),o=_t(e,Va);return i=typeof i=="function"?i:r,i&&o.pop(),o.length&&o[0]===e[0]?La(o,r,i):[]});function W0(e,i){return e==null?"":Bd.call(e,i)}function Ur(e){var i=e==null?0:e.length;return i?e[i-1]:r}function Y0(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var f=c;return o!==r&&(f=Me(o),f=f<0?Bt(c+f,0):Jt(f,c-1)),i===i?Ad(e,i,f):zs(e,Cu,f,!0)}function J0(e,i){return e&&e.length?oh(e,Me(i)):r}var X0=Be(Jh);function Jh(e,i){return e&&e.length&&i&&i.length?ja(e,i):e}function Z0(e,i,o){return e&&e.length&&i&&i.length?ja(e,i,me(o,2)):e}function Q0(e,i,o){return e&&e.length&&i&&i.length?ja(e,i,r,o):e}var e1=li(function(e,i){var o=e==null?0:e.length,c=Ta(e,i);return uh(e,_t(i,function(f){return fi(f,o)?+f:f}).sort(mh)),c});function t1(e,i){var o=[];if(!(e&&e.length))return o;var c=-1,f=[],y=e.length;for(i=me(i,3);++c<y;){var E=e[c];i(E,c,e)&&(o.push(E),f.push(c))}return uh(e,f),o}function sc(e){return e==null?e:Wd.call(e)}function r1(e,i,o){var c=e==null?0:e.length;return c?(o&&typeof o!="number"&&ir(e,i,o)?(i=0,o=c):(i=i==null?0:Me(i),o=o===r?c:Me(o)),Rr(e,i,o)):[]}function i1(e,i){return ao(e,i)}function n1(e,i,o){return Ha(e,i,me(o,2))}function s1(e,i){var o=e==null?0:e.length;if(o){var c=ao(e,i);if(c<o&&Br(e[c],i))return c}return-1}function o1(e,i){return ao(e,i,!0)}function a1(e,i,o){return Ha(e,i,me(o,2),!0)}function c1(e,i){var o=e==null?0:e.length;if(o){var c=ao(e,i,!0)-1;if(Br(e[c],i))return c}return-1}function u1(e){return e&&e.length?lh(e):[]}function h1(e,i){return e&&e.length?lh(e,me(i,2)):[]}function l1(e){var i=e==null?0:e.length;return i?Rr(e,1,i):[]}function f1(e,i,o){return e&&e.length?(i=o||i===r?1:Me(i),Rr(e,0,i<0?0:i)):[]}function p1(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:Me(i),i=c-i,Rr(e,i<0?0:i,c)):[]}function d1(e,i){return e&&e.length?co(e,me(i,3),!1,!0):[]}function g1(e,i){return e&&e.length?co(e,me(i,3)):[]}var v1=Be(function(e){return Oi(Wt(e,1,Tt,!0))}),y1=Be(function(e){var i=Ur(e);return Tt(i)&&(i=r),Oi(Wt(e,1,Tt,!0),me(i,2))}),_1=Be(function(e){var i=Ur(e);return i=typeof i=="function"?i:r,Oi(Wt(e,1,Tt,!0),r,i)});function m1(e){return e&&e.length?Oi(e):[]}function b1(e,i){return e&&e.length?Oi(e,me(i,2)):[]}function w1(e,i){return i=typeof i=="function"?i:r,e&&e.length?Oi(e,r,i):[]}function oc(e){if(!(e&&e.length))return[];var i=0;return e=wi(e,function(o){if(Tt(o))return i=Bt(o.length,i),!0}),Sa(i,function(o){return _t(e,ba(o))})}function Xh(e,i){if(!(e&&e.length))return[];var o=oc(e);return i==null?o:_t(o,function(c){return Vt(i,r,c)})}var E1=Be(function(e,i){return Tt(e)?Gn(e,i):[]}),S1=Be(function(e){return Ba(wi(e,Tt))}),I1=Be(function(e){var i=Ur(e);return Tt(i)&&(i=r),Ba(wi(e,Tt),me(i,2))}),x1=Be(function(e){var i=Ur(e);return i=typeof i=="function"?i:r,Ba(wi(e,Tt),r,i)}),O1=Be(oc);function P1(e,i){return gh(e||[],i||[],kn)}function A1(e,i){return gh(e||[],i||[],Jn)}var C1=Be(function(e){var i=e.length,o=i>1?e[i-1]:r;return o=typeof o=="function"?(e.pop(),o):r,Xh(e,o)});function Zh(e){var i=g(e);return i.__chain__=!0,i}function N1(e,i){return i(e),e}function _o(e,i){return i(e)}var T1=li(function(e){var i=e.length,o=i?e[0]:0,c=this.__wrapped__,f=function(y){return Ta(y,e)};return i>1||this.__actions__.length||!(c instanceof Ye)||!fi(o)?this.thru(f):(c=c.slice(o,+o+(i?1:0)),c.__actions__.push({func:_o,args:[f],thisArg:r}),new Nr(c,this.__chain__).thru(function(y){return i&&!y.length&&y.push(r),y}))});function R1(){return Zh(this)}function U1(){return new Nr(this.value(),this.__chain__)}function D1(){this.__values__===r&&(this.__values__=fl(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function L1(){return this}function F1(e){for(var i,o=this;o instanceof ro;){var c=Vh(o);c.__index__=0,c.__values__=r,i?f.__wrapped__=c:i=c;var f=c;o=o.__wrapped__}return f.__wrapped__=e,i}function $1(){var e=this.__wrapped__;if(e instanceof Ye){var i=e;return this.__actions__.length&&(i=new Ye(this)),i=i.reverse(),i.__actions__.push({func:_o,args:[sc],thisArg:r}),new Nr(i,this.__chain__)}return this.thru(sc)}function M1(){return dh(this.__wrapped__,this.__actions__)}var j1=uo(function(e,i,o){nt.call(e,o)?++e[o]:ui(e,o,1)});function q1(e,i,o){var c=Re(e)?Pu:Ng;return o&&ir(e,i,o)&&(i=r),c(e,me(i,3))}function z1(e,i){var o=Re(e)?wi:Xu;return o(e,me(i,3))}var H1=xh(kh),K1=xh(Gh);function B1(e,i){return Wt(mo(e,i),1)}function V1(e,i){return Wt(mo(e,i),te)}function k1(e,i,o){return o=o===r?1:Me(o),Wt(mo(e,i),o)}function Qh(e,i){var o=Re(e)?Ar:xi;return o(e,me(i,3))}function el(e,i){var o=Re(e)?ld:Ju;return o(e,me(i,3))}var G1=uo(function(e,i,o){nt.call(e,o)?e[o].push(i):ui(e,o,[i])});function W1(e,i,o,c){e=pr(e)?e:xn(e),o=o&&!c?Me(o):0;var f=e.length;return o<0&&(o=Bt(f+o,0)),Io(e)?o<=f&&e.indexOf(i,o)>-1:!!f&&pn(e,i,o)>-1}var Y1=Be(function(e,i,o){var c=-1,f=typeof i=="function",y=pr(e)?H(e.length):[];return xi(e,function(E){y[++c]=f?Vt(i,E,o):Wn(E,i,o)}),y}),J1=uo(function(e,i,o){ui(e,o,i)});function mo(e,i){var o=Re(e)?_t:ih;return o(e,me(i,3))}function X1(e,i,o,c){return e==null?[]:(Re(i)||(i=i==null?[]:[i]),o=c?r:o,Re(o)||(o=o==null?[]:[o]),ah(e,i,o))}var Z1=uo(function(e,i,o){e[o?0:1].push(i)},function(){return[[],[]]});function Q1(e,i,o){var c=Re(e)?_a:Tu,f=arguments.length<3;return c(e,me(i,4),o,f,xi)}function ev(e,i,o){var c=Re(e)?fd:Tu,f=arguments.length<3;return c(e,me(i,4),o,f,Ju)}function tv(e,i){var o=Re(e)?wi:Xu;return o(e,Eo(me(i,3)))}function rv(e){var i=Re(e)?ku:Wg;return i(e)}function iv(e,i,o){(o?ir(e,i,o):i===r)?i=1:i=Me(i);var c=Re(e)?xg:Yg;return c(e,i)}function nv(e){var i=Re(e)?Og:Xg;return i(e)}function sv(e){if(e==null)return 0;if(pr(e))return Io(e)?gn(e):e.length;var i=Xt(e);return i==Ie||i==xe?e.size:$a(e).length}function ov(e,i,o){var c=Re(e)?ma:Zg;return o&&ir(e,i,o)&&(i=r),c(e,me(i,3))}var av=Be(function(e,i){if(e==null)return[];var o=i.length;return o>1&&ir(e,i[0],i[1])?i=[]:o>2&&ir(i[0],i[1],i[2])&&(i=[i[0]]),ah(e,Wt(i,1),[])}),bo=zd||function(){return Xe.Date.now()};function cv(e,i){if(typeof i!="function")throw new Cr(d);return e=Me(e),function(){if(--e<1)return i.apply(this,arguments)}}function tl(e,i,o){return i=o?r:i,i=e&&i==null?e.length:i,hi(e,u,r,r,r,r,i)}function rl(e,i){var o;if(typeof i!="function")throw new Cr(d);return e=Me(e),function(){return--e>0&&(o=i.apply(this,arguments)),e<=1&&(i=r),o}}var ac=Be(function(e,i,o){var c=B;if(o.length){var f=Si(o,Sn(ac));c|=P}return hi(e,c,i,o,f)}),il=Be(function(e,i,o){var c=B|oe;if(o.length){var f=Si(o,Sn(il));c|=P}return hi(i,c,e,o,f)});function nl(e,i,o){i=o?r:i;var c=hi(e,F,r,r,r,r,r,i);return c.placeholder=nl.placeholder,c}function sl(e,i,o){i=o?r:i;var c=hi(e,S,r,r,r,r,r,i);return c.placeholder=sl.placeholder,c}function ol(e,i,o){var c,f,y,E,O,L,J=0,X=!1,Q=!1,ae=!0;if(typeof e!="function")throw new Cr(d);i=Dr(i)||0,bt(o)&&(X=!!o.leading,Q="maxWait"in o,y=Q?Bt(Dr(o.maxWait)||0,i):y,ae="trailing"in o?!!o.trailing:ae);function ve(Rt){var Vr=c,gi=f;return c=f=r,J=Rt,E=e.apply(gi,Vr),E}function we(Rt){return J=Rt,O=Qn(Ge,i),X?ve(Rt):E}function ze(Rt){var Vr=Rt-L,gi=Rt-J,xl=i-Vr;return Q?Jt(xl,y-gi):xl}function Ee(Rt){var Vr=Rt-L,gi=Rt-J;return L===r||Vr>=i||Vr<0||Q&&gi>=y}function Ge(){var Rt=bo();if(Ee(Rt))return Ze(Rt);O=Qn(Ge,ze(Rt))}function Ze(Rt){return O=r,ae&&c?ve(Rt):(c=f=r,E)}function Er(){O!==r&&vh(O),J=0,c=L=f=O=r}function nr(){return O===r?E:Ze(bo())}function Sr(){var Rt=bo(),Vr=Ee(Rt);if(c=arguments,f=this,L=Rt,Vr){if(O===r)return we(L);if(Q)return vh(O),O=Qn(Ge,i),ve(L)}return O===r&&(O=Qn(Ge,i)),E}return Sr.cancel=Er,Sr.flush=nr,Sr}var uv=Be(function(e,i){return Yu(e,1,i)}),hv=Be(function(e,i,o){return Yu(e,Dr(i)||0,o)});function lv(e){return hi(e,G)}function wo(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Cr(d);var o=function(){var c=arguments,f=i?i.apply(this,c):c[0],y=o.cache;if(y.has(f))return y.get(f);var E=e.apply(this,c);return o.cache=y.set(f,E)||y,E};return o.cache=new(wo.Cache||ci),o}wo.Cache=ci;function Eo(e){if(typeof e!="function")throw new Cr(d);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function fv(e){return rl(2,e)}var pv=Qg(function(e,i){i=i.length==1&&Re(i[0])?_t(i[0],mr(me())):_t(Wt(i,1),mr(me()));var o=i.length;return Be(function(c){for(var f=-1,y=Jt(c.length,o);++f<y;)c[f]=i[f].call(this,c[f]);return Vt(e,this,c)})}),cc=Be(function(e,i){var o=Si(i,Sn(cc));return hi(e,P,r,i,o)}),al=Be(function(e,i){var o=Si(i,Sn(al));return hi(e,m,r,i,o)}),dv=li(function(e,i){return hi(e,_,r,r,r,i)});function gv(e,i){if(typeof e!="function")throw new Cr(d);return i=i===r?i:Me(i),Be(e,i)}function vv(e,i){if(typeof e!="function")throw new Cr(d);return i=i==null?0:Bt(Me(i),0),Be(function(o){var c=o[i],f=Ai(o,0,i);return c&&Ei(f,c),Vt(e,this,f)})}function yv(e,i,o){var c=!0,f=!0;if(typeof e!="function")throw new Cr(d);return bt(o)&&(c="leading"in o?!!o.leading:c,f="trailing"in o?!!o.trailing:f),ol(e,i,{leading:c,maxWait:i,trailing:f})}function _v(e){return tl(e,1)}function mv(e,i){return cc(ka(i),e)}function bv(){if(!arguments.length)return[];var e=arguments[0];return Re(e)?e:[e]}function wv(e){return Tr(e,U)}function Ev(e,i){return i=typeof i=="function"?i:r,Tr(e,U,i)}function Sv(e){return Tr(e,D|U)}function Iv(e,i){return i=typeof i=="function"?i:r,Tr(e,D|U,i)}function xv(e,i){return i==null||Wu(e,i,kt(i))}function Br(e,i){return e===i||e!==e&&i!==i}var Ov=po(Da),Pv=po(function(e,i){return e>=i}),Yi=eh(function(){return arguments}())?eh:function(e){return Pt(e)&&nt.call(e,"callee")&&!qu.call(e,"callee")},Re=H.isArray,Av=tr?mr(tr):Fg;function pr(e){return e!=null&&So(e.length)&&!pi(e)}function Tt(e){return Pt(e)&&pr(e)}function Cv(e){return e===!0||e===!1||Pt(e)&&rr(e)==$}var Ci=Kd||mc,Nv=zr?mr(zr):$g;function Tv(e){return Pt(e)&&e.nodeType===1&&!es(e)}function Rv(e){if(e==null)return!0;if(pr(e)&&(Re(e)||typeof e=="string"||typeof e.splice=="function"||Ci(e)||In(e)||Yi(e)))return!e.length;var i=Xt(e);if(i==Ie||i==xe)return!e.size;if(Zn(e))return!$a(e).length;for(var o in e)if(nt.call(e,o))return!1;return!0}function Uv(e,i){return Yn(e,i)}function Dv(e,i,o){o=typeof o=="function"?o:r;var c=o?o(e,i):r;return c===r?Yn(e,i,r,o):!!c}function uc(e){if(!Pt(e))return!1;var i=rr(e);return i==I||i==h||typeof e.message=="string"&&typeof e.name=="string"&&!es(e)}function Lv(e){return typeof e=="number"&&Hu(e)}function pi(e){if(!bt(e))return!1;var i=rr(e);return i==ne||i==fe||i==M||i==gt}function cl(e){return typeof e=="number"&&e==Me(e)}function So(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=W}function bt(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function Pt(e){return e!=null&&typeof e=="object"}var ul=Pr?mr(Pr):jg;function Fv(e,i){return e===i||Fa(e,i,Qa(i))}function $v(e,i,o){return o=typeof o=="function"?o:r,Fa(e,i,Qa(i),o)}function Mv(e){return hl(e)&&e!=+e}function jv(e){if(E0(e))throw new Ne(l);return th(e)}function qv(e){return e===null}function zv(e){return e==null}function hl(e){return typeof e=="number"||Pt(e)&&rr(e)==He}function es(e){if(!Pt(e)||rr(e)!=$e)return!1;var i=Ys(e);if(i===null)return!0;var o=nt.call(i,"constructor")&&i.constructor;return typeof o=="function"&&o instanceof o&&Vs.call(o)==$d}var hc=Jr?mr(Jr):qg;function Hv(e){return cl(e)&&e>=-W&&e<=W}var ll=jn?mr(jn):zg;function Io(e){return typeof e=="string"||!Re(e)&&Pt(e)&&rr(e)==Ue}function wr(e){return typeof e=="symbol"||Pt(e)&&rr(e)==De}var In=zi?mr(zi):Hg;function Kv(e){return e===r}function Bv(e){return Pt(e)&&Xt(e)==Ae}function Vv(e){return Pt(e)&&rr(e)==Le}var kv=po(Ma),Gv=po(function(e,i){return e<=i});function fl(e){if(!e)return[];if(pr(e))return Io(e)?Hr(e):fr(e);if(zn&&e[zn])return xd(e[zn]());var i=Xt(e),o=i==Ie?xa:i==xe?Hs:xn;return o(e)}function di(e){if(!e)return e===0?e:0;if(e=Dr(e),e===te||e===-te){var i=e<0?-1:1;return i*ee}return e===e?e:0}function Me(e){var i=di(e),o=i%1;return i===i?o?i-o:i:0}function pl(e){return e?Vi(Me(e),0,re):0}function Dr(e){if(typeof e=="number")return e;if(wr(e))return Y;if(bt(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=bt(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=Ru(e);var o=ea.test(e);return o||ra.test(e)?Te(e.slice(2),o?2:8):Qo.test(e)?Y:+e}function dl(e){return Zr(e,dr(e))}function Wv(e){return e?Vi(Me(e),-W,W):e===0?e:0}function it(e){return e==null?"":br(e)}var Yv=wn(function(e,i){if(Zn(i)||pr(i)){Zr(i,kt(i),e);return}for(var o in i)nt.call(i,o)&&kn(e,o,i[o])}),gl=wn(function(e,i){Zr(i,dr(i),e)}),xo=wn(function(e,i,o,c){Zr(i,dr(i),e,c)}),Jv=wn(function(e,i,o,c){Zr(i,kt(i),e,c)}),Xv=li(Ta);function Zv(e,i){var o=bn(e);return i==null?o:Gu(o,i)}var Qv=Be(function(e,i){e=ut(e);var o=-1,c=i.length,f=c>2?i[2]:r;for(f&&ir(i[0],i[1],f)&&(c=1);++o<c;)for(var y=i[o],E=dr(y),O=-1,L=E.length;++O<L;){var J=E[O],X=e[J];(X===r||Br(X,yn[J])&&!nt.call(e,J))&&(e[J]=y[J])}return e}),ey=Be(function(e){return e.push(r,Rh),Vt(vl,r,e)});function ty(e,i){return Au(e,me(i,3),Xr)}function ry(e,i){return Au(e,me(i,3),Ua)}function iy(e,i){return e==null?e:Ra(e,me(i,3),dr)}function ny(e,i){return e==null?e:Zu(e,me(i,3),dr)}function sy(e,i){return e&&Xr(e,me(i,3))}function oy(e,i){return e&&Ua(e,me(i,3))}function ay(e){return e==null?[]:so(e,kt(e))}function cy(e){return e==null?[]:so(e,dr(e))}function lc(e,i,o){var c=e==null?r:ki(e,i);return c===r?o:c}function uy(e,i){return e!=null&&Lh(e,i,Rg)}function fc(e,i){return e!=null&&Lh(e,i,Ug)}var hy=Ph(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=ks.call(i)),e[i]=o},dc(gr)),ly=Ph(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=ks.call(i)),nt.call(e,i)?e[i].push(o):e[i]=[o]},me),fy=Be(Wn);function kt(e){return pr(e)?Vu(e):$a(e)}function dr(e){return pr(e)?Vu(e,!0):Kg(e)}function py(e,i){var o={};return i=me(i,3),Xr(e,function(c,f,y){ui(o,i(c,f,y),c)}),o}function dy(e,i){var o={};return i=me(i,3),Xr(e,function(c,f,y){ui(o,f,i(c,f,y))}),o}var gy=wn(function(e,i,o){oo(e,i,o)}),vl=wn(function(e,i,o,c){oo(e,i,o,c)}),vy=li(function(e,i){var o={};if(e==null)return o;var c=!1;i=_t(i,function(y){return y=Pi(y,e),c||(c=y.length>1),y}),Zr(e,Xa(e),o),c&&(o=Tr(o,D|j|U,h0));for(var f=i.length;f--;)Ka(o,i[f]);return o});function yy(e,i){return yl(e,Eo(me(i)))}var _y=li(function(e,i){return e==null?{}:Vg(e,i)});function yl(e,i){if(e==null)return{};var o=_t(Xa(e),function(c){return[c]});return i=me(i),ch(e,o,function(c,f){return i(c,f[0])})}function my(e,i,o){i=Pi(i,e);var c=-1,f=i.length;for(f||(f=1,e=r);++c<f;){var y=e==null?r:e[Qr(i[c])];y===r&&(c=f,y=o),e=pi(y)?y.call(e):y}return e}function by(e,i,o){return e==null?e:Jn(e,i,o)}function wy(e,i,o,c){return c=typeof c=="function"?c:r,e==null?e:Jn(e,i,o,c)}var _l=Nh(kt),ml=Nh(dr);function Ey(e,i,o){var c=Re(e),f=c||Ci(e)||In(e);if(i=me(i,4),o==null){var y=e&&e.constructor;f?o=c?new y:[]:bt(e)?o=pi(y)?bn(Ys(e)):{}:o={}}return(f?Ar:Xr)(e,function(E,O,L){return i(o,E,O,L)}),o}function Sy(e,i){return e==null?!0:Ka(e,i)}function Iy(e,i,o){return e==null?e:ph(e,i,ka(o))}function xy(e,i,o,c){return c=typeof c=="function"?c:r,e==null?e:ph(e,i,ka(o),c)}function xn(e){return e==null?[]:Ia(e,kt(e))}function Oy(e){return e==null?[]:Ia(e,dr(e))}function Py(e,i,o){return o===r&&(o=i,i=r),o!==r&&(o=Dr(o),o=o===o?o:0),i!==r&&(i=Dr(i),i=i===i?i:0),Vi(Dr(e),i,o)}function Ay(e,i,o){return i=di(i),o===r?(o=i,i=0):o=di(o),e=Dr(e),Dg(e,i,o)}function Cy(e,i,o){if(o&&typeof o!="boolean"&&ir(e,i,o)&&(i=o=r),o===r&&(typeof i=="boolean"?(o=i,i=r):typeof e=="boolean"&&(o=e,e=r)),e===r&&i===r?(e=0,i=1):(e=di(e),i===r?(i=e,e=0):i=di(i)),e>i){var c=e;e=i,i=c}if(o||e%1||i%1){var f=Ku();return Jt(e+f*(i-e+at("1e-"+((f+"").length-1))),i)}return qa(e,i)}var Ny=En(function(e,i,o){return i=i.toLowerCase(),e+(o?bl(i):i)});function bl(e){return pc(it(e).toLowerCase())}function wl(e){return e=it(e),e&&e.replace(si,bd).replace(ga,"")}function Ty(e,i,o){e=it(e),i=br(i);var c=e.length;o=o===r?c:Vi(Me(o),0,c);var f=o;return o-=i.length,o>=0&&e.slice(o,f)==i}function Ry(e){return e=it(e),e&&vt.test(e)?e.replace(Fi,wd):e}function Uy(e){return e=it(e),e&&$t.test(e)?e.replace(It,"\\$&"):e}var Dy=En(function(e,i,o){return e+(o?"-":"")+i.toLowerCase()}),Ly=En(function(e,i,o){return e+(o?" ":"")+i.toLowerCase()}),Fy=Ih("toLowerCase");function $y(e,i,o){e=it(e),i=Me(i);var c=i?gn(e):0;if(!i||c>=i)return e;var f=(i-c)/2;return fo(Qs(f),o)+e+fo(Zs(f),o)}function My(e,i,o){e=it(e),i=Me(i);var c=i?gn(e):0;return i&&c<i?e+fo(i-c,o):e}function jy(e,i,o){e=it(e),i=Me(i);var c=i?gn(e):0;return i&&c<i?fo(i-c,o)+e:e}function qy(e,i,o){return o||i==null?i=0:i&&(i=+i),Gd(it(e).replace(xt,""),i||0)}function zy(e,i,o){return(o?ir(e,i,o):i===r)?i=1:i=Me(i),za(it(e),i)}function Hy(){var e=arguments,i=it(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var Ky=En(function(e,i,o){return e+(o?"_":"")+i.toLowerCase()});function By(e,i,o){return o&&typeof o!="number"&&ir(e,i,o)&&(i=o=r),o=o===r?re:o>>>0,o?(e=it(e),e&&(typeof i=="string"||i!=null&&!hc(i))&&(i=br(i),!i&&dn(e))?Ai(Hr(e),0,o):e.split(i,o)):[]}var Vy=En(function(e,i,o){return e+(o?" ":"")+pc(i)});function ky(e,i,o){return e=it(e),o=o==null?0:Vi(Me(o),0,e.length),i=br(i),e.slice(o,o+i.length)==i}function Gy(e,i,o){var c=g.templateSettings;o&&ir(e,i,o)&&(i=r),e=it(e),i=xo({},i,c,Th);var f=xo({},i.imports,c.imports,Th),y=kt(f),E=Ia(f,y),O,L,J=0,X=i.interpolate||on,Q="__p += '",ae=Oa((i.escape||on).source+"|"+X.source+"|"+(X===mt?Zo:on).source+"|"+(i.evaluate||on).source+"|$","g"),ve="//# sourceURL="+(nt.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++va+"]")+`
`;e.replace(ae,function(Ee,Ge,Ze,Er,nr,Sr){return Ze||(Ze=Er),Q+=e.slice(J,Sr).replace(na,Ed),Ge&&(O=!0,Q+=`' +
__e(`+Ge+`) +
'`),nr&&(L=!0,Q+=`';
`+nr+`;
__p += '`),Ze&&(Q+=`' +
((__t = (`+Ze+`)) == null ? '' : __t) +
'`),J=Sr+Ee.length,Ee}),Q+=`';
`;var we=nt.call(i,"variable")&&i.variable;if(!we)Q=`with (obj) {
`+Q+`
}
`;else if(Jo.test(we))throw new Ne(p);Q=(L?Q.replace(Wr,""):Q).replace(er,"$1").replace(ni,"$1;"),Q="function("+(we||"obj")+`) {
`+(we?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(O?", __e = _.escape":"")+(L?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Q+`return __p
}`;var ze=Sl(function(){return rt(y,ve+"return "+Q).apply(r,E)});if(ze.source=Q,uc(ze))throw ze;return ze}function Wy(e){return it(e).toLowerCase()}function Yy(e){return it(e).toUpperCase()}function Jy(e,i,o){if(e=it(e),e&&(o||i===r))return Ru(e);if(!e||!(i=br(i)))return e;var c=Hr(e),f=Hr(i),y=Uu(c,f),E=Du(c,f)+1;return Ai(c,y,E).join("")}function Xy(e,i,o){if(e=it(e),e&&(o||i===r))return e.slice(0,Fu(e)+1);if(!e||!(i=br(i)))return e;var c=Hr(e),f=Du(c,Hr(i))+1;return Ai(c,0,f).join("")}function Zy(e,i,o){if(e=it(e),e&&(o||i===r))return e.replace(xt,"");if(!e||!(i=br(i)))return e;var c=Hr(e),f=Uu(c,Hr(i));return Ai(c,f).join("")}function Qy(e,i){var o=k,c=se;if(bt(i)){var f="separator"in i?i.separator:f;o="length"in i?Me(i.length):o,c="omission"in i?br(i.omission):c}e=it(e);var y=e.length;if(dn(e)){var E=Hr(e);y=E.length}if(o>=y)return e;var O=o-gn(c);if(O<1)return c;var L=E?Ai(E,0,O).join(""):e.slice(0,O);if(f===r)return L+c;if(E&&(O+=L.length-O),hc(f)){if(e.slice(O).search(f)){var J,X=L;for(f.global||(f=Oa(f.source,it(Or.exec(f))+"g")),f.lastIndex=0;J=f.exec(X);)var Q=J.index;L=L.slice(0,Q===r?O:Q)}}else if(e.indexOf(br(f),O)!=O){var ae=L.lastIndexOf(f);ae>-1&&(L=L.slice(0,ae))}return L+c}function e_(e){return e=it(e),e&&wt.test(e)?e.replace(mi,Cd):e}var t_=En(function(e,i,o){return e+(o?" ":"")+i.toUpperCase()}),pc=Ih("toUpperCase");function El(e,i,o){return e=it(e),i=o?r:i,i===r?Id(e)?Rd(e):gd(e):e.match(i)||[]}var Sl=Be(function(e,i){try{return Vt(e,r,i)}catch(o){return uc(o)?o:new Ne(o)}}),r_=li(function(e,i){return Ar(i,function(o){o=Qr(o),ui(e,o,ac(e[o],e))}),e});function i_(e){var i=e==null?0:e.length,o=me();return e=i?_t(e,function(c){if(typeof c[1]!="function")throw new Cr(d);return[o(c[0]),c[1]]}):[],Be(function(c){for(var f=-1;++f<i;){var y=e[f];if(Vt(y[0],this,c))return Vt(y[1],this,c)}})}function n_(e){return Cg(Tr(e,D))}function dc(e){return function(){return e}}function s_(e,i){return e==null||e!==e?i:e}var o_=Oh(),a_=Oh(!0);function gr(e){return e}function gc(e){return rh(typeof e=="function"?e:Tr(e,D))}function c_(e){return nh(Tr(e,D))}function u_(e,i){return sh(e,Tr(i,D))}var h_=Be(function(e,i){return function(o){return Wn(o,e,i)}}),l_=Be(function(e,i){return function(o){return Wn(e,o,i)}});function vc(e,i,o){var c=kt(i),f=so(i,c);o==null&&!(bt(i)&&(f.length||!c.length))&&(o=i,i=e,e=this,f=so(i,kt(i)));var y=!(bt(o)&&"chain"in o)||!!o.chain,E=pi(e);return Ar(f,function(O){var L=i[O];e[O]=L,E&&(e.prototype[O]=function(){var J=this.__chain__;if(y||J){var X=e(this.__wrapped__),Q=X.__actions__=fr(this.__actions__);return Q.push({func:L,args:arguments,thisArg:e}),X.__chain__=J,X}return L.apply(e,Ei([this.value()],arguments))})}),e}function f_(){return Xe._===this&&(Xe._=Md),this}function yc(){}function p_(e){return e=Me(e),Be(function(i){return oh(i,e)})}var d_=Wa(_t),g_=Wa(Pu),v_=Wa(ma);function Il(e){return tc(e)?ba(Qr(e)):kg(e)}function y_(e){return function(i){return e==null?r:ki(e,i)}}var __=Ah(),m_=Ah(!0);function _c(){return[]}function mc(){return!1}function b_(){return{}}function w_(){return""}function E_(){return!0}function S_(e,i){if(e=Me(e),e<1||e>W)return[];var o=re,c=Jt(e,re);i=me(i),e-=re;for(var f=Sa(c,i);++o<e;)i(o);return f}function I_(e){return Re(e)?_t(e,Qr):wr(e)?[e]:fr(Bh(it(e)))}function x_(e){var i=++Fd;return it(e)+i}var O_=lo(function(e,i){return e+i},0),P_=Ya("ceil"),A_=lo(function(e,i){return e/i},1),C_=Ya("floor");function N_(e){return e&&e.length?no(e,gr,Da):r}function T_(e,i){return e&&e.length?no(e,me(i,2),Da):r}function R_(e){return Nu(e,gr)}function U_(e,i){return Nu(e,me(i,2))}function D_(e){return e&&e.length?no(e,gr,Ma):r}function L_(e,i){return e&&e.length?no(e,me(i,2),Ma):r}var F_=lo(function(e,i){return e*i},1),$_=Ya("round"),M_=lo(function(e,i){return e-i},0);function j_(e){return e&&e.length?Ea(e,gr):0}function q_(e,i){return e&&e.length?Ea(e,me(i,2)):0}return g.after=cv,g.ary=tl,g.assign=Yv,g.assignIn=gl,g.assignInWith=xo,g.assignWith=Jv,g.at=Xv,g.before=rl,g.bind=ac,g.bindAll=r_,g.bindKey=il,g.castArray=bv,g.chain=Zh,g.chunk=C0,g.compact=N0,g.concat=T0,g.cond=i_,g.conforms=n_,g.constant=dc,g.countBy=j1,g.create=Zv,g.curry=nl,g.curryRight=sl,g.debounce=ol,g.defaults=Qv,g.defaultsDeep=ey,g.defer=uv,g.delay=hv,g.difference=R0,g.differenceBy=U0,g.differenceWith=D0,g.drop=L0,g.dropRight=F0,g.dropRightWhile=$0,g.dropWhile=M0,g.fill=j0,g.filter=z1,g.flatMap=B1,g.flatMapDeep=V1,g.flatMapDepth=k1,g.flatten=Wh,g.flattenDeep=q0,g.flattenDepth=z0,g.flip=lv,g.flow=o_,g.flowRight=a_,g.fromPairs=H0,g.functions=ay,g.functionsIn=cy,g.groupBy=G1,g.initial=B0,g.intersection=V0,g.intersectionBy=k0,g.intersectionWith=G0,g.invert=hy,g.invertBy=ly,g.invokeMap=Y1,g.iteratee=gc,g.keyBy=J1,g.keys=kt,g.keysIn=dr,g.map=mo,g.mapKeys=py,g.mapValues=dy,g.matches=c_,g.matchesProperty=u_,g.memoize=wo,g.merge=gy,g.mergeWith=vl,g.method=h_,g.methodOf=l_,g.mixin=vc,g.negate=Eo,g.nthArg=p_,g.omit=vy,g.omitBy=yy,g.once=fv,g.orderBy=X1,g.over=d_,g.overArgs=pv,g.overEvery=g_,g.overSome=v_,g.partial=cc,g.partialRight=al,g.partition=Z1,g.pick=_y,g.pickBy=yl,g.property=Il,g.propertyOf=y_,g.pull=X0,g.pullAll=Jh,g.pullAllBy=Z0,g.pullAllWith=Q0,g.pullAt=e1,g.range=__,g.rangeRight=m_,g.rearg=dv,g.reject=tv,g.remove=t1,g.rest=gv,g.reverse=sc,g.sampleSize=iv,g.set=by,g.setWith=wy,g.shuffle=nv,g.slice=r1,g.sortBy=av,g.sortedUniq=u1,g.sortedUniqBy=h1,g.split=By,g.spread=vv,g.tail=l1,g.take=f1,g.takeRight=p1,g.takeRightWhile=d1,g.takeWhile=g1,g.tap=N1,g.throttle=yv,g.thru=_o,g.toArray=fl,g.toPairs=_l,g.toPairsIn=ml,g.toPath=I_,g.toPlainObject=dl,g.transform=Ey,g.unary=_v,g.union=v1,g.unionBy=y1,g.unionWith=_1,g.uniq=m1,g.uniqBy=b1,g.uniqWith=w1,g.unset=Sy,g.unzip=oc,g.unzipWith=Xh,g.update=Iy,g.updateWith=xy,g.values=xn,g.valuesIn=Oy,g.without=E1,g.words=El,g.wrap=mv,g.xor=S1,g.xorBy=I1,g.xorWith=x1,g.zip=O1,g.zipObject=P1,g.zipObjectDeep=A1,g.zipWith=C1,g.entries=_l,g.entriesIn=ml,g.extend=gl,g.extendWith=xo,vc(g,g),g.add=O_,g.attempt=Sl,g.camelCase=Ny,g.capitalize=bl,g.ceil=P_,g.clamp=Py,g.clone=wv,g.cloneDeep=Sv,g.cloneDeepWith=Iv,g.cloneWith=Ev,g.conformsTo=xv,g.deburr=wl,g.defaultTo=s_,g.divide=A_,g.endsWith=Ty,g.eq=Br,g.escape=Ry,g.escapeRegExp=Uy,g.every=q1,g.find=H1,g.findIndex=kh,g.findKey=ty,g.findLast=K1,g.findLastIndex=Gh,g.findLastKey=ry,g.floor=C_,g.forEach=Qh,g.forEachRight=el,g.forIn=iy,g.forInRight=ny,g.forOwn=sy,g.forOwnRight=oy,g.get=lc,g.gt=Ov,g.gte=Pv,g.has=uy,g.hasIn=fc,g.head=Yh,g.identity=gr,g.includes=W1,g.indexOf=K0,g.inRange=Ay,g.invoke=fy,g.isArguments=Yi,g.isArray=Re,g.isArrayBuffer=Av,g.isArrayLike=pr,g.isArrayLikeObject=Tt,g.isBoolean=Cv,g.isBuffer=Ci,g.isDate=Nv,g.isElement=Tv,g.isEmpty=Rv,g.isEqual=Uv,g.isEqualWith=Dv,g.isError=uc,g.isFinite=Lv,g.isFunction=pi,g.isInteger=cl,g.isLength=So,g.isMap=ul,g.isMatch=Fv,g.isMatchWith=$v,g.isNaN=Mv,g.isNative=jv,g.isNil=zv,g.isNull=qv,g.isNumber=hl,g.isObject=bt,g.isObjectLike=Pt,g.isPlainObject=es,g.isRegExp=hc,g.isSafeInteger=Hv,g.isSet=ll,g.isString=Io,g.isSymbol=wr,g.isTypedArray=In,g.isUndefined=Kv,g.isWeakMap=Bv,g.isWeakSet=Vv,g.join=W0,g.kebabCase=Dy,g.last=Ur,g.lastIndexOf=Y0,g.lowerCase=Ly,g.lowerFirst=Fy,g.lt=kv,g.lte=Gv,g.max=N_,g.maxBy=T_,g.mean=R_,g.meanBy=U_,g.min=D_,g.minBy=L_,g.stubArray=_c,g.stubFalse=mc,g.stubObject=b_,g.stubString=w_,g.stubTrue=E_,g.multiply=F_,g.nth=J0,g.noConflict=f_,g.noop=yc,g.now=bo,g.pad=$y,g.padEnd=My,g.padStart=jy,g.parseInt=qy,g.random=Cy,g.reduce=Q1,g.reduceRight=ev,g.repeat=zy,g.replace=Hy,g.result=my,g.round=$_,g.runInContext=R,g.sample=rv,g.size=sv,g.snakeCase=Ky,g.some=ov,g.sortedIndex=i1,g.sortedIndexBy=n1,g.sortedIndexOf=s1,g.sortedLastIndex=o1,g.sortedLastIndexBy=a1,g.sortedLastIndexOf=c1,g.startCase=Vy,g.startsWith=ky,g.subtract=M_,g.sum=j_,g.sumBy=q_,g.template=Gy,g.times=S_,g.toFinite=di,g.toInteger=Me,g.toLength=pl,g.toLower=Wy,g.toNumber=Dr,g.toSafeInteger=Wv,g.toString=it,g.toUpper=Yy,g.trim=Jy,g.trimEnd=Xy,g.trimStart=Zy,g.truncate=Qy,g.unescape=e_,g.uniqueId=x_,g.upperCase=t_,g.upperFirst=pc,g.each=Qh,g.eachRight=el,g.first=Yh,vc(g,function(){var e={};return Xr(g,function(i,o){nt.call(g.prototype,o)||(e[o]=i)}),e}(),{chain:!1}),g.VERSION=s,Ar(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){g[e].placeholder=g}),Ar(["drop","take"],function(e,i){Ye.prototype[e]=function(o){o=o===r?1:Bt(Me(o),0);var c=this.__filtered__&&!i?new Ye(this):this.clone();return c.__filtered__?c.__takeCount__=Jt(o,c.__takeCount__):c.__views__.push({size:Jt(o,re),type:e+(c.__dir__<0?"Right":"")}),c},Ye.prototype[e+"Right"]=function(o){return this.reverse()[e](o).reverse()}}),Ar(["filter","map","takeWhile"],function(e,i){var o=i+1,c=o==N||o==le;Ye.prototype[e]=function(f){var y=this.clone();return y.__iteratees__.push({iteratee:me(f,3),type:o}),y.__filtered__=y.__filtered__||c,y}}),Ar(["head","last"],function(e,i){var o="take"+(i?"Right":"");Ye.prototype[e]=function(){return this[o](1).value()[0]}}),Ar(["initial","tail"],function(e,i){var o="drop"+(i?"":"Right");Ye.prototype[e]=function(){return this.__filtered__?new Ye(this):this[o](1)}}),Ye.prototype.compact=function(){return this.filter(gr)},Ye.prototype.find=function(e){return this.filter(e).head()},Ye.prototype.findLast=function(e){return this.reverse().find(e)},Ye.prototype.invokeMap=Be(function(e,i){return typeof e=="function"?new Ye(this):this.map(function(o){return Wn(o,e,i)})}),Ye.prototype.reject=function(e){return this.filter(Eo(me(e)))},Ye.prototype.slice=function(e,i){e=Me(e);var o=this;return o.__filtered__&&(e>0||i<0)?new Ye(o):(e<0?o=o.takeRight(-e):e&&(o=o.drop(e)),i!==r&&(i=Me(i),o=i<0?o.dropRight(-i):o.take(i-e)),o)},Ye.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Ye.prototype.toArray=function(){return this.take(re)},Xr(Ye.prototype,function(e,i){var o=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),f=g[c?"take"+(i=="last"?"Right":""):i],y=c||/^find/.test(i);f&&(g.prototype[i]=function(){var E=this.__wrapped__,O=c?[1]:arguments,L=E instanceof Ye,J=O[0],X=L||Re(E),Q=function(Ge){var Ze=f.apply(g,Ei([Ge],O));return c&&ae?Ze[0]:Ze};X&&o&&typeof J=="function"&&J.length!=1&&(L=X=!1);var ae=this.__chain__,ve=!!this.__actions__.length,we=y&&!ae,ze=L&&!ve;if(!y&&X){E=ze?E:new Ye(this);var Ee=e.apply(E,O);return Ee.__actions__.push({func:_o,args:[Q],thisArg:r}),new Nr(Ee,ae)}return we&&ze?e.apply(this,O):(Ee=this.thru(Q),we?c?Ee.value()[0]:Ee.value():Ee)})}),Ar(["pop","push","shift","sort","splice","unshift"],function(e){var i=Ks[e],o=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);g.prototype[e]=function(){var f=arguments;if(c&&!this.__chain__){var y=this.value();return i.apply(Re(y)?y:[],f)}return this[o](function(E){return i.apply(Re(E)?E:[],f)})}}),Xr(Ye.prototype,function(e,i){var o=g[i];if(o){var c=o.name+"";nt.call(mn,c)||(mn[c]=[]),mn[c].push({name:i,func:o})}}),mn[ho(r,oe).name]=[{name:"wrapper",func:r}],Ye.prototype.clone=eg,Ye.prototype.reverse=tg,Ye.prototype.value=rg,g.prototype.at=T1,g.prototype.chain=R1,g.prototype.commit=U1,g.prototype.next=D1,g.prototype.plant=F1,g.prototype.reverse=$1,g.prototype.toJSON=g.prototype.valueOf=g.prototype.value=M1,g.prototype.first=g.prototype.head,zn&&(g.prototype[zn]=L1),g},vn=Ud();Nt?((Nt.exports=vn)._=vn,ct._=vn):Xe._=vn}).call(fs)})(Qc,Qc.exports);var y5=Object.defineProperty,_5=Object.defineProperties,m5=Object.getOwnPropertyDescriptors,Wf=Object.getOwnPropertySymbols,b5=Object.prototype.hasOwnProperty,w5=Object.prototype.propertyIsEnumerable,Yf=(n,t,r)=>t in n?y5(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Po=(n,t)=>{for(var r in t||(t={}))b5.call(t,r)&&Yf(n,r,t[r]);if(Wf)for(var r of Wf(t))w5.call(t,r)&&Yf(n,r,t[r]);return n},E5=(n,t)=>_5(n,m5(t));function Mr(n,t,r){let s;const a=eu(n);return t.rpcMap&&(s=t.rpcMap[a]),s||(s=`${v5}?chainId=eip155:${a}&projectId=${r}`),s}function eu(n){return n.includes("eip155")?Number(n.split(":")[1]):Number(n)}function cd(n){return n.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function S5(n,t){const r=Object.keys(t.namespaces).filter(a=>a.includes(n));if(!r.length)return[];const s=[];return r.forEach(a=>{const l=t.namespaces[a].accounts;s.push(...l)}),s}function I5(n={},t={}){const r=Jf(n),s=Jf(t);return Qc.exports.merge(r,s)}function Jf(n){var t,r,s,a;const l={};if(!Tn(n))return l;for(const[d,p]of Object.entries(n)){const v=gu(d)?[d]:p.chains,w=p.methods||[],x=p.events||[],D=p.rpcMap||{},j=No(d);l[j]=E5(Po(Po({},l[j]),p),{chains:Cc(v,(t=l[j])==null?void 0:t.chains),methods:Cc(w,(r=l[j])==null?void 0:r.methods),events:Cc(x,(s=l[j])==null?void 0:s.events),rpcMap:Po(Po({},D),(a=l[j])==null?void 0:a.rpcMap)})}return l}function x5(n){return n.includes(":")?n.split(":")[2]:n}function O5(n){const t={};for(const[r,s]of Object.entries(n)){const a=s.methods||[],l=s.events||[],d=s.accounts||[],p=gu(r)?[r]:s.chains?s.chains:cd(s.accounts);t[r]={chains:p,methods:a,events:l,accounts:d}}return t}const ud={},Dt=n=>ud[n],Fc=(n,t)=>{ud[n]=t};class P5{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=Dt("events"),this.client=Dt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Mr(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(Li.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace);return typeof s>"u"?void 0:new Di(new sn(s,Dt("disableProviderPing")))}}class A5{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=Dt("events"),this.client=Dt("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){const s=eu(t);if(!this.httpProviders[s]){const a=r||Mr(`${this.name}:${s}`,this.namespace,this.client.core.projectId);if(!a)throw new Error(`No RPC url provided for chainId: ${s}`);this.setHttpProvider(s,a)}this.chainId=s,this.events.emit(Li.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const s=r||Mr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Di(new sn(s,Dt("disableProviderPing")))}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=eu(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,s;let a=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const l=parseInt(a,16);if(this.isChainApproved(l))this.setDefaultChain(`${l}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${l}`);else throw new Error(`Failed to switch to chain 'eip155:${l}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class C5{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=Dt("events"),this.client=Dt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(!this.httpProviders[t]){const s=r||Mr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.chainId=t,this.events.emit(Li.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Di(new sn(s,Dt("disableProviderPing")))}}class N5{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=Dt("events"),this.client=Dt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Mr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(Li.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Di(new sn(s,Dt("disableProviderPing")))}}class T5{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=Dt("events"),this.client=Dt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(Li.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r);t[r]=this.createHttpProvider(r,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||this.getCardanoRPCUrl(t);return typeof s>"u"?void 0:new Di(new sn(s,Dt("disableProviderPing")))}}class R5{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=Dt("events"),this.client=Dt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(!this.httpProviders[t]){const s=r||Mr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.chainId=t,this.events.emit(Li.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Di(new sn(s,Dt("disableProviderPing")))}}class U5{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=Dt("events"),this.client=Dt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(!this.httpProviders[t]){const s=r||Mr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.chainId=t,this.events.emit(Li.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Di(new sn(s,Dt("disableProviderPing")))}}var D5=Object.defineProperty,L5=Object.defineProperties,F5=Object.getOwnPropertyDescriptors,Xf=Object.getOwnPropertySymbols,$5=Object.prototype.hasOwnProperty,M5=Object.prototype.propertyIsEnumerable,Zf=(n,t,r)=>t in n?D5(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Ao=(n,t)=>{for(var r in t||(t={}))$5.call(t,r)&&Zf(n,r,t[r]);if(Xf)for(var r of Xf(t))M5.call(t,r)&&Zf(n,r,t[r]);return n},$c=(n,t)=>L5(n,F5(t));class xu{constructor(t){this.events=new ur.exports,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Qe.pino(Qe.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||kf})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new xu(t);return await r.initialize(),r}async request(t,r){const[s,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Ao({},t),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(t,r,s){this.request(t,s).then(a=>r(null,a)).catch(a=>r(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:Ut("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(l=>{this.session=l,this.namespaces||(this.namespaces=O5(l.namespaces),this.persist("namespaces",this.namespaces))}).catch(l=>{if(l.message!==ad)throw l;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[s,a]=this.validateChain(t);this.getProvider(s).setDefaultChain(a,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(ii(r)){for(const s of r)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Iu.init({logger:this.providerOpts.logger||kf,relayUrl:this.providerOpts.relayUrl||p5,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>No(r)))];Fc("client",this.client),Fc("events",this.events),Fc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const s=S5(r,this.session),a=cd(s),l=I5(this.namespaces,this.optionalNamespaces),d=$c(Ao({},l[r]),{accounts:s,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new A5({namespace:d});break;case"solana":this.rpcProviders[r]=new C5({namespace:d});break;case"cosmos":this.rpcProviders[r]=new N5({namespace:d});break;case"polkadot":this.rpcProviders[r]=new P5({namespace:d});break;case"cip34":this.rpcProviders[r]=new T5({namespace:d});break;case"elrond":this.rpcProviders[r]=new R5({namespace:d});break;case"multiversx":this.rpcProviders[r]=new U5({namespace:d});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:s}=r;if(s.name==="accountsChanged"){const a=s.data;a&&ii(a)&&this.events.emit("accountsChanged",a.map(x5))}else s.name==="chainChanged"?this.onChainChanged(r.chainId):this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var s;const{namespaces:a}=r,l=(s=this.client)==null?void 0:s.session.get(t);this.session=$c(Ao({},l),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",$c(Ao({},Ut("USER_DISCONNECTED")),{data:t.topic}))}),this.on(Li.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:s,sessionProperties:a}=t;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(t){const[r,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(d=>No(d)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const a=No(Object.keys(this.namespaces)[0]),l=this.rpcProviders[a].getDefaultChain();return[a,l]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var s;if(!this.namespaces)return;const[a,l]=this.validateChain(t);r||this.getProvider(a).setDefaultChain(l),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${l}`]).defaultChain=l,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",l)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${Gf}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${Gf}/${t}`)}}const j5=xu,q5="wc",z5="ethereum_provider",H5=`${q5}@2:${z5}:`,K5="https://rpc.walletconnect.com/v1/",tu=["eth_sendTransaction","personal_sign"],B5=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],ru=["chainChanged","accountsChanged"],V5=["message","disconnect","connect"];var k5=Object.defineProperty,G5=Object.defineProperties,W5=Object.getOwnPropertyDescriptors,Qf=Object.getOwnPropertySymbols,Y5=Object.prototype.hasOwnProperty,J5=Object.prototype.propertyIsEnumerable,ep=(n,t,r)=>t in n?k5(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,ps=(n,t)=>{for(var r in t||(t={}))Y5.call(t,r)&&ep(n,r,t[r]);if(Qf)for(var r of Qf(t))J5.call(t,r)&&ep(n,r,t[r]);return n},tp=(n,t)=>G5(n,W5(t));function Mo(n){return Number(n[0].split(":")[1])}function Mc(n){return`0x${n.toString(16)}`}function X5(n){const{chains:t,optionalChains:r,methods:s,optionalMethods:a,events:l,optionalEvents:d,rpcMap:p}=n;if(!ii(t))throw new Error("Invalid chains");const v={chains:t,methods:s||tu,events:l||ru,rpcMap:ps({},t.length?{[Mo(t)]:p[Mo(t)]}:{})},w=l==null?void 0:l.filter(U=>!ru.includes(U)),x=s==null?void 0:s.filter(U=>!tu.includes(U));if(!r&&!d&&!a&&!(w!=null&&w.length)&&!(x!=null&&x.length))return{required:t.length?v:void 0};const D=(w==null?void 0:w.length)&&(x==null?void 0:x.length)||!r,j={chains:[...new Set(D?v.chains.concat(r||[]):r)],methods:[...new Set(v.methods.concat(a!=null&&a.length?a:B5))],events:[...new Set(v.events.concat(d||V5))],rpcMap:p};return{required:t.length?v:void 0,optional:r.length?j:void 0}}class Ou{constructor(){this.events=new ur.exports.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=H5,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new Ou;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:s}=X5(this.rpc);try{const a=await new Promise(async(d,p)=>{var v;this.rpc.showQrModal&&((v=this.modal)==null||v.subscribeModal(w=>{!w.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),p(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(tp(ps({namespaces:ps({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(w=>{d(w)}).catch(w=>{p(new Error(w.message))})});if(!a)return;this.setChainIds(this.rpc.chains);const l=Wb(a.namespaces,[this.namespace]);this.setAccounts(l),this.events.emit("connect",{chainId:Mc(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Mc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",tp(ps({},Ut("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Mc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,s,a]=t.split(":");return{chainId:`${r}:${s}`,address:a}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,s;const a=(r=t==null?void 0:t.chains)!=null?r:[],l=(s=t==null?void 0:t.optionalChains)!=null?s:[],d=a.concat(l);if(!d.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const p=a.length?(t==null?void 0:t.methods)||tu:[],v=a.length?(t==null?void 0:t.events)||ru:[],w=(t==null?void 0:t.optionalMethods)||[],x=(t==null?void 0:t.optionalEvents)||[],D=(t==null?void 0:t.rpcMap)||this.buildRpcMap(d,t.projectId),j=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(U=>this.formatChainId(U)),optionalChains:l.map(U=>this.formatChainId(U)),methods:p,events:v,optionalMethods:w,optionalEvents:x,rpcMap:D,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:j,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const s={};return t.forEach(a=>{s[a]=this.getRpcUrl(a,r)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Mo(this.rpc.chains):Mo(this.rpc.optionalChains),this.signer=await j5.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await K_(()=>import("./index.4bab6852.js").then(a=>a.a),["assets/index.4bab6852.js","assets/index.eec712e0.js","assets/index.9d552218.css"]);r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(ps({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:s,rpcMap:a}=t;r&&ii(r)&&(this.rpc.chains=r.map(l=>this.formatChainId(l)),r.forEach(l=>{this.rpc.rpcMap[l]=(a==null?void 0:a[l])||this.getRpcUrl(l)})),s&&ii(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(l=>this.formatChainId(l)),s.forEach(l=>{this.rpc.rpcMap[l]=(a==null?void 0:a[l])||this.getRpcUrl(l)}))}getRpcUrl(t,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${K5}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const r3=Ou;export{r3 as EthereumProvider,V5 as OPTIONAL_EVENTS,B5 as OPTIONAL_METHODS,ru as REQUIRED_EVENTS,tu as REQUIRED_METHODS,Ou as default};
